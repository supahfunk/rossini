{"version":3,"sources":["js/app.js"],"names":["angular","module","config","$httpProvider","$locationProvider","html5Mode","hashPrefix","run","$rootScope","controller","$scope","onChange","params","audio","volume","options","audioVolume","backgroundColor","THREE","Color","colors","background","getHexString","console","log","document","body","style","OBJECTS","ribbon","updateMaterial","forEach","circles","circle","onChangePositions","step","stepper","getCurrentStep","camera","position","copy","target","getRandomRange","min","max","allowNegatives","n","Math","random","a","abs","floor","getObjectRibbon","add","scene","object","remove","update","c","steps","length","cpow","pow","tpow","mod","spline","getPointAt","y","cameraHeight","targetHeight","lookAt","getMaterial","Vector2","window","innerWidth","innerHeight","MeshLineMaterial","color","lines","lineWidth","depthTest","material","prev","Vector3","points","Array","fill","map","p","x","z","CatmullRomCurve3","type","geometry","Geometry","vertices","getPoints","line","MeshLine","setGeometry","Mesh","getObjectCircles","index","state","adding","Date","now","removing","enabled","tween","kill","TweenLite","to","duration","delay","ease","Power2","easeInOut","onComplete","getLine1","v","i","addPoints","useMeshLines","meshLine","meshLineGeometries1","push","meshLines1","meshLineMaterial1","LineLoop","material1","points1","group1","getLine2","meshLineGeometries2","meshLines2","meshLineMaterial2","material2","points2","group2","l","g","pn","ratio","degrees","radians","PI","radius","increment","sincos","base","cos","sin","updateLine","audioStrength","noiseStrength","circularStrength","data","analyserData","aia","bands","aib","audioPow","nd","nia","iterator","nib","noisePow","noiseMap","linePow","ln","verticesNeedUpdate","lines1","lines2","rotation","scale","setHex","LineBasicMaterial","Object3D","texture","TextureLoader","load","wrapS","RepeatWrapping","wrapT","repeat","set","MeshBasicMaterial","PlaneGeometry","plane","updateAnalyser","analyser","getByteFrequencyData","loop","stats","begin","render","end","requestAnimationFrame","controls","tube","renderer","addListeners","onWindowResize","width","height","w2","h2","setSize","aspect","updateProjectionMatrix","addEventListener","ImprovedNoise","fade","t","lerp","b","grad","hash","h","u","noise","floorX","floorY","floorZ","X","Y","Z","xMinus1","yMinus1","zMinus1","w","A","AA","AB","B","BA","BB","Number","prototype","this","audioUrl","notes","randomize","gui","__controllers","__min","value","__max","property","updateDisplay","__color","r","setValue","hex","size","Uint8Array","perlin","quality","j","tweenTo","callback","setStep","previous","current","setTimeout","next","extend","fov","near","far","container","Scene","PerspectiveCamera","WebGLRenderer","alpha","antialias","logarithmicDepthBuffer","setClearColor","shadowMap","getElementById","appendChild","domElement","Stats","dom","source","ctx","actx","AudioContext","webkitAudioContext","createAnalyser","Audio","src","bufferLength","createMediaElementSource","connect","destination","fftSize","frequencyBinCount","play","dat","GUI","closed","circlePosition","addFolder","addColor"],"mappings":"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","file":"app.min.js","sourcesContent":["/* global angular */\r\n\r\n(function() {\r\n    \"use strict\";\r\n\r\n    var app = angular.module('app', ['ngRoute', 'jsonFormatter']);\r\n\r\n}());\n/* global angular */\r\n\r\n(function() {\r\n    \"use strict\";\r\n\r\n    var app = angular.module('app');\r\n\r\n    app.config(['$httpProvider', function($httpProvider) {\r\n        // $httpProvider.defaults.withCredentials = true;\r\n    }]);\r\n\r\n}());\n/* global angular */\r\n\r\n(function() {\r\n    \"use strict\";\r\n\r\n    var app = angular.module('app');\r\n\r\n    app.config(['$locationProvider', function($locationProvider) {\r\n\r\n        // HTML5 MODE url writing method (false: #/anchor/use, true: /html5/url/use)\r\n        $locationProvider.html5Mode(true);\r\n        $locationProvider.hashPrefix('');\r\n\r\n    }]);\r\n\r\n}());\n/* global angular */\r\n\r\n(function() {\r\n    \"use strict\";\r\n\r\n    var app = angular.module('app');\r\n\r\n    app.run(['$rootScope', function($rootScope) {\r\n\r\n    }]);\r\n\r\n}());\n/* global angular */\r\n\r\n(function() {\r\n    \"use strict\";\r\n\r\n    var app = angular.module('app');\r\n\r\n    app.controller('RootCtrl', ['$scope', function($scope) {\r\n\r\n        var OBJECTS = {};\r\n\r\n        Number.prototype.mod = function(n) {\r\n            return ((this % n) + n) % n;\r\n        };\r\n\r\n        var options = {\r\n            cameraHeight: 33,\r\n            targetHeight: 39,\r\n            camera: {\r\n                position: new THREE.Vector3(),\r\n                target: new THREE.Vector3(),\r\n            },\r\n            circle: {\r\n                position: new THREE.Vector3(),\r\n            },\r\n            audioUrl: \"audio/rossini-192.mp3\",\r\n            audioVolume: 1.0,\r\n            colors: {\r\n                background: 0x111111, // 0xffffff,\r\n                lines: 0x999999, // 0x888888,\r\n                notes: 0x444444, // 0xaaaaaa,\r\n            },\r\n            bands: 128,\r\n            points: 128,\r\n            lines: 32,\r\n            radius: 200,\r\n            audioStrength: 100,\r\n            noiseStrength: 25,\r\n            circularStrength: 0.90,\r\n            randomize: function() {\r\n                for (var i = 0; i < gui.__controllers.length; i++) {\r\n                    var c = gui.__controllers[i];\r\n                    if (c.__min) {\r\n                        var value = c.__min + (c.__max - c.__min) * Math.random();\r\n                        this[c.property] = value;\r\n                        c.updateDisplay();\r\n                    }\r\n                    if (c.__color) {\r\n                        c.__color.r = Math.floor(Math.random() * 255);\r\n                        c.__color.g = Math.floor(Math.random() * 255);\r\n                        c.__color.b = Math.floor(Math.random() * 255);\r\n                        c.updateDisplay();\r\n                        c.setValue(c.__color.hex);\r\n                    }\r\n                }\r\n            }\r\n        };\r\n\r\n        options.noiseMap = getPerlinNoise(options.points, options.lines);\r\n\r\n        function getStepper() {\r\n            var stepper = {\r\n                pow: 0,\r\n                duration: 1.500, // sec\r\n            };\r\n\r\n            var steps = new Array(24).fill().map(function(v, i) {\r\n                return {\r\n                    camera: {\r\n                        position: new THREE.Vector3(),\r\n                        target: new THREE.Vector3(),\r\n                    },\r\n                    circle: {\r\n                        position: new THREE.Vector3(60, 60, 0),\r\n                        texture: 'img/rossini-01.jpg',\r\n                    }\r\n                };\r\n            });\r\n\r\n            var current = 0;\r\n\r\n            function tweenTo(pow, callback) {\r\n                if (stepper.tween) {\r\n                    stepper.tween.kill();\r\n                    stepper.tween = null;\r\n                }\r\n                stepper.tween = TweenLite.to(stepper, stepper.duration, {\r\n                    pow: pow,\r\n                    delay: 0,\r\n                    ease: Power2.easeInOut,\r\n                    onComplete: function() {\r\n                        if (callback) {\r\n                            callback();\r\n                        }\r\n                    },\r\n                });\r\n            }\r\n\r\n            function setStep(index) {\r\n                var previous = stepper.current || 0;\r\n                stepper.current = index;\r\n                var step = steps[index];\r\n                options.camera.position.copy(step.camera.position);\r\n                options.camera.target.copy(step.camera.target);\r\n                options.circle.position.copy(step.circle.position);\r\n\r\n                var circle = OBJECTS.circles[index] || getObjectCircles(index);\r\n                circle.add();\r\n                OBJECTS.circles[index] = circle;\r\n                tweenTo(index / steps.length, function() {\r\n                    stepper.tween = null;\r\n                });\r\n                setTimeout(function() {\r\n                    if (previous !== stepper.current) {\r\n                        var circle = OBJECTS.circles[previous];\r\n                        if (circle) {\r\n                            circle.remove();\r\n                        }\r\n                    }\r\n                }, stepper.duration * 1000);\r\n            }\r\n\r\n            function next() {\r\n                current++;\r\n                current = Math.min(steps.length - 1, current);\r\n                // current = current % steps.length;\r\n                setStep(current);\r\n            }\r\n\r\n            function previous() {\r\n                current--;\r\n                current = Math.max(0, current);\r\n                // current = current % steps.length;\r\n                setStep(current);\r\n            }\r\n\r\n            function getCurrentStep() {\r\n                return steps[current];\r\n            }\r\n\r\n            return angular.extend(stepper, {\r\n                steps: steps,\r\n                current: current,\r\n                next: next,\r\n                previous: previous,\r\n                getCurrentStep: getCurrentStep,\r\n            });\r\n        }\r\n\r\n        var stepper = getStepper();\r\n        $scope.stepper = stepper;\r\n\r\n        var analyser, analyserData, audio;\r\n        var stats, gui, scene, camera, fov, ratio, near, far, shadow, back, light, renderer, container, width, height, w2, h2, mouse = { x: 0, y: 0 };\r\n        var controls = null;\r\n\r\n\r\n        function onChange(params) {\r\n            // renderer.setClearColor(options.colors.background, 1);\r\n            if (audio) {\r\n                audio.volume = options.audioVolume;\r\n            }\r\n            var backgroundColor = new THREE.Color(options.colors.background).getHexString();\r\n            console.log('backgroundColor', backgroundColor);\r\n            document.body.style.backgroundColor = '#' + backgroundColor;\r\n            if (OBJECTS.ribbon) {\r\n                OBJECTS.ribbon.updateMaterial();\r\n            }\r\n            angular.forEach(OBJECTS.circles, function(circle) {\r\n                if (circle) {\r\n                    circle.updateMaterial();\r\n                }\r\n            });\r\n        }\r\n\r\n        function onChangePositions(params) {\r\n            var step = stepper.getCurrentStep();\r\n            step.camera.position.copy(options.camera.position);\r\n            step.camera.target.copy(options.camera.target);\r\n            step.circle.position.copy(options.circle.position);\r\n        }\r\n\r\n        function createLights() {\r\n            light = new THREE.HemisphereLight(0xffffff, 0xffffff, 0.5);\r\n            shadow = new THREE.DirectionalLight(0xffffff, 0.8);\r\n            shadow.position.set(200, 200, 200);\r\n            shadow.castShadow = true;\r\n            // shadow.shadowDarkness = .2;\r\n            back = new THREE.DirectionalLight(0xffffff, 0.4);\r\n            back.position.set(-100, 200, 50);\r\n            // back.shadowDarkness = .2;\r\n            back.castShadow = true;\r\n            scene.add(light);\r\n            scene.add(shadow);\r\n            scene.add(back);\r\n        }\r\n\r\n        function createScene() {\r\n            width = window.innerWidth;\r\n            height = window.innerHeight;\r\n            ratio = width / height;\r\n            w2 = width / 2;\r\n            h2 = height / 2;\r\n            fov = 60;\r\n            near = 0.001;\r\n            far = 20000;\r\n\r\n            scene = new THREE.Scene();\r\n            // scene.fog = new THREE.Fog(0x000000, 300, 1000);\r\n\r\n            camera = new THREE.PerspectiveCamera(fov, ratio, near, far);\r\n            camera.position.z = 100;\r\n            camera.position.y = -500;\r\n            camera.lookAt(new THREE.Vector3(0, 0, 0));\r\n            renderer = new THREE.WebGLRenderer({\r\n                alpha: true,\r\n                antialias: true,\r\n                logarithmicDepthBuffer: true\r\n            });\r\n            renderer.setClearColor(0x000000, 0); // the default\r\n            // renderer.setClearColor(options.colors.background, 1);\r\n            renderer.setSize(width, height);\r\n            renderer.shadowMap.enabled = true;\r\n            container = document.getElementById('scene');\r\n            container.appendChild(renderer.domElement);\r\n\r\n            stats = new Stats();\r\n            container.appendChild(stats.dom);\r\n\r\n            addListeners();\r\n            // controls = new THREE.OrbitControls(camera, renderer.domElement);\r\n        }\r\n\r\n        function getRandomRange(min, max, allowNegatives) {\r\n            var n = -1 + Math.random() * 2;\r\n            var a = Math.abs(n);\r\n            var s = allowNegatives ? Math.floor(n / a) : 1;\r\n            return s * (min + (max - min) * a);\r\n        }\r\n\r\n        function getObjectRibbon() {\r\n            var material = getMaterial();\r\n\r\n            var prev = new THREE.Vector3();\r\n            var points = new Array(12).fill(null).map(function() {\r\n                var p = new THREE.Vector3().copy(prev);\r\n                prev.x += getRandomRange(500, 1000, true);\r\n                prev.y += getRandomRange(50, 100, true);\r\n                prev.z += getRandomRange(1000, 2000, false);\r\n                return p;\r\n            });\r\n\r\n            var spline = new THREE.CatmullRomCurve3(points);\r\n            spline.type = 'catmullrom';\r\n            // spline.closed = true;\r\n\r\n            /*\r\n            var cameraHeight = options.cameraHeight;\r\n            var cameraSpline = new THREE.CatmullRomCurve3(spline.points.map(function(p) {\r\n                return new THREE.Vector3(p.x, p.y + cameraHeight, p.z);\r\n            }));\r\n            cameraSpline.type = 'catmullrom';\r\n            // cameraSpline.closed = true;\r\n\r\n            var targetHeight = options.targetHeight;\r\n            var targetSpline = new THREE.CatmullRomCurve3(spline.points.map(function(p) {\r\n                return new THREE.Vector3(p.x, p.y + targetHeight, p.z);\r\n            }));\r\n            targetSpline.type = 'catmullrom';\r\n            // targetSpline.closed = true;\r\n            */\r\n\r\n            var geometry = new THREE.Geometry();\r\n            geometry.vertices = spline.getPoints(1200);\r\n\r\n            var line = new MeshLine();\r\n            line.setGeometry(geometry);\r\n            // line.setGeometry( geometry, function( p ) { return 2; } ); // makes width 2 * lineWidth\r\n            // line.setGeometry( geometry, function( p ) { return 1 - p; } ); // makes width taper\r\n            // line.setGeometry( geometry, function( p ) { return 2 + Math.sin( 50 * p ); } ); // makes width sinusoidal\r\n\r\n            var object = new THREE.Mesh(line.geometry, material);\r\n            // var object = new THREE.Object3D();\r\n            // object.add(mesh);\r\n            scene.add(object);\r\n\r\n            function add() {\r\n                console.log('OBJECTS.ribbon.add');\r\n                scene.add(object);\r\n            }\r\n\r\n            function remove() {\r\n                console.log('OBJECTS.ribbon.remove');\r\n                scene.remove(object);\r\n            }\r\n\r\n            camera.target = camera.target || new THREE.Vector3(0, 0, 0);\r\n\r\n            function update() {\r\n                var c = (1 / stepper.steps.length) / 10;\r\n                var cpow = stepper.pow;\r\n                var tpow = (cpow + c).mod(1);\r\n\r\n                var position = spline.getPointAt(cpow);\r\n                position.y += options.cameraHeight;\r\n\r\n                var target = spline.getPointAt(tpow);\r\n                target.y += options.targetHeight;\r\n\r\n                var step = stepper.getCurrentStep();\r\n                position.add(step.camera.position);\r\n                target.add(step.camera.target);\r\n\r\n                camera.position.copy(position);\r\n                camera.target.copy(target);\r\n                camera.lookAt(camera.target);\r\n            }\r\n\r\n            function getMaterial() {\r\n                var resolution = new THREE.Vector2(window.innerWidth, window.innerHeight);\r\n                return new MeshLineMaterial({\r\n                    color: new THREE.Color(options.colors.lines),\r\n                    lineWidth: 5,\r\n                    depthTest: true,\r\n                    /*\r\n                    opacity: 1,\r\n                    resolution: resolution,\r\n                    sizeAttenuation: 1,\r\n                    near: 1,\r\n                    far: 1000,\r\n                    blending: THREE.AdditiveBlending,\r\n                    transparent: false,\r\n                    side: THREE.DoubleSide,\r\n                    */\r\n                });\r\n            }\r\n\r\n            function updateMaterial() {\r\n                // !!! non va bene\r\n                OBJECTS.ribbon.material = getMaterial();\r\n                OBJECTS.ribbon.object.material = OBJECTS.ribbon.material;\r\n            }\r\n\r\n            return {\r\n                object: object,\r\n                spline: spline,\r\n                geometry: geometry,\r\n                material: material,\r\n                add: add,\r\n                remove: remove,\r\n                update: update,\r\n                updateMaterial: updateMaterial,\r\n            };\r\n        }\r\n\r\n        function getObjectCircles(index) {\r\n            var geometry, object, circles = [];\r\n\r\n            // materials\r\n            var material1 = new THREE.LineBasicMaterial({\r\n                color: options.colors.lines,\r\n            });\r\n\r\n            var material2 = new THREE.LineBasicMaterial({\r\n                color: 0xffffff,\r\n            });\r\n\r\n            var resolution = new THREE.Vector2(window.innerWidth, window.innerHeight);\r\n\r\n            var meshLineMaterial1 = new MeshLineMaterial({\r\n                color: new THREE.Color(options.colors.lines),\r\n                lineWidth: 1,\r\n                depthTest: true,\r\n                /*\r\n                opacity: 1,\r\n                resolution: resolution,\r\n                sizeAttenuation: 1,\r\n                near: 1,\r\n                far: 1000,\r\n                blending: THREE.AdditiveBlending,\r\n                transparent: false,\r\n                side: THREE.DoubleSide,\r\n                */\r\n            });\r\n\r\n            var meshLineMaterial2 = new MeshLineMaterial({\r\n                color: new THREE.Color(0xffffff),\r\n                lineWidth: 1,\r\n                depthTest: true,\r\n                /*\r\n                opacity: 1,\r\n                resolution: resolution,\r\n                sizeAttenuation: 1,\r\n                near: 1,\r\n                far: 1000,\r\n                blending: THREE.AdditiveBlending,\r\n                transparent: false,\r\n                side: THREE.DoubleSide,\r\n                */\r\n            });\r\n\r\n            object = new THREE.Object3D();\r\n\r\n            // sphere\r\n            var step = stepper.steps[index];\r\n            var texture = new THREE.TextureLoader().load(step.circle.texture);\r\n            texture.wrapS = THREE.RepeatWrapping;\r\n            texture.wrapT = THREE.RepeatWrapping;\r\n            texture.repeat.set(1, 1);\r\n            var material = new THREE.MeshBasicMaterial({\r\n                color: options.colors.lines,\r\n                map: texture,\r\n            });\r\n\r\n            /*\r\n            geometry = new THREE.IcosahedronGeometry(options.radius - 5, 3); // radius, detail\r\n            var sphere = new THREE.Mesh(geometry, material);\r\n            sphere.scale.z = 0.001;\r\n            object.add(sphere);\r\n            */\r\n\r\n            geometry = new THREE.PlaneGeometry(options.radius * 2 - 20, options.radius * 2 - 20, 8, 8);\r\n            var plane = new THREE.Mesh(geometry, material);\r\n            object.add(plane);\r\n            // sphere\r\n\r\n            var points1 = [],\r\n                points2 = [],\r\n                meshLines1 = [],\r\n                meshLines2 = [],\r\n                meshLineGeometries1 = [],\r\n                meshLineGeometries2 = [],\r\n                useMeshLines = false;\r\n\r\n            var pn = options.points,\r\n                ln = options.lines;\r\n\r\n            var group1 = new THREE.Object3D();\r\n            object.add(group1);\r\n\r\n            var group2 = new THREE.Object3D();\r\n            object.add(group2);\r\n\r\n            var lines1 = new Array(ln).fill(null).map(getLine1);\r\n            var lines2 = new Array(ln).fill(null).map(getLine2);\r\n\r\n            // console.log('lines2', lines2[lines2.length - 1].geometry.vertices[0]);\r\n\r\n            var state = {\r\n                pow: 0,\r\n                duration: 0.350,\r\n                enabled: false,\r\n                adding: false,\r\n                removing: false,\r\n            };\r\n\r\n            var to = null;\r\n\r\n            function add() {\r\n                console.log('OBJECTS.circles.add');\r\n                scene.add(object);\r\n                state.adding = Date.now();\r\n                state.removing = false;\r\n                state.enabled = true;\r\n                if (state.tween) {\r\n                    state.tween.kill();\r\n                }\r\n                state.tween = TweenLite.to(state, state.duration, {\r\n                    pow: 1,\r\n                    delay: 0,\r\n                    ease: Power2.easeInOut,\r\n                    onComplete: function() {\r\n                        state.adding = false;\r\n                    },\r\n                });\r\n            }\r\n\r\n            function remove() {\r\n                console.log('OBJECTS.circles.remove');\r\n                state.adding = false;\r\n                state.removing = Date.now();\r\n                if (state.tween) {\r\n                    state.tween.kill();\r\n                }\r\n                state.tween = TweenLite.to(state, state.duration, {\r\n                    pow: 0,\r\n                    delay: 0,\r\n                    ease: Power2.easeInOut,\r\n                    onComplete: function() {\r\n                        state.removing = false;\r\n                        state.enabled = false;\r\n                        scene.remove(object);\r\n                    },\r\n                });\r\n            }\r\n\r\n            var iterator = 0;\r\n\r\n            function getLine1(v, i) {\r\n                var geometry = new THREE.Geometry();\r\n                var points = addPoints(geometry, i, 1);\r\n                var line = null;\r\n                if (useMeshLines) {\r\n                    var meshLine = new MeshLine();\r\n                    meshLine.setGeometry(geometry);\r\n                    meshLineGeometries1.push(geometry);\r\n                    meshLines1.push(meshLine);\r\n                    // meshLine.setGeometry( geometry, function( p ) { return 2; } ); // makes width 2 * lineWidth\r\n                    // meshLine.setGeometry( geometry, function( p ) { return 1 - p; } ); // makes width taper\r\n                    // meshLine.setGeometry( geometry, function( p ) { return 2 + Math.sin( 50 * p ); } ); // makes width sinusoidal\r\n                    line = new THREE.Mesh(meshLine.geometry, meshLineMaterial1);\r\n                } else {\r\n                    line = new THREE.LineLoop(geometry, material1);\r\n                }\r\n                points1.push(points);\r\n                // var spline = new THREE.CatmullRomCurve3(points);\r\n                // circle.spline = spline;\r\n                group1.add(line);\r\n                return line;\r\n            }\r\n\r\n            function getLine2(v, i) {\r\n                var geometry = new THREE.Geometry();\r\n                var points = addPoints(geometry, i, 2);\r\n                var line = null;\r\n                if (useMeshLines) {\r\n                    var meshLine = new MeshLine();\r\n                    meshLine.setGeometry(geometry);\r\n                    meshLineGeometries2.push(geometry);\r\n                    meshLines2.push(meshLine);\r\n                    // meshLine.setGeometry( geometry, function( p ) { return 2; } ); // makes width 2 * lineWidth\r\n                    // meshLine.setGeometry( geometry, function( p ) { return 1 - p; } ); // makes width taper\r\n                    // meshLine.setGeometry( geometry, function( p ) { return 2 + Math.sin( 50 * p ); } ); // makes width sinusoidal                    \r\n                    line = new THREE.Mesh(meshLine.geometry, meshLineMaterial2);\r\n                } else {\r\n                    line = new THREE.LineLoop(geometry, material2);\r\n                }\r\n                points2.push(points);\r\n                // var spline = new THREE.CatmullRomCurve3(points);\r\n                // circle.spline = spline;\r\n                group2.add(line);\r\n                return line;\r\n            }\r\n\r\n            function addPoints(geometry, l, g) {\r\n                var points = new Array(pn).fill(null).map(function(v, i) {\r\n                    var ratio = i / pn;\r\n                    var degrees = 360 * ratio; // point degrees;\r\n                    degrees += 60 * index; // circle offset;\r\n                    degrees += 30 * g; // group offset;\r\n                    degrees += (360 / pn * 0.1) * l; // line offset;\r\n                    var radians = degrees * Math.PI / 180;\r\n                    var radius = options.radius;\r\n                    var increment = 0;\r\n                    if (g === 1) {\r\n                        increment += (l * l * l * 0.005);\r\n                    } else {\r\n                        increment += (l * l * l * 0.005);\r\n                    }\r\n                    v = new THREE.Vector3();\r\n                    v.sincos = {\r\n                        base: radius,\r\n                        increment: increment,\r\n                        radius: radius,\r\n                        x: Math.cos(radians),\r\n                        y: Math.sin(radians),\r\n                    };\r\n                    geometry.vertices.push(v);\r\n                    return v;\r\n                });\r\n                return points;\r\n            }\r\n\r\n            function updateLine(geometry, vertices, l, g) {\r\n                var audioStrength = options.audioStrength,\r\n                    noiseStrength = options.noiseStrength,\r\n                    circularStrength = options.circularStrength,\r\n                    data = analyserData;\r\n\r\n                angular.forEach(vertices, function(v, i) {\r\n                    var aia = i % options.bands;\r\n                    var aib = (pn - 1 - i) % options.bands;\r\n                    var audioPow = ((data[aia] + data[aib]) / 2) / options.bands;\r\n                    // var audioPow = data[aia] / options.bands;\r\n\r\n                    var nd = g === 1 ? 0 : 64;\r\n                    var nia = l * pn + ((i + nd + iterator) % pn);\r\n                    var nib = l * pn + (((pn - 1 - i - nd) + iterator) % pn);\r\n                    var noisePow = (options.noiseMap[nia] + options.noiseMap[nib]) / 2 / 64;\r\n\r\n                    var linePow = 1 - ((ln - l) / ln * circularStrength);\r\n\r\n                    var radius = v.sincos.base +\r\n                        (v.sincos.increment * noisePow) +\r\n                        (v.sincos.increment * audioPow) +\r\n                        (noiseStrength * noisePow) * linePow +\r\n                        (audioStrength * audioPow) * linePow +\r\n                        // (audioStrength * (3 - g) * audioPow * (l * 0.1)) * linePow +\r\n                        0;\r\n\r\n                    v.sincos.radius = radius;\r\n                    // v.sincos.radius += (radius - v.sincos.radius) / 2;\r\n\r\n                    v.x = v.sincos.x * v.sincos.radius;\r\n                    v.y = v.sincos.y * v.sincos.radius;\r\n                    v.z = 0; // -l;\r\n                    // console.log(v.sincos.radius);\r\n                });\r\n\r\n                /*\r\n                var f = 0;\r\n                var l = pn - 1;\r\n                var first = new THREE.Vector3().copy(vertices[f]);\r\n                var last = new THREE.Vector3().copy(vertices[l]);\r\n                vertices[f].add(new THREE.Vector3().subVectors(first, last).multiplyScalar(0.5));\r\n                vertices[l].add(new THREE.Vector3().subVectors(first, last).multiplyScalar(-0.5));\r\n                */\r\n\r\n                geometry.verticesNeedUpdate = true;\r\n\r\n                /*\r\n                \tlines.forEach( function( l, i ) {\r\n\t\tif( params.animateWidth ) l.material.uniforms.lineWidth.value = params.lineWidth * ( 1 + .5 * Math.sin( 5 * t + i ) );\r\n\t\tif( params.autoRotate ) l.rotation.y += .125 * delta;\r\n      l.material.uniforms.visibility.value= params.animateVisibility ? (time/3000) % 1.0 : 1.0;\r\n                */\r\n                /*\r\n                if (iterator === 60 && g === 2 && l === 0) {\r\n                    console.log('vertices', geometry.vertices.map(function(v) { return v.x + ',' + v.y; }));\r\n                }\r\n                */\r\n            }\r\n\r\n            function update() {\r\n                angular.forEach(lines1, function(line, l) {\r\n                    updateLine(line.geometry, points1[l], l, 1);\r\n                    if (useMeshLines) {\r\n                        meshLines1[l].setGeometry(meshLineGeometries1[l]);\r\n                    }\r\n                });\r\n\r\n                angular.forEach(lines2, function(line, l) {\r\n                    updateLine(line.geometry, points2[l], l, 2);\r\n                    if (useMeshLines) {\r\n                        meshLines2[l].setGeometry(meshLineGeometries2[l]);\r\n                    }\r\n                });\r\n\r\n                group1.rotation.z += 0.001;\r\n                group2.rotation.z -= 0.001;\r\n\r\n                var step = stepper.getCurrentStep();\r\n                var position = OBJECTS.ribbon.spline.getPointAt((index + 0.5) / stepper.steps.length);\r\n                // position.y += options.cameraHeight;\r\n\r\n                position.add(step.circle.position);\r\n\r\n                object.position.copy(position);\r\n                /*\r\n                object.position.x += (position.x + Math.random() * 20 - object.position.x) / 20;\r\n                object.position.y += (position.y + Math.random() * 20 - object.position.y) / 20;\r\n                object.position.z += (position.z + Math.random() * 20 - object.position.z) / 20;\r\n                */\r\n\r\n                object.scale.x = object.scale.y = object.scale.z = 0.001 + 0.3 * state.pow;\r\n                object.lookAt(camera.position);\r\n\r\n                // iterator++;\r\n            }\r\n\r\n            function updateMaterial() {\r\n                material.color.setHex(options.colors.lines);\r\n                material1.color.setHex(options.colors.lines);\r\n            }\r\n\r\n            console.log(object);\r\n\r\n            return {\r\n                add: add,\r\n                remove: remove,\r\n                object: object,\r\n                state: state,\r\n                update: update,\r\n                updateMaterial: updateMaterial,\r\n            };\r\n        }\r\n        /*\r\n                function getObjectCirclesBak(index) {\r\n                    var geometry, material, object, circles = [];\r\n\r\n                    object = new THREE.Object3D();\r\n\r\n                    geometry = new THREE.IcosahedronGeometry(90, 3); // radius, detail\r\n                    material = new THREE.MeshBasicMaterial({\r\n                        color: 0xffff00,\r\n                    });\r\n                    var sphere = new THREE.Mesh(geometry, material);\r\n                    object.add(sphere);\r\n\r\n                    material = new THREE.LineBasicMaterial({\r\n                        color: options.colors.lines\r\n                    });\r\n\r\n                    var pn = options.points;\r\n\r\n                    while (circles.length < pn) {\r\n                        geometry = new THREE.Geometry();\r\n                        var circle = new THREE.LineLoop(geometry, material);\r\n                        circle.points = new Array(pn).fill(null);\r\n                        // var spline = new THREE.CatmullRomCurve3(points);\r\n                        // circle.spline = spline;\r\n                        circles.push(circle);\r\n                        object.add(circle);\r\n                    }\r\n                    var points = new Array(pn * pn).fill(null).map(function(n, i) {\r\n                        var r = Math.floor(i / pn);\r\n                        var c = i - r * pn;\r\n                        var angle = 2 * Math.PI / pn;\r\n                        var rad = angle * r + angle * c * 0.1;\r\n                        var point = new THREE.Vector3();\r\n                        point.r = {\r\n                            x: Math.cos(rad),\r\n                            y: Math.sin(rad),\r\n                            z: 96 + (c * c * c * 0.0001),\r\n                        };\r\n                        circles[c].points[r] = point;\r\n                        circles[c].geometry.vertices.push(point);\r\n                        return point;\r\n                    });\r\n\r\n                    var state = {\r\n                        pow: 0,\r\n                        duration: 0.350,\r\n                        enabled: false,\r\n                        adding: false,\r\n                        removing: false,\r\n                    };\r\n\r\n                    var to = null;\r\n\r\n                    function add() {\r\n                        console.log('OBJECTS.circles.add');\r\n                        scene.add(object);\r\n                        state.adding = Date.now();\r\n                        state.removing = false;\r\n                        state.enabled = true;\r\n                        if (state.tween) {\r\n                            state.tween.kill();\r\n                        }\r\n                        state.tween = TweenLite.to(state, state.duration, {\r\n                            pow: 1,\r\n                            delay: 0,\r\n                            ease: Power2.easeInOut,\r\n                            onComplete: function() {\r\n                                state.adding = false;\r\n                            },\r\n                        });\r\n                    }\r\n\r\n                    function remove() {\r\n                        console.log('OBJECTS.circles.remove');\r\n                        state.adding = false;\r\n                        state.removing = Date.now();\r\n                        if (state.tween) {\r\n                            state.tween.kill();\r\n                        }\r\n                        state.tween = TweenLite.to(state, state.duration, {\r\n                            pow: 0,\r\n                            delay: 0,\r\n                            ease: Power2.easeInOut,\r\n                            onComplete: function() {\r\n                                state.removing = false;\r\n                                state.enabled = false;\r\n                                scene.remove(object);\r\n                            },\r\n                        });\r\n                    }\r\n\r\n                    var d = 0;\r\n\r\n                    function update() {\r\n                        var audioStrength = options.audioStrength,\r\n                            noiseStrength = options.noiseStrength,\r\n                            circularStrength = options.circularStrength;\r\n                        angular.forEach(points, function(v, i) {\r\n                            var r = Math.floor(i / pn);\r\n                            var c = i - r * pn;\r\n                            var b = Math.abs(c - pn / 2) * 2;\r\n                            var dr = 1 - (Math.abs(r - pn / 2) / (pn / 2));\r\n                            var dc = 1 - (Math.abs(c - pn / 2) / (pn / 2));\r\n                            var drc = (dr + dc) / 2;\r\n                            var ai = r % options.bands;\r\n                            var pow = (analyserData[ai] + analyserData[pn - 1 - ai]) / 2;\r\n                            var scale = pow / options.bands;\r\n                            var na = c * pn + ((r + d) % pn);\r\n                            var noise = options.noiseMap[na];\r\n                            var cpow = 1 - ((pn - c) / pn * circularStrength);\r\n                            var level = v.r.z + (noise / 64 * noiseStrength) * cpow + (audioStrength * 2 * scale * scale) * cpow;\r\n                            var radius = v.radius || level;\r\n                            radius += (level - radius) / 2;\r\n                            v.x = v.r.x * radius;\r\n                            v.y = v.r.y * radius;\r\n                            v.z = 0; // -c;\r\n                            v.radius = radius;\r\n                        });\r\n                        angular.forEach(circles, function(circle, l) {\r\n                            // var points = circle.points;\r\n                            // var spline = circle.spline;\r\n                            // spline.getPoints(pn * 2);\r\n                            // circle.geometry.vertices = points;\r\n                            // geometry.computeLineDistances();\r\n                            // geometry.lineDistancesNeedUpdate = true;\r\n                            circle.geometry.verticesNeedUpdate = true;\r\n                        });\r\n                        object.scale.x = object.scale.y = object.scale.z = 0.001 + 0.3 * state.pow;\r\n                        object.lookAt(camera.position);\r\n                        // d++;\r\n                    }\r\n\r\n                    var position = OBJECTS.ribbon.cameraSpline.getPointAt((index + 0.5) / stepper.steps.length);\r\n\r\n                    object.position.copy(position);\r\n\r\n                    return {\r\n                        add: add,\r\n                        remove: remove,\r\n                        update: update,\r\n                        object: object,\r\n                        material: material,\r\n                        state: state,\r\n                    };\r\n                }\r\n        */\r\n        function createObjects() {\r\n            // OBJECTS.tube = getObjectTube();\r\n            OBJECTS.ribbon = getObjectRibbon();\r\n            OBJECTS.circles = new Array(stepper.steps).fill(null);\r\n        }\r\n\r\n        function createAnalyser() {\r\n            var source, ctx, actx = (window.AudioContext || window.webkitAudioContext);\r\n            source = null;\r\n            ctx = new actx();\r\n            analyser = ctx.createAnalyser();\r\n            audio = new Audio();\r\n            audio.src = options.audioUrl;\r\n            audio.controls = true;\r\n            audio.addEventListener('canplay', function() {\r\n                var bufferLength;\r\n                console.log('audio canplay');\r\n                source = ctx.createMediaElementSource(audio);\r\n                source.connect(analyser);\r\n                source.connect(ctx.destination);\r\n                analyser.fftSize = options.bands * 2;\r\n                bufferLength = analyser.frequencyBinCount;\r\n                console.log('bufferLength', bufferLength);\r\n                analyserData = new Uint8Array(bufferLength);\r\n                return analyserData;\r\n            });\r\n            audio.volume = options.audioVolume;\r\n            return audio.play();\r\n        }\r\n\r\n        function updateAnalyser() {\r\n            if (analyserData) {\r\n                analyser.getByteFrequencyData(analyserData);\r\n                angular.forEach(OBJECTS.circles, function(circle) {\r\n                    if (circle && circle.state.enabled) {\r\n                        circle.update();\r\n                    }\r\n                });\r\n            }\r\n        }\r\n\r\n        function loop() {\r\n            stats.begin();\r\n            render();\r\n            stats.end();\r\n            requestAnimationFrame(loop);\r\n        }\r\n\r\n        function render() {\r\n            if (controls) {\r\n                controls.update();\r\n            }\r\n            if (OBJECTS.tube) {\r\n                OBJECTS.tube.update();\r\n            }\r\n            if (OBJECTS.ribbon) {\r\n                OBJECTS.ribbon.update();\r\n            }\r\n            updateAnalyser();\r\n            renderer.render(scene, camera);\r\n        }\r\n\r\n        createScene();\r\n        // createLights();\r\n        createObjects();\r\n        createAnalyser();\r\n        addGui();\r\n        onChange();\r\n        loop();\r\n\r\n        function addGui() {\r\n            gui = new dat.GUI();\r\n            gui.closed = true;\r\n            gui.add(options, 'cameraHeight', 20.0, 100.0).onChange(onChange);\r\n            gui.add(options, 'targetHeight', 20.0, 100.0).onChange(onChange);\r\n            /*\r\n            var cameraPosition = gui.addFolder('CameraPosition');\r\n            cameraPosition.add(options.camera.position, 'x', -300, 300).onChange(onChangePositions);\r\n            cameraPosition.add(options.camera.position, 'y', -300, 300).onChange(onChangePositions);\r\n            cameraPosition.add(options.camera.position, 'z', -300, 300).onChange(onChangePositions);\r\n            var cameraTarget = gui.addFolder('cameraTarget');\r\n            cameraTarget.add(options.camera.target, 'x', -300, 300).onChange(onChangePositions);\r\n            cameraTarget.add(options.camera.target, 'y', -300, 300).onChange(onChangePositions);\r\n            cameraTarget.add(options.camera.target, 'z', -300, 300).onChange(onChangePositions);\r\n            */\r\n            var circlePosition = gui.addFolder('circlePosition');\r\n            circlePosition.add(options.circle.position, 'x', -300, 300).onChange(onChangePositions);\r\n            circlePosition.add(options.circle.position, 'y', -300, 300).onChange(onChangePositions);\r\n            circlePosition.add(options.circle.position, 'z', -300, 300).onChange(onChangePositions);\r\n            gui.addColor(options.colors, 'background').onChange(onChange);\r\n            gui.addColor(options.colors, 'lines').onChange(onChange);\r\n            gui.add(options, 'audioVolume', 0.01, 1.0).onChange(onChange);\r\n            gui.add(options, 'audioStrength', 10, 100).onChange(onChange);\r\n            gui.add(options, 'noiseStrength', 10, 100).onChange(onChange);\r\n            gui.add(options, 'circularStrength', 0.01, 0.90).onChange(onChange);\r\n            gui.add(options, 'randomize');\r\n            return gui;\r\n        }\r\n\r\n        function addListeners() {\r\n            function handleMouseMove(event) {\r\n                mouse = { x: event.clientX, y: event.clientY };\r\n            }\r\n\r\n            function handleMouseDown(event) {\r\n                //\r\n            }\r\n\r\n            function handleMouseUp(event) {\r\n                //\r\n            }\r\n\r\n            function handleTouchStart(event) {\r\n                if (event.touches.length > 1) {\r\n                    event.preventDefault();\r\n                    mousePos = { x: event.touches[0].pageX, y: event.touches[0].pageY };\r\n                }\r\n            }\r\n\r\n            function handleTouchEnd(event) {\r\n                mousePos = { x: windowHalfX, y: windowHalfY };\r\n            }\r\n\r\n            function handleTouchMove(event) {\r\n                if (event.touches.length == 1) {\r\n                    event.preventDefault();\r\n                    mousePos = { x: event.touches[0].pageX, y: event.touches[0].pageY };\r\n                }\r\n            }\r\n\r\n            function onWindowResize() {\r\n                width = window.innerWidth;\r\n                height = window.innerHeight;\r\n                w2 = width / 2;\r\n                h2 = height / 2;\r\n                renderer.setSize(width, height);\r\n                camera.aspect = width / height;\r\n                camera.updateProjectionMatrix();\r\n            }\r\n            window.addEventListener('resize', onWindowResize, false);\r\n            /*\r\n            document.addEventListener('mousemove', handleMouseMove, false);\r\n            document.addEventListener('mousedown', handleMouseDown, false);\r\n            document.addEventListener('mouseup', handleMouseUp, false);\r\n            document.addEventListener('touchstart', handleTouchStart, false);\r\n            document.addEventListener('touchend', handleTouchEnd, false);\r\n            document.addEventListener('touchmove', handleTouchMove, false);\r\n            */\r\n        }\r\n\r\n        function getSprite() {\r\n            var canvas = document.createElement('canvas');\r\n            canvas.width = 128;\r\n            canvas.height = 128;\r\n            var ctx = canvas.getContext('2d');\r\n            var gradient = ctx.createRadialGradient(\r\n                canvas.width / 2,\r\n                canvas.height / 2,\r\n                0,\r\n                canvas.width / 2,\r\n                canvas.height / 2,\r\n                canvas.width / 2\r\n            );\r\n            /*\r\n            gradient.addColorStop(0, 'rgba(0,0,0,1)');\r\n            gradient.addColorStop(0.2, 'rgba(0,0,0,1)');\r\n            gradient.addColorStop(0.22, 'rgba(0,0,0,.2)');\r\n            gradient.addColorStop(1, 'rgba(0,0,0,0)');\r\n            ctx.fillStyle = gradient;\r\n            */\r\n            ctx.fillStyle = \"#000000\";\r\n            ctx.fillRect(0, 0, canvas.width, canvas.height);\r\n            return canvas;\r\n        }\r\n\r\n        function getPerlinNoise(width, height) {\r\n            var size = width * height,\r\n                data = new Uint8Array(size),\r\n                perlin = new ImprovedNoise(),\r\n                quality = 1,\r\n                z = Math.random() * 100;\r\n            for (var j = 0; j < 4; j++) {\r\n                for (var i = 0; i < size; i++) {\r\n                    var x = i % width,\r\n                        y = ~~(i / width);\r\n                    data[i] += Math.abs(perlin.noise(x / quality, y / quality, z) * quality * 1.75);\r\n                }\r\n                quality *= 5;\r\n            }\r\n            return data;\r\n        }\r\n\r\n        function ImprovedNoise() {\r\n            var p = [151, 160, 137, 91, 90, 15, 131, 13, 201, 95, 96, 53, 194, 233, 7, 225, 140, 36, 103, 30, 69, 142, 8, 99, 37, 240, 21, 10,\r\n                23, 190, 6, 148, 247, 120, 234, 75, 0, 26, 197, 62, 94, 252, 219, 203, 117, 35, 11, 32, 57, 177, 33, 88, 237, 149, 56, 87,\r\n                174, 20, 125, 136, 171, 168, 68, 175, 74, 165, 71, 134, 139, 48, 27, 166, 77, 146, 158, 231, 83, 111, 229, 122, 60, 211,\r\n                133, 230, 220, 105, 92, 41, 55, 46, 245, 40, 244, 102, 143, 54, 65, 25, 63, 161, 1, 216, 80, 73, 209, 76, 132, 187, 208,\r\n                89, 18, 169, 200, 196, 135, 130, 116, 188, 159, 86, 164, 100, 109, 198, 173, 186, 3, 64, 52, 217, 226, 250, 124, 123, 5,\r\n                202, 38, 147, 118, 126, 255, 82, 85, 212, 207, 206, 59, 227, 47, 16, 58, 17, 182, 189, 28, 42, 223, 183, 170, 213, 119,\r\n                248, 152, 2, 44, 154, 163, 70, 221, 153, 101, 155, 167, 43, 172, 9, 129, 22, 39, 253, 19, 98, 108, 110, 79, 113, 224, 232,\r\n                178, 185, 112, 104, 218, 246, 97, 228, 251, 34, 242, 193, 238, 210, 144, 12, 191, 179, 162, 241, 81, 51, 145, 235, 249,\r\n                14, 239, 107, 49, 192, 214, 31, 181, 199, 106, 157, 184, 84, 204, 176, 115, 121, 50, 45, 127, 4, 150, 254, 138, 236, 205,\r\n                93, 222, 114, 67, 29, 24, 72, 243, 141, 128, 195, 78, 66, 215, 61, 156, 180\r\n            ];\r\n            for (var i = 0; i < 256; i++) {\r\n                p[256 + i] = p[i];\r\n            }\r\n\r\n            function fade(t) {\r\n                return t * t * t * (t * (t * 6 - 15) + 10);\r\n            }\r\n\r\n            function lerp(t, a, b) {\r\n                return a + t * (b - a);\r\n            }\r\n\r\n            function grad(hash, x, y, z) {\r\n                var h = hash & 15;\r\n                var u = h < 8 ? x : y,\r\n                    v = h < 4 ? y : h == 12 || h == 14 ? x : z;\r\n                return ((h & 1) === 0 ? u : -u) + ((h & 2) === 0 ? v : -v);\r\n            }\r\n\r\n            return {\r\n                noise: function(x, y, z) {\r\n                    var floorX = Math.floor(x),\r\n                        floorY = Math.floor(y),\r\n                        floorZ = Math.floor(z);\r\n                    var X = floorX & 255,\r\n                        Y = floorY & 255,\r\n                        Z = floorZ & 255;\r\n                    x -= floorX;\r\n                    y -= floorY;\r\n                    z -= floorZ;\r\n                    var xMinus1 = x - 1,\r\n                        yMinus1 = y - 1,\r\n                        zMinus1 = z - 1;\r\n                    var u = fade(x),\r\n                        v = fade(y),\r\n                        w = fade(z);\r\n                    var A = p[X] + Y,\r\n                        AA = p[A] + Z,\r\n                        AB = p[A + 1] + Z,\r\n                        B = p[X + 1] + Y,\r\n                        BA = p[B] + Z,\r\n                        BB = p[B + 1] + Z;\r\n                    return lerp(w, lerp(v, lerp(u, grad(p[AA], x, y, z),\r\n                                grad(p[BA], xMinus1, y, z)),\r\n                            lerp(u, grad(p[AB], x, yMinus1, z),\r\n                                grad(p[BB], xMinus1, yMinus1, z))),\r\n                        lerp(v, lerp(u, grad(p[AA + 1], x, y, zMinus1),\r\n                                grad(p[BA + 1], xMinus1, y, z - 1)),\r\n                            lerp(u, grad(p[AB + 1], x, yMinus1, zMinus1),\r\n                                grad(p[BB + 1], xMinus1, yMinus1, zMinus1))));\r\n\r\n                }\r\n            };\r\n        }\r\n\r\n        function getObjectTube() {\r\n            var options = {\r\n                path: spline,\r\n                tubularSegments: 500,\r\n                radius: 1,\r\n                radiusSegments: 2,\r\n                closed: true,\r\n            }\r\n            var spline = new THREE.CatmullRomCurve3([\r\n                new THREE.Vector3(-400, -400, 0),\r\n                new THREE.Vector3(400, -400, 0),\r\n                new THREE.Vector3(1400, -400, 0),\r\n                new THREE.Vector3(400, 400, 0),\r\n                new THREE.Vector3(-400, 400, 0)\r\n            ]);\r\n            spline.type = 'catmullrom';\r\n            spline.closed = true;\r\n\r\n            var object = new THREE.Object3D();\r\n            scene.add(object);\r\n\r\n            var material = new THREE.MeshLambertMaterial({\r\n                color: 0xffffff\r\n            });\r\n            var geometry = new THREE.TubeBufferGeometry(spline, options.tubularSegments, options.radius, options.radiusSegments, options.closed);\r\n            var group = new THREE.Mesh(geometry, material);\r\n            object.add(group);\r\n\r\n            // if (group !== undefined) {\r\n            //     object.remove(group);\r\n            //     group.children[0].geometry.dispose();\r\n            //     group.children[1].geometry.dispose();\r\n            // }            \r\n\r\n            /*\r\n            var geometry = new THREE.Geometry();\r\n            geometry.vertices = spline.getPoints(500);\r\n            var line = new MeshLine();\r\n            line.setGeometry(geometry);\r\n            // line.setGeometry( geometry, function( p ) { return 2; } ); // makes width 2 * lineWidth\r\n            // line.setGeometry( geometry, function( p ) { return 1 - p; } ); // makes width taper\r\n            // line.setGeometry( geometry, function( p ) { return 2 + Math.sin( 50 * p ); } ); // makes width sinusoidal\r\n            var material = new MeshLineMaterial({\r\n                color: new THREE.Color(0xffffff),\r\n                lineWidth: 4,\r\n            });\r\n            var mesh = new THREE.Mesh(line.geometry, material);\r\n            object.add(mesh);\r\n            */\r\n\r\n            function add() {\r\n                console.log('OBJECTS.tube.add');\r\n                scene.add(object);\r\n            }\r\n\r\n            function remove() {\r\n                console.log('OBJECTS.tube.remove');\r\n                scene.remove(object);\r\n            }\r\n\r\n            var d = 0; // iterator\r\n            var a = new THREE.Vector3(); // normal\r\n            var b = new THREE.Vector3(); // binormal\r\n\r\n            function update() {\r\n                var duration = 20 * 1000;\r\n                var scale = 1;\r\n                var offset = 15;\r\n                var lookAhead = true;\r\n                var msec = Date.now();\r\n                var pow = (msec % duration) / duration;\r\n                var dir = spline.getTangentAt(pow);\r\n                var tangents = geometry.tangents;\r\n                var binormals = geometry.binormals;\r\n                var x = pow * tangents.length;\r\n                var c = Math.floor(x);\r\n                var n = (c + 1) % tangents.length;\r\n                b.subVectors(binormals[n], binormals[c]);\r\n                b.multiplyScalar(x - c).add(binormals[c]);\r\n                a.copy(b).cross(dir);\r\n                var p = spline.getPointAt(pow);\r\n                p.multiplyScalar(scale);\r\n                p.add(a.clone().multiplyScalar(offset));\r\n                camera.position.copy(p);\r\n                var lookAt;\r\n                if (lookAhead) {\r\n                    // using arclength for stablization in look ahead\r\n                    lookAt = spline.getPointAt((pow + 30 / spline.getLength()) % 1).multiplyScalar(scale);\r\n                } else {\r\n                    // camera orientation 2 - up orientation via normal\r\n                    lookAt = new THREE.Vector3().copy(p).add(dir);\r\n                }\r\n                camera.matrix.lookAt(camera.position, lookAt, a);\r\n                camera.rotation.setFromRotationMatrix(camera.matrix, camera.rotation.order);\r\n                d++;\r\n            }\r\n\r\n            return {\r\n                object: object,\r\n                spline: spline,\r\n                geometry: geometry,\r\n                add: add,\r\n                remove: remove,\r\n                update: update,\r\n            };\r\n        }\r\n\r\n    }]);\r\n\r\n}());"]}