{"version":3,"sources":["docs/js/app.js"],"names":["angular","module","config","$httpProvider","$locationProvider","$routeProvider","html5Mode","hashPrefix","when","templateUrl","controller","controllerAs","otherwise","run","$rootScope","factory","SceneOptions","StepperService","DatGui","onOptionsChanged","params","step","stepper","getCurrentStep","colors","background","options","lines","overLines","camera","cameraHeight","targetHeight","circle","position","copy","$broadcast","onKeyDown","e","key","toLowerCase","ctrlKey","$","document","find","toggleClass","gui","dat","GUI","randomize","controllers","i","length","c","__min","value","__max","Math","random","setValue","updateDisplay","__color","r","floor","g","b","hex","__controllers","forEach","__folders","folder","saveJson","json","steps","map","item","THREE","Color","getHexString","console","log","downloadFile","closed","add","listen","onChange","circlePosition","addFolder","addColor","audio","element","window","on","a","createElement","body","appendChild","style","data","fileName","pretty","JSON","stringify","blob","Blob","type","url","URL","createObjectURL","href","download","click","revokeObjectURL","directive","restrict","link","scope","attributes","model","Init","scrollbar","Scrollbar","init","native","$watch","contentEl","offsetHeight","height","update","speed","damping","overscrollDamping","thumbMinSize","continuousScrolling","alwaysShowTracks","setTimeout","app","$timeout","unSlick","hasClass","slick","onSlick","arrows","dots","fade","infinite","draggable","asNavFor","useBackground","cssEase","initialSlide","current","showLetters","letters","TweenMax","staggerTo","delay","y","x","ease","Power3","easeInOut","className","onComplete","addClass","hideLetters","removeClass","onInit","$root","onBeforeChange","event","currentSlide","nextSlide","slicking","previouse","onAfterChange","onWheel","deltaX","deltaY","preventDefault","removeListeners","off","$watchCollection","slickTunnel","items","$on","$scope","index","lazyLoad","slickBackgrounds","splitText","nodes","childNodes","Array","prototype","slice","call","html","rows","filter","node","nodeType","text","trim","textContent","nodeName","push","innerHTML","row","appendTo","el","words","split","w","word","l","letter","from","to","onChangeYears","updateYear","yearFrom","parseInt","years","yearTo","easing","easeOut","TweenLite","roundProps","onUpdate","newValue","oldValue","$route","$routeParams","$ngSilentLocation","AnalyserService","openDetail","silent","detailUrl","detail","active","closeDetail","scene","objects","yearsKey","then","$$route","originalPath","indexOf","service","$q","$http","onCanPlay","source","bufferLength","analyserContext","createMediaElementSource","smoothingTimeConstant","connect","analyser","destination","fftSize","bands","frequencyBinCount","Uint8Array","onPlay","playing","onPause","onEnded","setAudioUrl","$audioUrl","audioUrl","src","volume","play","isPlaying","pause","isActive","paused","ended","toggle","setStep","getByteFrequencyData","unlock","deferred","defer","device","ios","unlocked","resolve","doUnlock","playbackState","PLAYING_STATE","FINISHED_STATE","promise","ctx","audioContext","createBufferSource","buffer","createBuffer","noteOn","this","AudioContext","webkitAudioContext","createAnalyser","Audio","addEventListener","$sce","getItems","titles","paragraphs","audioTitles","audios","backgrounds","contrasts","ribbon","fill","v","id","title","chapter","paragraph","round","contrast","Vector3","texture","orchestra","get","response","String","titleTrusted","trustAsHtml","values","pow","navStep","error","reject","clearTweens","tweens","pop","kill","tweenTo","duration","callback","Power2","setTweens","previous","color","css","getStepAtIndex","max","next","min","$active","top","width","-webkit-transform","-moz-transform","-ms-transform","transform","getPerlinNoise","size","perlin","ImprovedNoise","quality","z","j","abs","noise","t","lerp","grad","hash","h","u","p","floorX","floorY","floorZ","X","Y","Z","xMinus1","yMinus1","zMinus1","A","AA","AB","B","BA","BB","getRandomRange","allowNegatives","n","updateParallax","parallax","mouse","cos","sin","getObjectRibbon","object","remove","updateRibbon","s","cpow","tpow","mod","cameraSpline","getPointAt","material","uniforms","visibility","target","lookAt","resolution","Vector2","innerWidth","innerHeight","MeshLineMaterial","lineWidth","opacity","transparent","depthTest","sizeAttenuation","near","far","prev","points","spline","CatmullRomCurve3","geometry","Geometry","vertices","getPoints","line","MeshLine","setGeometry","Mesh","getObjectCircles","state","adding","Date","now","removing","enabled","tween","Elastic","getLine1","addPoints","points1","useMeshLines","meshLine","meshLineGeometries1","meshLines1","materialLine1","LineLoop","material1","clone","group1","getLine2","points2","meshLineGeometries2","meshLines2","materialLine2","material2","group2","pn","ratio","degrees","radians","PI","radius","increment","sincos","base","updateLine","audioStrength","noiseStrength","circularStrength","noiseMap","noiseMap1","noiseMap2","aia","aib","audioPow","nd","nia","nib","noisePow","linePow","ln","verticesNeedUpdate","updateCircle","lines1","lines2","rotation","dummy","dummyMobilePosition","scale","TextureLoader","load","wrapS","RepeatWrapping","wrapT","repeat","set","MeshBasicMaterial","LineBasicMaterial","Object3D","PlaneGeometry","plane","render","controls","circles","renderer","loop","stats","begin","end","requestAnimationFrame","w2","h2","Scene","PerspectiveCamera","WebGLRenderer","alpha","antialias","logarithmicDepthBuffer","setClearColor","setSize","sortObjects","Stats","domElement","dom","onWindowResize","aspect","updateProjectionMatrix","handleMouseMove","halfW","halfH","clientX","clientY","Number","isIOS","test","navigator","userAgent","MSStream","isMobileAndTabled","check","substr","vendor","opera","constant","mobile"],"mappings":"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","file":"app.min.js","sourcesContent":["/* global angular */\n\n(function() {\n    \"use strict\";\n\n    var app = angular.module('app', ['ngSilent', 'ngRoute', 'ngSanitize', 'jsonFormatter']);\n\n}());\n/* global angular */\n\n(function() {\n    \"use strict\";\n\n    var app = angular.module('app');\n\n    app.config(['$httpProvider', function($httpProvider) {\n        // $httpProvider.defaults.withCredentials = true;\n    }]);\n\n}());\n/* global angular */\n\n(function() {\n    \"use strict\";\n\n    var app = angular.module('app');\n\n    app.config(['$locationProvider', '$routeProvider', function($locationProvider, $routeProvider) {\n\n        // HTML5 MODE url writing method (false: #/anchor/use, true: /html5/url/use)\n        $locationProvider.html5Mode(false);\n        $locationProvider.hashPrefix('');\n\n        $routeProvider.when('/years/', {\n            templateUrl: function() {\n                return 'partials/years.html';\n            },\n            controller: 'YearsCtrl',\n            controllerAs: 'yearsCtrl',\n\n        }).when('/years/:yearsKey', {\n            templateUrl: function() {\n                return 'partials/years.html';\n            },\n            controller: 'YearsCtrl',\n            controllerAs: 'yearsCtrl',\n\n        }).when('/years/:yearsKey/detail', {\n            templateUrl: function() {\n                return 'partials/years.html';\n            },\n            controller: 'YearsCtrl',\n            controllerAs: 'yearsCtrl',\n\n        });\n\n        $routeProvider.otherwise('/years');\n\n    }]);\n\n}());\n/* global angular */\n\n(function() {\n    \"use strict\";\n\n    var app = angular.module('app');\n\n    app.run(['$rootScope', function($rootScope) {\n\n    }]);\n\n}());\n/* global angular */\n\n(function() {\n    \"use strict\";\n\n    var app = angular.module('app');\n\n    app.factory('DatGui', ['$rootScope', 'SceneOptions', 'StepperService', function($rootScope, SceneOptions, StepperService) {\n\n        var downloadFile = function downloadFile() {\n            var a = document.createElement(\"a\");\n            document.body.appendChild(a);\n            a.style = \"display: none\";\n            return function(data, fileName, json, pretty) {\n                if (json) {\n                    if (pretty) {\n                        data = JSON.stringify(data, null, 2); // spacing level = 2\n                    } else {\n                        data = JSON.stringify(data);\n                    }\n                }\n                var blob = new Blob([data], { type: \"octet/stream\" }),\n                    url = window.URL.createObjectURL(blob);\n                a.href = url;\n                a.download = fileName;\n                a.click();\n                window.URL.revokeObjectURL(url);\n            };\n        }();\n\n        function DatGui() {\n            var options = SceneOptions;\n            var stepper = StepperService;\n            var gui = new dat.GUI();\n\n            options.randomize = function() {\n                // console.log(gui);\n                function randomize(controllers) {\n                    for (var i = 0; i < controllers.length; i++) {\n                        var c = controllers[i];\n                        if (c.__min) {\n                            var value = c.__min + (c.__max - c.__min) * Math.random();\n                            // options[c.property] = value;\n                            c.setValue(value);\n                            c.updateDisplay();\n                        }\n                        if (c.__color) {\n                            c.__color.r = Math.floor(Math.random() * 255);\n                            c.__color.g = Math.floor(Math.random() * 255);\n                            c.__color.b = Math.floor(Math.random() * 255);\n                            c.updateDisplay();\n                            c.setValue(c.__color.hex);\n                        }\n                    }\n                }\n                randomize(gui.__controllers);\n                angular.forEach(gui.__folders, function(folder) {\n                    randomize(folder.__controllers);\n                });\n                // console.log(options.circle.position);\n                // console.log(stepper.step.circle.position);\n            };\n\n            options.saveJson = function() {\n                var json = stepper.steps.map(function(item) {\n                    item = angular.copy(item);\n                    var colors = {\n                        background: '#' + new THREE.Color(item.colors.background).getHexString(),\n                        lines: '#' + new THREE.Color(item.colors.lines).getHexString(),\n                        overLines: '#' + new THREE.Color(item.colors.overLines).getHexString(),\n                    }\n                    item.colors = colors;\n                    return item;\n                });\n                console.log('saveJson', json);\n                downloadFile(json, 'rossini.js', true, true);\n            };\n\n            function onOptionsChanged(params) {\n                var step = stepper.getCurrentStep();\n                step.colors.background = options.colors.background;\n                step.colors.lines = options.colors.lines;\n                step.colors.overLines = options.colors.overLines;\n                step.camera.cameraHeight = options.camera.cameraHeight;\n                step.camera.targetHeight = options.camera.targetHeight;\n                step.circle.position.copy(options.circle.position);\n                $rootScope.$broadcast('onOptionsChanged');\n            }\n\n            gui.closed = true;\n            gui.add(options.camera, 'cameraHeight', -10.0, 30.0).listen().onChange(onOptionsChanged);\n            gui.add(options.camera, 'targetHeight', -10.0, 30.0).listen().onChange(onOptionsChanged);\n            var circlePosition = gui.addFolder('circlePosition');\n            circlePosition.add(options.circle.position, 'x', -300, 300).listen().onChange(onOptionsChanged);\n            circlePosition.add(options.circle.position, 'y', -300, 300).listen().onChange(onOptionsChanged);\n            circlePosition.add(options.circle.position, 'z', -300, 300).listen().onChange(onOptionsChanged);\n            var colors = gui.addFolder('colors');\n            colors.addColor(options.colors, 'background').listen().onChange(onOptionsChanged);\n            colors.addColor(options.colors, 'lines').listen().onChange(onOptionsChanged);\n            colors.addColor(options.colors, 'overLines').listen().onChange(onOptionsChanged);\n            gui.add(options.audio, 'volume', 0.01, 1.0).onChange(onOptionsChanged);\n            gui.add(options, 'audioStrength', 10, 100).onChange(onOptionsChanged);\n            gui.add(options, 'noiseStrength', 10, 100).onChange(onOptionsChanged);\n            gui.add(options, 'circularStrength', 0.01, 0.90).onChange(onOptionsChanged);\n            gui.add(options, 'randomize');\n            gui.add(options, 'saveJson');\n\n            onOptionsChanged();\n\n            angular.element(window).on('keydown', onKeyDown);\n\n            function onKeyDown(e) {\n                var key = e.key.toLowerCase();\n                if (key === 'a' && e.ctrlKey) {\n                    $(document).find('body').toggleClass('gui-active');\n                }\n            }\n\n            return gui;\n        }\n\n        return DatGui;\n\n    }]);\n\n}());\n/* global angular */\n\n(function() {\n    \"use strict\";\n\n    var app = angular.module('app');\n\n    app.directive('scrollbar', [function() {\n        return {\n            restrict: 'A',\n            link: function(scope, element, attributes, model) {\n                var native = element[0];\n                var options = {\n                    speed: 1,\n                    damping: 0.1,\n                    overscrollDamping: 1.0,\n                    thumbMinSize: 20,\n                    continuousScrolling: true,\n                    alwaysShowTracks: false\n                };\n\n                function Init() {\n                    var scrollbar = Scrollbar.init(native, options);\n                    // console.log(scrollbar);\n                    scope.$watch(scrollbar.contentEl.offsetHeight, function(height) {\n                        scrollbar.update();\n                    });\n                }\n\n                setTimeout(Init, 100);\n            }\n        };\n    }]);\n\n}());\n/* global angular */\n\n(function() {\n    \"use strict\";\n\n    var app = angular.module('app');\n\n    app.directive('slickTunnel', ['$timeout', 'StepperService', 'SceneOptions', function($timeout, StepperService, SceneOptions) {\n        return {\n            restrict: 'A',\n            link: function(scope, element, attributes) {\n\n                var options = SceneOptions;\n                var stepper = StepperService;\n\n                function unSlick() {\n                    if (element.hasClass('slick-initialized')) {\n                        element.slick('unslick');\n                    }\n                }\n\n                function onSlick() {\n                    unSlick();\n                    element.slick({\n                        arrows: false,\n                        dots: false,\n                        fade: true,\n                        speed: 1100,\n                        infinite: false,\n                        draggable: false,\n                        asNavFor: options.useBackground ? '.tunnel-bg' : null,\n                        cssEase: 'cubic-bezier(0.7, 0, 0.3, 1)',\n                        initialSlide: stepper.current,\n                    });\n                }\n\n                function showLetters() {\n                    var letters = $('.slick-active .splitted-letter');\n                    TweenMax.staggerTo(letters, 1, {\n                        delay: 0.2,\n                        y: 0,\n                        x: 0,\n                        ease: Power3.easeInOut,\n                        className: '+=viewed',\n                        onComplete: function() {\n                            $('.slick-active .cta').addClass('active');\n                        }\n                    }, 0.009);\n                }\n\n                function hideLetters() {\n                    var letters = $('.slick-active .splitted-letter');\n                    TweenMax.staggerTo(letters, 1, {\n                        delay: 0,\n                        y: 100,\n                        x: 50,\n                        ease: Power3.easeInOut,\n                        className: '-=viewed'\n                    }, 0.009);\n                    $('.slick-active .cta').removeClass('active');\n                }\n\n                function onInit() {\n                    // console.log('onInit');\n                    $timeout(function() {\n                        showLetters();\n                    }, 1000);\n                    scope.$root.$broadcast('onSlickInit');\n                }\n\n                function onBeforeChange(event, slick, currentSlide, nextSlide) {\n                    stepper.slicking = true;\n                    hideLetters();\n                    // console.log('onBeforeChange');               \n                    scope.$root.$broadcast('onSlickBeforeChange', { current: nextSlide, previouse: currentSlide });\n                }\n\n                function onAfterChange(event, slick, currentSlide) {\n                    stepper.slicking = false;\n                    showLetters();\n                    console.log('onAfterChange');\n                    scope.$root.$broadcast('onSlickAfterChange', { current: currentSlide });\n                }\n\n                function onWheel(e) {\n                    if (stepper.slicking) {\n                        return;\n                    }\n                    if (element.hasClass('slick-initialized')) {\n                        if (e.deltaX > 0 || e.deltaY < 0) {\n                            element.slick('slickNext');\n                        } else if (e.deltaX < 0 || e.deltaY > 0) {\n                            element.slick('slickPrev');\n                        }\n                    }\n                    e.preventDefault();\n                }\n\n                function addListeners() {\n                    element\n                        .on('init', onInit)\n                        .on('beforeChange', onBeforeChange)\n                        .on('afterChange', onAfterChange)\n                        .on('mousewheel', onWheel);\n                }\n\n                function removeListeners() {\n                    element\n                        .off('init', onInit)\n                        .off('beforeChange', onBeforeChange)\n                        .off('afterChange', onAfterChange)\n                        .off('mousewheel', onWheel);\n                }\n\n                addListeners();\n\n                scope.$watchCollection(attributes.slickTunnel, function(items) {\n                    if (items && items.length) {\n                        onSlick();\n                    }\n                });\n\n                scope.$on('onGoStep', function($scope, index) {\n                    if (element.hasClass('slick-initialized')) {\n                        element.slick('slickGoTo', index);\n                    }\n                });\n\n                scope.$on('$destroy', function() {\n                    removeListeners();\n                    unSlick();\n                });\n            }\n        };\n    }]);\n\n    app.directive('slickBackgrounds', [function() {\n        return {\n            restrict: 'A',\n            link: function(scope, element, attributes) {\n\n                function unSlick() {\n                    if (element.hasClass('slick-initialized')) {\n                        element.slick('unslick');\n                    }\n                }\n\n                function onSlick() {\n                    unSlick();\n                    element.slick({\n                        arrows: false,\n                        dots: false,\n                        fade: true,\n                        speed: 1100,\n                        infinite: false,\n                        lazyLoad: 'ondemand',\n                        cssEase: 'cubic-bezier(0.7, 0, 0.3, 1)'\n                    });\n                }\n\n                scope.$watchCollection(attributes.slickBackgrounds, function(items) {\n                    if (items && items.length) {\n                        setTimeout(onSlick, 1)\n                    }\n                });\n\n                scope.$on('$destroy', function() {\n                    unSlick();\n                });\n            }\n        };\n    }]);\n\n}());\n/* global angular */\n\n(function() {\n    \"use strict\";\n\n    var app = angular.module('app');\n\n    app.directive('splitText', [function() {\n        return {\n            restrict: 'A',\n            link: function(scope, element, attributes) {\n\n                function splitText() {\n\n                    var nodes = element[0].childNodes;\n                    nodes = Array.prototype.slice.call(nodes, 0);\n\n                    element.html('').addClass('active');\n\n                    var rows = [\n                        []\n                    ];\n\n                    nodes.filter(function(node) {\n                        return node.nodeType === 3 || node.nodeType === 1;\n                    }).map(function(node) {\n                        if (node.nodeType === 3) {\n                            node = { text: $.trim(node.textContent), element: 'span' };\n                        } else {\n                            if (node.nodeName.toLowerCase() === 'br') {\n                                rows.push([]);\n                                return;\n                            }\n                            node = { text: $.trim(node.innerHTML), element: node.nodeName };\n                        }\n                        if (node.text !== '') {\n                            rows[rows.length - 1].push(node);\n                        }\n                    });\n\n                    for (var r = 0; r < rows.length; r++) {\n                        /* Riga */\n                        // console.log('riga ' + r, rows[r]);\n                        var row = rows[r];\n                        $('<div class=\"splitted-row\"></div>').appendTo(element);\n\n                        /* Elemento */\n                        for (var e = 0; e < row.length; e++) {\n                            var el = row[e];\n                            var type = el.element.toLowerCase();\n                            var text = el.text;\n                            // console.log('\\telemento ' + e, type, text);\n\n                            /* Parola */\n                            var words = text.split(' ');\n                            for (var w = 0; w < words.length; w++) {\n                                // console.log('\\t\\tword ' + w, words[w]);\n                                $('<' + type + ' class=\"splitted-word\"></' + type + '>').appendTo($('.splitted-row:last'), element);\n\n                                /* Lettera */\n                                var word = words[w];\n                                var letters = word.split('');\n                                for (var l = 0; l < letters.length; l++) {\n                                    // console.log('\\t\\t\\tlettera' + l, letters[l]);\n                                    var letter = letters[l];\n                                    $('<span class=\"splitted-letter\" data-content=\"' + letter + '\">' + letter + '</span>').appendTo($('.splitted-word:last'), element);\n                                }\n                                $('<span class=\"splitted-space\">&nbsp;</span>').appendTo($('.splitted-word:last'), element);\n                            }\n                        }\n                    }\n                }\n\n                setTimeout(function() {\n                    splitText();\n                }, 1);\n\n            }\n        };\n    }]);\n\n}());\n/* global angular */\n\n(function() {\n    \"use strict\";\n\n    var app = angular.module('app');\n\n    app.directive('yearsFrom', [function() {\n        return {\n            restrict: 'A',\n            scope: {\n                from: '=yearsFrom',\n                to: '=yearsTo',\n            },\n            link: function(scope, element, attributes) {\n\n                function onChangeYears() {\n                    // console.log('onChangeYears', scope.from, scope.to);\n\n                    var yearFrom = element.find('.tunnel-year__from'),\n                        yearTo = element.find('.tunnel-year__to'),\n                        time = 2,\n                        easing = Power3.easeOut,\n                        years = {\n                            from: yearFrom.html(),\n                            to: yearTo.html()\n                        };\n\n                    if (scope.to) {\n                        element.removeClass('one-year');\n                        TweenLite.to(years, time, { to: scope.to, roundProps: 'year', onUpdate: updateYear, ease: easing });\n                    } else {\n                        element.addClass('one-year');\n                        TweenLite.to(years, time, { to: scope.from, roundProps: 'year', onUpdate: updateYear, ease: easing });\n                    }\n\n                    TweenLite.to(years, time, { from: scope.from, roundProps: 'year', onUpdate: updateYear, ease: easing });\n\n                    function updateYear() {\n                        yearFrom.html(parseInt(years.from));\n                        yearTo.html(parseInt(years.to));\n                    }\n                }\n\n                scope.$watch('from', function(newValue, oldValue) {\n                    if (newValue) {\n                        onChangeYears();\n                    }\n                });\n\n            }\n        };\n    }]);\n\n}());\n/* global angular */\n\n(function() {\n    \"use strict\";\n\n    var app = angular.module('app');\n\n    app.controller('YearsCtrl', ['$scope', '$route', '$routeParams', '$ngSilentLocation', 'SceneOptions', 'StepperService', 'AnalyserService', 'DatGui', '$timeout', function($scope, $route, $routeParams, $ngSilentLocation, SceneOptions, StepperService, AnalyserService, DatGui, $timeout) {\n\n        var scene = {\n            objects: {},\n            options: SceneOptions,\n            stepper: StepperService,\n        };\n\n        var objects = scene.objects;\n        var options = scene.options;\n        var stepper = scene.stepper;\n\n        stepper.init($routeParams.yearsKey).then(function() {\n            $scope.scene = scene;\n            $scope.stepper = stepper;\n            $scope.audio = AnalyserService;\n            if ($route.current.$$route.originalPath.indexOf('/detail') !== -1) {\n                $timeout(function() {\n                    openDetail();\n                });\n            }\n            var gui = new DatGui();\n        });\n\n        var detail = {};\n\n        function openDetail() {\n            $ngSilentLocation.silent(stepper.step.detailUrl);\n            detail.active = true;\n            return false;\n        }\n\n        function closeDetail() {\n            $ngSilentLocation.silent(stepper.step.url);\n            detail.active = false;\n            return false;\n        }\n\n        $scope.detail = detail;\n        $scope.openDetail = openDetail;\n        $scope.closeDetail = closeDetail;\n\n        $scope.$on('onStepChanged', function() {\n            $ngSilentLocation.silent(stepper.step.url);\n        });\n\n        // console.log('YearsCtrl', $route, $routeParams);\n\n    }]);\n\n}());\n/* global angular */\n\n(function() {\n    \"use strict\";\n\n    var app = angular.module('app');\n\n    app.service('AnalyserService', ['$rootScope', '$timeout', '$q', '$http', 'SceneOptions', 'StepperService', function($rootScope, $timeout, $q, $http, SceneOptions, StepperService) {\n\n        var service = this;\n        var options = SceneOptions;\n        var stepper = StepperService;\n\n        var analyser, audio, audioUrl;\n\n        var audioContext = (window.AudioContext || window.webkitAudioContext);\n        var analyserContext = new audioContext();\n        analyser = analyserContext.createAnalyser();\n\n        audio = new Audio();\n        audio.addEventListener('canplay', onCanPlay);\n        audio.addEventListener('play', onPlay);\n        audio.addEventListener('pause', onPause);\n        audio.addEventListener('ended', onEnded);\n\n        var source = null;\n\n        function onCanPlay() {\n            // console.log('AnalyserService.onCanPlay');\n            if (!source) {\n                var bufferLength;\n                source = analyserContext.createMediaElementSource(audio);\n                source.smoothingTimeConstant = 0.85;\n                source.connect(analyser);\n                source.connect(analyserContext.destination);\n                analyser.fftSize = options.audio.bands * 2;\n                bufferLength = analyser.frequencyBinCount;\n                service.data = new Uint8Array(bufferLength);\n            }\n            // return service.data;\n        }\n\n        function onPlay() {\n            $timeout(function() {\n                service.playing = true;\n                // console.log('AnalyserService.onPlay', service);\n            });\n        }\n\n        function onPause() {\n            $timeout(function() {\n                service.playing = false;\n                // console.log('AnalyserService.onPause', service);\n            });\n        }\n\n        function onEnded() {\n            $timeout(function() {\n                service.playing = false;\n                // console.log('AnalyserService.onEnded', service);\n            });\n        }\n\n        function setAudioUrl($audioUrl) {\n            if (audioUrl !== $audioUrl) {\n                audioUrl = $audioUrl;\n                if (audioUrl) {\n                    audio.src = $audioUrl;\n                    audio.volume = options.audio.volume;\n                    // console.log('AnalyserService.setAudioUrl', $audioUrl);\n                    play();\n                }\n            }\n        }\n\n        function play() {\n            if (service.active && audioUrl && !isPlaying()) {\n                audio.play();\n            }\n        }\n\n        function pause() {\n            if (audioUrl && isPlaying()) {\n                audio.pause();\n            }\n        }\n\n        function isActive() {\n            // console.log('isActive', service.active, isPlaying());\n            return service.active && isPlaying();\n        }\n\n        function isPlaying() {\n            return !audio.paused && !audio.ended; //  && audio.currentTime > 0;\n        }\n\n        function toggle() {\n            service.active = !service.active;\n            if (service.active) {\n                play();\n            } else {\n                pause();\n            }\n        }\n\n        function setStep() {\n            var step = stepper.getCurrentStep();\n            setAudioUrl(step.audio ? step.audio.url : null);\n        }\n\n        function update() {\n            if (service.data) {\n                analyser.getByteFrequencyData(service.data);\n            }\n        }\n\n        service.unlocked = false;\n\n        function unlock() {\n            var deferred = $q.defer();\n            if (!options.device.ios || service.unlocked) {\n                deferred.resolve();\n            } else {\n                source = doUnlock();\n                // by checking the play state after some time, we know if we're really unlocked\n                $timeout(function() {\n                    if ((source.playbackState === source.PLAYING_STATE || source.playbackState === source.FINISHED_STATE)) {\n                        service.unlocked = true;\n                        deferred.resolve();\n                    }\n                });\n            }\n            console.log('AudioAnalyser.unlock');\n            return deferred.promise;\n        }\n\n        function doUnlock() {\n            // create empty buffer\n            var ctx = new audioContext();\n            var source = ctx.createBufferSource();\n            var buffer = ctx.createBuffer(1, 1, 22050);\n            source.buffer = buffer;\n\n            // connect to output (your speakers)\n            source.connect(ctx.destination);\n\n            // play the file\n            if (source.noteOn) {\n                source.noteOn(0);\n            }\n\n            console.log('AudioAnalyser.doUnlock');\n            return source;\n        }\n\n        window.addEventListener('touchstart', unlock, false);\n\n        $rootScope.$on('onStepChanged', function($scope) {\n            setStep();\n        });\n\n        $rootScope.$on('onOptionsChanged', function($scope) {\n            audio.volume = options.audio.volume;\n        });\n\n        this.active = true;\n        this.data = null;\n        this.audio = audio;\n        this.update = update;\n        this.play = play;\n        this.pause = pause;\n        this.toggle = toggle;\n        this.unlock = unlock;\n        this.isPlaying = isPlaying;\n        this.isActive = isActive;\n\n    }]);\n\n}());\n/* global angular */\n\n(function() {\n    \"use strict\";\n\n    var app = angular.module('app');\n\n    app.service('StepperService', ['$rootScope', '$timeout', '$q', '$http', '$sce', 'SceneOptions', function($rootScope, $timeout, $q, $http, $sce, SceneOptions) {\n\n        var stepper = this;\n        var options = SceneOptions;\n\n        var current = 0;\n        var duration = 2.500; // sec\n        var steps = [];\n        var tweens = [];\n\n        var values = {\n            pow: 0,\n            background: new THREE.Color(options.colors.background),\n            lines: new THREE.Color(options.colors.lines),\n            overLines: new THREE.Color(options.colors.overLines),\n            cameraHeight: options.camera.cameraHeight,\n            targetHeight: options.camera.targetHeight,\n        };\n\n        function getItems() {\n            var titles = [\n                'Il periodo francese:<br> la nascita della <em>Grand Opéra</em>',\n                'Il Barbiere di Siviglia<br> al teatro Argentina<br> di Roma',\n                'Il Silenzio',\n            ];\n            var paragraphs = [\n                'Il giovane Gioacchino',\n                'Il folgorante debutto',\n                'La frenesia della produzione',\n                'Sulle strade di Parigi',\n            ];\n            var audioTitles = [\n                'Il Barbiere di Siviglia',\n                'L\\'italiana in Algeri',\n            ];\n            var audios = [\n                'audio/07-rossini-192.mp3',\n                'audio/08-rossini-192.mp3',\n            ];\n            var backgrounds = [\n                'img/tunnel-1.jpg',\n                'img/tunnel-2.jpg',\n                'img/tunnel-3.jpg',\n            ];\n            var contrasts = [\n                'light-bg',\n                'light-bg',\n                'dark-bg',\n            ];\n            var items = new Array(options.ribbon.steps).fill().map(function(v, i) {\n                var item = {\n                    id: i + 1,\n                    title: titles[i % titles.length],\n                    url: 'view.html',\n                    chapter: 'Passione, Genio e Silenzio',\n                    paragraph: paragraphs[Math.floor(i / 3) % paragraphs.length],\n                    years: i % 4 === 0 ? {\n                        from: 1812 + Math.round(Math.random() * 50),\n                    } : {\n                        from: 1812 + Math.round(Math.random() * 50),\n                        to: 1812 + Math.round(Math.random() * 50),\n                    },\n                    background: backgrounds[i % backgrounds.length],\n                    contrast: contrasts[i % contrasts.length],\n                    colors: angular.copy(SceneOptions.colors),\n                    camera: {\n                        cameraHeight: -10,\n                        targetHeight: 30,\n                    },\n                    circle: {\n                        position: new THREE.Vector3(0, 0, 0),\n                        texture: 'img/rossini-01.png',\n                    },\n                    audio: i > 0 ? {\n                        url: audios[i % audios.length],\n                        title: audioTitles[i % audioTitles.length],\n                        orchestra: 'Academy of St Martin in the Fields Orchestra',\n                    } : null,\n                };\n                if (item.contrast === 'dark-bg') {\n                    item.colors.background = 0x111111;\n                }\n                return item;\n            });\n            return items;\n        }\n\n        function init(yearsKey) {\n            var deferred = $q.defer();\n            $http.get('json/rossini.js').then(function(response) {\n                // var items = response.data;\n                var index = 0;\n                var items = getItems();\n                angular.forEach(items, function(item, i) {\n                    item.years.key = String(i + 1); // String(item.years.to ? item.years.from + '-' + item.years.to : item.years.from); // da riattivare !!!\n                    item.url = '/years/' + item.years.key;\n                    item.detailUrl = item.url + '/detail';\n                    // console.log('stepper.init', item.years.key, yearsKey);\n                    if (item.years.key === yearsKey) {\n                        index = i;\n                    }\n                    item.titleTrusted = $sce.trustAsHtml(item.title);\n                    item.circle.position = new THREE.Vector3().copy(item.circle.position);\n                    steps.push(item);\n                });\n                values.pow = index / steps.length;\n                stepper.current = current = index;\n                navStep(index);\n                // console.log('StepperService.load', steps);\n                deferred.resolve(steps);\n\n            }, function(error) {\n                deferred.reject(error);\n\n            });\n            return deferred.promise;\n        }\n\n        function clearTweens() {\n            while (tweens.length) {\n                var tween = tweens.pop();\n                tween.kill();\n            }\n        }\n\n        function tweenTo(pow, step, duration, callback) {\n            clearTweens();\n            var background = new THREE.Color(step.colors.background);\n            var lines = new THREE.Color(step.colors.lines);\n            var overLines = new THREE.Color(step.colors.overLines);\n            tweens.push(TweenLite.to(stepper.values, duration, {\n                pow: pow,\n                cameraHeight: step.camera.cameraHeight,\n                targetHeight: step.camera.targetHeight,\n                delay: 0,\n                ease: Power2.easeInOut,\n                onComplete: function() {\n                    if (callback) {\n                        callback();\n                    }\n                },\n            }));\n            tweens.push(TweenLite.to(stepper.values.background, duration, {\n                r: background.r,\n                g: background.g,\n                b: background.b,\n                delay: 0,\n                ease: Power2.easeInOut,\n                /*\n                onUpdate: function() {\n                    if (!options.useBackground) {\n                        var color = stepper.values.background.getHexString();\n                        document.body.style.backgroundColor = '#' + color;\n                    }\n                }\n                */\n            }));\n            tweens.push(TweenLite.to(stepper.values.lines, duration, {\n                r: lines.r,\n                g: lines.g,\n                b: lines.b,\n                delay: 0,\n                ease: Power2.easeInOut,\n            }));\n            tweens.push(TweenLite.to(stepper.values.overLines, duration, {\n                r: overLines.r,\n                g: overLines.g,\n                b: overLines.b,\n                delay: 0,\n                ease: Power2.easeInOut,\n            }));\n        }\n\n        function setTweens(duration) {\n            var index = stepper.current;\n            var step = steps[index];\n            tweenTo(index / steps.length, step, duration, function() {\n                clearTweens();\n                // console.log(step, stepper.values);\n            });\n        }\n\n        $rootScope.$on('onOptionsChanged', function() {\n            var index = stepper.current;\n            var step = steps[index];\n            stepper.values.cameraHeight = step.camera.cameraHeight;\n            stepper.values.targetHeight = step.camera.targetHeight;\n            stepper.values.background.copy(new THREE.Color(step.colors.background));\n            stepper.values.lines.copy(new THREE.Color(step.colors.lines));\n            stepper.values.overLines.copy(new THREE.Color(step.colors.overLines));\n            // setTweens(0.250);\n            if (!options.useBackground) {\n                var color = stepper.values.background.getHexString();\n                $('.tunnel-gradient').css('background-color', '#' + color);\n            }\n        });\n\n        $rootScope.$on('onSlickBeforeChange', function($scope, slick) {\n            navStep(slick.current);\n        });\n\n        function setStep(index) {\n            console.log('setStep');\n            $timeout(function() {\n                var previous = stepper.current || 0;\n                stepper.current = current = index;\n                var step = steps[index];\n                stepper.step = step;\n                options.colors.background = step.colors.background;\n                options.colors.lines = step.colors.lines;\n                options.colors.overLines = step.colors.overLines;\n                options.camera.cameraHeight = step.camera.cameraHeight;\n                options.camera.targetHeight = step.camera.targetHeight;\n                options.circle.position.copy(step.circle.position);\n                if (!options.useBackground) {\n                    var color = new THREE.Color(options.colors.background).getHexString();\n                    $('.tunnel-gradient').css('background-color', '#' + color);\n                }\n                $rootScope.$broadcast('onStepChanged', { current: index, previous: previous });\n                // console.log('onStepChanged', index, step);\n                setTweens(stepper.duration);\n            });\n        }\n\n        function getCurrentStep() {\n            return steps[current];\n        }\n\n        function getStepAtIndex(index) {\n            return steps[index];\n        }\n\n        function previous() {\n            if (stepper.slicking) {\n                return;\n            }\n            current--;\n            current = Math.max(0, current);\n            navStep(current);\n            $rootScope.$broadcast('onGoStep', current);\n        }\n\n        function next() {\n            if (stepper.slicking) {\n                return;\n            }\n            current++;\n            current = Math.min(steps.length - 1, current);\n            navStep(current);\n            $rootScope.$broadcast('onGoStep', current);\n        }\n\n        function navStep(index) {\n            console.log('cambio pagina');\n            setStep(index);\n            $rootScope.$broadcast('onGoStep', index);\n\n            $timeout(function() {\n                var $active = $('.tunnel-nav__step.active'),\n                    position = $active.position().top,\n                    width = $active.width() + 16;\n\n                $('.tunnel-nav__follower').css({ width: width + 'px', '-webkit-transform': 'translateY(' + position + 'px)', '-moz-transform': 'translateY(' + position + 'px)', '-ms-transform': 'translateY(' + position + 'px)', 'transform': 'translateY(' + position + 'px)' });\n            });\n        }\n\n        this.init = init;\n        this.values = values;\n        this.duration = duration;\n        this.steps = steps;\n        this.navStep = navStep;\n        this.getCurrentStep = getCurrentStep;\n        this.getStepAtIndex = getStepAtIndex;\n        this.current = current;\n        this.previous = previous;\n        this.next = next;\n\n    }]);\n\n}());\n/* global angular */\n\n(function() {\n    \"use strict\";\n\n    var app = angular.module('app');\n\n    app.directive('scene', ['SceneOptions', 'StepperService', 'AnalyserService', function(SceneOptions, StepperService, AnalyserService) {\n        return {\n            restrict: 'A',\n            scope: {\n                data: '=scene',\n            },\n            link: function(scope, element, attributes) {\n                var data = scope.data;\n                if (!data) {\n                    return;\n                }\n\n                var objects = data.objects;\n                var options = SceneOptions;\n                var stepper = StepperService;\n                var analyser = AnalyserService;\n\n                var stats, scene, camera, shadow, back, light, renderer, width, height, w2, h2;\n                var controls = null;\n\n                scope.$on('onStepChanged', function($scope, step) {\n                    // console.log('onStepChanged', step.current);\n                    var circle = null;\n                    var current = step.current,\n                        previous = step.previous;\n                    if (current > 0) {\n                        circle = objects.circles[current] || getObjectCircles(current);\n                        circle.add();\n                    }\n                    objects.circles[current] = circle;\n                    setTimeout(function() {\n                        if (stepper.current !== previous && previous > 0) {\n                            var circle = objects.circles[previous];\n                            if (circle) {\n                                circle.remove();\n                            }\n                        }\n                    }, stepper.duration * 1000);\n                    // console.log('objects', objects);                    \n                });\n\n                scope.$on('onOptionsChanged', function($scope) {\n                    // optionsChanged\n                });\n\n                var mouse = { x: 0, y: 0 };\n                // var mousePos = { x: 0, y: 0 };\n                var parallax = { x: 0, y: 0, i: 0 };\n\n                function updateParallax() {\n                    parallax.x = (mouse.x * 20) + Math.cos(parallax.i / 100) * 10;\n                    parallax.y = (mouse.y * 20) + Math.sin(parallax.i / 100) * 10;\n                    parallax.i++;\n                }\n\n                createScene();\n                // createLights();\n                createObjects();\n                addListeners();\n                loop();\n\n                function createScene() {\n                    width = window.innerWidth;\n                    height = window.innerHeight;\n                    w2 = width / 2;\n                    h2 = height / 2;\n\n                    var ratio = width / height;\n                    var fov = 30;\n                    var near = 0.001;\n                    var far = 20000;\n\n                    scene = new THREE.Scene();\n                    // scene.fog = new THREE.Fog(0x000000, 250, 800);\n\n                    camera = new THREE.PerspectiveCamera(fov, ratio, near, far);\n                    /*\n                    camera.position.z = 100;\n                    camera.position.y = -500;\n                    camera.lookAt(new THREE.Vector3(0, 0, 0));\n                    */\n\n                    renderer = new THREE.WebGLRenderer({\n                        alpha: true,\n                        antialias: true,\n                        logarithmicDepthBuffer: true\n                    });\n\n                    renderer.setClearColor(0x000000, 0); // the default\n                    // renderer.setClearColor(stepper.values.background, 1);\n                    renderer.setSize(width, height);\n                    renderer.sortObjects = false; // avoid flickering effect\n                    // renderer.shadowMap.enabled = true;\n\n                    stats = new Stats();\n                    element[0].appendChild(renderer.domElement);\n                    element[0].appendChild(stats.dom);\n                }\n\n                function createLights() {\n                    light = new THREE.HemisphereLight(0xffffff, 0xffffff, 0.5);\n                    shadow = new THREE.DirectionalLight(0xffffff, 0.8);\n                    shadow.position.set(200, 200, 200);\n                    shadow.castShadow = true;\n                    // shadow.shadowDarkness = .2;\n                    back = new THREE.DirectionalLight(0xffffff, 0.4);\n                    back.position.set(-100, 200, 50);\n                    // back.shadowDarkness = .2;\n                    back.castShadow = true;\n                    scene.add(light);\n                    scene.add(shadow);\n                    scene.add(back);\n                }\n\n                function createObjects() {\n                    objects.ribbon = getObjectRibbon();\n                    objects.circles = new Array(stepper.steps).fill(null);\n                }\n\n                function getObjectRibbon() {\n\n                    var resolution = new THREE.Vector2(window.innerWidth, window.innerHeight);\n\n                    var material = new MeshLineMaterial({\n                        color: stepper.values.lines,\n                        lineWidth: 5,\n                        opacity: 0.8,\n                        transparent: true,\n                        depthTest: false,\n                        sizeAttenuation: true,\n                        resolution: resolution,\n                        near: camera.near,\n                        far: camera.far,\n                        // blending: THREE.AdditiveBlending,\n                        // side: THREE.DoubleSide,\n                    });\n\n                    var prev = new THREE.Vector3();\n                    var points = new Array(options.ribbon.points).fill(null).map(function() {\n                        var p = new THREE.Vector3().copy(prev);\n                        prev.x += getRandomRange(500, 1000, true);\n                        prev.y += getRandomRange(10, 40, true);\n                        prev.z += getRandomRange(1000, 2000, false);\n                        return p;\n                    });\n\n                    var spline = new THREE.CatmullRomCurve3(points);\n                    spline.type = 'catmullrom';\n                    spline.closed = false;\n\n                    var cameraSpline = new THREE.CatmullRomCurve3(spline.points.map(function(p) {\n                        return new THREE.Vector3(p.x, p.y + 20, p.z);\n                    }));\n                    cameraSpline.type = 'catmullrom';\n                    cameraSpline.closed = false;\n\n                    var geometry = new THREE.Geometry();\n                    geometry.vertices = spline.getPoints(options.ribbon.vertices);\n\n                    var line = new MeshLine();\n                    line.setGeometry(geometry);\n                    // line.setGeometry( geometry, function( p ) { return 2; } ); // makes width 2 * lineWidth\n                    // line.setGeometry( geometry, function( p ) { return 1 - p; } ); // makes width taper\n                    // line.setGeometry(geometry, function(p) { return 2 + Math.sin(50 * p); }); // makes width sinusoidal\n\n                    var object = new THREE.Mesh(line.geometry, material);\n                    add();\n\n                    function add() {\n                        // console.log('objects.ribbon.add');\n                        scene.add(object);\n                    }\n\n                    function remove() {\n                        // console.log('objects.ribbon.remove');\n                        scene.remove(object);\n                    }\n\n                    camera.target = camera.target || new THREE.Vector3(0, 0, 0);\n\n                    function updateRibbon() {\n                        var s = (1 / stepper.steps.length);\n                        var c = s * 0.1;\n                        var cpow = stepper.values.pow;\n                        var tpow = (cpow + c).mod(1);\n                        var step = stepper.getCurrentStep();\n                        var position = cameraSpline.getPointAt(cpow);\n                        position.y += stepper.values.cameraHeight;\n\n                        object.material.uniforms.visibility.value = Math.min(1.0, stepper.values.pow + s);\n                        // object.material.uniforms.lineWidth.value = 5;\n\n                        var target = cameraSpline.getPointAt(tpow);\n                        target.y += stepper.values.targetHeight;\n                        // var tangent = cameraSpline.getTangent(tpow).normalize().multiplyScalar(100);\n                        // target.add(tangent);\n                        camera.position.copy(position);\n                        camera.target.copy(target);\n                        camera.position.x += (position.x + parallax.x - camera.position.x) / 12;\n                        camera.position.y += (position.y + parallax.y - camera.position.y) / 12;\n                        camera.lookAt(camera.target);\n                    }\n\n                    return {\n                        object: object,\n                        spline: spline,\n                        cameraSpline: cameraSpline,\n                        geometry: geometry,\n                        material: material,\n                        add: add,\n                        remove: remove,\n                        update: updateRibbon,\n                    };\n                }\n\n                function getObjectCircles(index) {\n\n                    var noiseMap1 = getPerlinNoise(options.circle.points, options.circle.lines);\n                    var noiseMap2 = getPerlinNoise(options.circle.points, options.circle.lines);\n\n                    var geometry, object, circles = [];\n\n                    var ln = options.circle.lines,\n                        pn = options.circle.points;\n\n                    var step = stepper.getStepAtIndex(index);\n\n                    var texture = new THREE.TextureLoader().load(step.circle.texture);\n                    texture.wrapS = THREE.RepeatWrapping;\n                    texture.wrapT = THREE.RepeatWrapping;\n                    texture.repeat.set(1, 1);\n\n                    var resolution = new THREE.Vector2(window.innerWidth, window.innerHeight);\n\n                    var material = new THREE.MeshBasicMaterial({\n                        color: 0xffffff,\n                        map: texture,\n                        transparent: true,\n                    });\n\n                    var material1 = new THREE.LineBasicMaterial({\n                        color: stepper.values.lines,\n                        transparent: true,\n                    });\n\n                    var material2 = new THREE.LineBasicMaterial({\n                        color: stepper.values.overLines,\n                        transparent: true,\n                    });\n\n                    var materialLine1 = new MeshLineMaterial({\n                        color: stepper.values.lines,\n                        lineWidth: 1.0,\n                        depthTest: false,\n                        opacity: 1,\n                        transparent: true,\n                        resolution: resolution,\n                        near: camera.near,\n                        far: camera.far,\n                    });\n\n                    var materialLine2 = new MeshLineMaterial({\n                        color: stepper.values.overLines,\n                        lineWidth: 1.0,\n                        depthTest: false,\n                        opacity: 1,\n                        transparent: true,\n                        resolution: resolution,\n                        near: camera.near,\n                        far: camera.far,\n                    });\n\n                    object = new THREE.Object3D();\n\n                    var points1 = [],\n                        points2 = [],\n                        meshLines1 = [],\n                        meshLines2 = [],\n                        meshLineGeometries1 = [],\n                        meshLineGeometries2 = [],\n                        useMeshLines = false;\n\n                    var dummy = new THREE.Object3D();\n                    object.add(dummy);\n\n                    // circle\n                    geometry = new THREE.PlaneGeometry(options.circle.radius * 2 - 20, options.circle.radius * 2 - 20, 8, 8);\n                    var plane = new THREE.Mesh(geometry, material);\n                    plane.position.z = -30;\n                    dummy.add(plane);\n                    // circle\n\n                    var group1 = new THREE.Object3D();\n                    dummy.add(group1);\n\n                    var group2 = new THREE.Object3D();\n                    dummy.add(group2);\n\n                    var lines1 = new Array(ln).fill(null).map(getLine1);\n                    var lines2 = new Array(ln).fill(null).map(getLine2);\n\n                    var state = {\n                        pow: 0,\n                        enabled: false,\n                        adding: false,\n                        removing: false,\n                    };\n\n                    var to = null;\n\n                    function add() {\n                        // console.log('objects.circles.add');\n                        scene.add(object);\n                        state.adding = Date.now();\n                        state.removing = false;\n                        state.enabled = true;\n                        if (state.tween) {\n                            state.tween.kill();\n                        }\n                        state.tween = TweenLite.to(state, 2.000, {\n                            pow: 1,\n                            delay: 0,\n                            ease: Elastic.easeOut.config(1, 0.3),\n                            onComplete: function() {\n                                state.adding = false;\n                            },\n                        });\n                    }\n\n                    function remove() {\n                        // console.log('objects.circles.remove');\n                        state.adding = false;\n                        state.removing = Date.now();\n                        if (state.tween) {\n                            state.tween.kill();\n                        }\n                        state.tween = TweenLite.to(state, 0.350, {\n                            pow: 0,\n                            delay: 0,\n                            ease: Power2.easeOut,\n                            onComplete: function() {\n                                state.removing = false;\n                                state.enabled = false;\n                                scene.remove(object);\n                            },\n                        });\n                    }\n\n                    var iterator = 0;\n\n                    function getLine1(v, i) {\n                        var geometry = new THREE.Geometry();\n                        var points = addPoints(geometry, i, 1);\n                        points1.push(points);\n                        var line = null;\n                        if (useMeshLines) {\n                            var meshLine = new MeshLine();\n                            meshLine.setGeometry(geometry);\n                            meshLineGeometries1.push(geometry);\n                            meshLines1.push(meshLine);\n                            // meshLine.setGeometry( geometry, function( p ) { return 2; } ); // makes width 2 * lineWidth\n                            // meshLine.setGeometry( geometry, function( p ) { return 1 - p; } ); // makes width taper\n                            // meshLine.setGeometry( geometry, function( p ) { return 2 + Math.sin( 50 * p ); } ); // makes width sinusoidal\n                            line = new THREE.Mesh(meshLine.geometry, materialLine1);\n                        } else {\n                            line = new THREE.LineLoop(geometry, material1.clone());\n                            // var spline = new THREE.CatmullRomCurve3(points);\n                            // circle.spline = spline;\n                        }\n                        group1.add(line);\n                        return line;\n                    }\n\n                    function getLine2(v, i) {\n                        var geometry = new THREE.Geometry();\n                        var points = addPoints(geometry, i, 2);\n                        points2.push(points);\n                        var line = null;\n                        if (useMeshLines) {\n                            var meshLine = new MeshLine();\n                            meshLine.setGeometry(geometry);\n                            meshLineGeometries2.push(geometry);\n                            meshLines2.push(meshLine);\n                            // meshLine.setGeometry( geometry, function( p ) { return 2; } ); // makes width 2 * lineWidth\n                            // meshLine.setGeometry( geometry, function( p ) { return 1 - p; } ); // makes width taper\n                            // meshLine.setGeometry( geometry, function( p ) { return 2 + Math.sin( 50 * p ); } ); // makes width sinusoidal\n                            line = new THREE.Mesh(meshLine.geometry, materialLine2);\n                        } else {\n                            line = new THREE.LineLoop(geometry, material2.clone());\n                            // var spline = new THREE.CatmullRomCurve3(points);\n                            // circle.spline = spline;\n                        }\n                        group2.add(line);\n                        return line;\n                    }\n\n                    function addPoints(geometry, l, g) {\n                        var points = new Array(pn).fill(null).map(function(v, i) {\n                            var ratio = i / pn;\n                            var degrees = 360 * ratio; // point degrees;\n                            degrees += 60 * index; // circle offset;\n                            degrees += 30 * g; // group offset;\n                            degrees += (360 / pn * 0.1) * l; // line offset;\n                            var radians = degrees * Math.PI / 180;\n                            var radius = options.circle.radius;\n                            var increment = 0;\n                            if (g === 1) {\n                                increment += (l * l * l * 0.005);\n                            } else {\n                                increment += (l * l * l * 0.005);\n                            }\n                            v = new THREE.Vector3();\n                            v.sincos = {\n                                base: radius,\n                                increment: increment,\n                                radius: radius,\n                                x: Math.cos(radians),\n                                y: Math.sin(radians),\n                            };\n                            geometry.vertices.push(v);\n                            return v;\n                        });\n                        geometry.vertices.push(points[0]);\n                        return points;\n                    }\n\n                    function updateLine(geometry, vertices, l, g) {\n                        var audioStrength = options.audioStrength,\n                            noiseStrength = options.noiseStrength,\n                            circularStrength = options.circularStrength,\n                            noiseMap = g === 1 ? noiseMap1 : noiseMap2,\n                            data = analyser.data;\n\n                        angular.forEach(vertices, function(v, i) {\n                            var bands = options.audio.bands;\n                            var aia = i % bands;\n                            var aib = (pn - 1 - i) % bands;\n                            var audioPow = data ? ((data[aia] + data[aib]) / 2) / bands : 0;\n                            // var audioPow = data[aia] / bands;\n\n                            var ni = 0; // iterator;\n\n                            var nd = g === 1 ? 0 : 64;\n                            var nia = l * pn + ((i + nd + ni) % pn);\n                            var nib = l * pn + (((pn - 1 - i - nd) + ni) % pn);\n                            var noisePow = (noiseMap[nia] + noiseMap[nib]) / 2 / 64;\n\n                            var linePow = 1 - ((ln - l) / ln * circularStrength);\n\n                            var radius = v.sincos.base +\n                                (v.sincos.increment * noisePow) +\n                                (v.sincos.increment * audioPow) +\n                                (noiseStrength * noisePow) * linePow +\n                                (audioStrength * audioPow) * linePow +\n                                // (audioStrength * (3 - g) * audioPow * (l * 0.1)) * linePow +\n                                0;\n\n                            v.sincos.radius = radius;\n                            // v.sincos.radius += (radius - v.sincos.radius) / 2;\n\n                            v.x = v.sincos.x * v.sincos.radius;\n                            v.y = v.sincos.y * v.sincos.radius;\n                            v.z = 10 * g + l * 0.01; // -l;\n                            // console.log(v.sincos.radius);\n                        });\n\n                        geometry.verticesNeedUpdate = true;\n\n                        /*\n                        var f = 0;\n                        var l = pn - 1;\n                        var first = new THREE.Vector3().copy(vertices[f]);\n                        var last = new THREE.Vector3().copy(vertices[l]);\n                        vertices[f].add(new THREE.Vector3().subVectors(first, last).multiplyScalar(0.5));\n                        vertices[l].add(new THREE.Vector3().subVectors(first, last).multiplyScalar(-0.5));\n                        \n                        lines.forEach( function( l, i ) {\n                        if( params.animateWidth ) l.material.uniforms.lineWidth.value = params.lineWidth * ( 1 + .5 * Math.sin( 5 * t + i ) );\n                        if( params.autoRotate ) l.rotation.y += .125 * delta;\n                        l.material.uniforms.visibility.value= params.animateVisibility ? (time/3000) % 1.0 : 1.0;\n                        \n                        if (iterator === 60 && g === 2 && l === 0) {\n                            // console.log('vertices', geometry.vertices.map(function(v) { return v.x + ',' + v.y; }));\n                        }\n                        */\n                    }\n\n                    var dummyMobilePosition = new THREE.Vector3(0, 100, 0);\n\n                    function updateCircle() {\n\n                        material.opacity = state.pow;\n                        // material1.opacity = state.pow;\n                        // material2.opacity = state.pow;\n                        // material1.color = stepper.values.lines;\n                        // material2.color = stepper.values.overLines;\n\n                        // console.log(stepper.values.overLines);\n\n                        // if (useMeshLines) {\n                        //    materialLine1.uniforms.lineWidth.value = state.pow;\n                        //    materialLine2.uniforms.lineWidth.value = state.pow;\n                        // }\n\n                        angular.forEach(lines1, function(line, l) {\n                            updateLine(line.geometry, points1[l], l, 1);\n                            line.material.opacity = (0.0 + (1.0 * l / ln)) * state.pow;\n                            line.material.color = stepper.values.lines;\n                            // line.geometry.colorsNeedUpdate = true;\n                            if (useMeshLines) {\n                                meshLines1[l].setGeometry(meshLineGeometries1[l]);\n                            }\n                        });\n\n                        angular.forEach(lines2, function(line, l) {\n                            updateLine(line.geometry, points2[l], l, 2);\n                            line.material.opacity = (0.0 + (1.0 * l / ln)) * state.pow;\n                            line.material.color = stepper.values.overLines;\n                            // line.geometry.colorsNeedUpdate = true;\n                            if (useMeshLines) {\n                                meshLines2[l].setGeometry(meshLineGeometries2[l]);\n                            }\n                        });\n\n                        group1.rotation.z += 0.001;\n                        group2.rotation.z -= 0.001;\n\n                        if (width > 1023) {\n                            dummy.position.copy(step.circle.position);\n                        } else {\n                            dummy.position.copy(dummyMobilePosition);\n                        }\n\n                        dummy.rotation.x += ((parallax.y * 0.00625) - dummy.rotation.x) / 12;\n                        dummy.rotation.y += ((parallax.x * 0.01250) - dummy.rotation.y) / 12;\n\n                        var position = objects.ribbon.cameraSpline.getPointAt((index + 0.1) / stepper.steps.length);\n                        // var tangent = objects.ribbon.cameraSpline.getTangent(index + 0.1 / stepper.steps.length).normalize().multiplyScalar(300);\n                        // position.add(tangent);\n\n                        position.y += stepper.values.targetHeight;\n                        object.position.copy(position);\n\n                        // object.position.x += (position.x + Math.random() * 20 - object.position.x) / 40;\n                        // object.position.y += (position.y + Math.random() * 20 - object.position.y) / 40;\n                        // object.position.z += (position.z + Math.random() * 20 - object.position.z) / 40;\n\n                        object.scale.x = object.scale.y = object.scale.z = 0.001 + 0.14 * state.pow;\n                        object.lookAt(camera.position);\n\n                        // iterator++;\n                    }\n\n                    return {\n                        add: add,\n                        remove: remove,\n                        object: object,\n                        state: state,\n                        update: updateCircle,\n                    };\n                }\n\n                function render() {\n                    // scene.fog.color = stepper.values.background;\n                    updateParallax();\n                    analyser.update();\n                    if (controls) {\n                        controls.update();\n                    }\n                    if (objects.ribbon) {\n                        objects.ribbon.update();\n                    }\n                    angular.forEach(objects.circles, function(circle) {\n                        if (circle && circle.state.enabled) {\n                            circle.update();\n                        }\n                    });\n                    renderer.render(scene, camera);\n                }\n\n                function loop() {\n                    stats.begin();\n                    render();\n                    stats.end();\n                    requestAnimationFrame(loop);\n                }\n\n                function addListeners() {\n\n                    function onWindowResize() {\n                        width = window.innerWidth;\n                        height = window.innerHeight;\n                        w2 = width / 2;\n                        h2 = height / 2;\n                        renderer.setSize(width, height);\n                        camera.aspect = width / height;\n                        camera.updateProjectionMatrix();\n                    }\n\n                    function handleMouseMove(event) {\n                        var halfW = window.innerWidth / 2;\n                        var halfH = window.innerHeight / 2;\n                        mouse.x = (event.clientX - halfW) / halfW;\n                        mouse.y = (event.clientY - halfH) / halfH;\n                    }\n\n                    window.addEventListener('resize', onWindowResize, false);\n                    document.addEventListener('mousemove', handleMouseMove, false);\n\n                    /*\n                    \n\n                    function handleMouseDown(event) {\n                        //\n                    }\n\n                    function handleMouseUp(event) {\n                        //\n                    }\n\n                    function handleTouchStart(event) {\n                        if (event.touches.length > 1) {\n                            event.preventDefault();\n                            mousePos = { x: event.touches[0].pageX, y: event.touches[0].pageY };\n                        }\n                    }\n\n                    function handleTouchEnd(event) {\n                        mousePos = { x: windowHalfX, y: windowHalfY };\n                    }\n\n                    function handleTouchMove(event) {\n                        if (event.touches.length == 1) {\n                            event.preventDefault();\n                            mousePos = { x: event.touches[0].pageX, y: event.touches[0].pageY };\n                        }\n                    }\n                    */\n                    /*\n                    document.addEventListener('mousedown', handleMouseDown, false);\n                    document.addEventListener('mouseup', handleMouseUp, false);\n                    document.addEventListener('touchstart', handleTouchStart, false);\n                    document.addEventListener('touchend', handleTouchEnd, false);\n                    document.addEventListener('touchmove', handleTouchMove, false);\n                    */\n                }\n\n            }\n        };\n    }]);\n\n    Number.prototype.mod = function(n) {\n        return ((this % n) + n) % n;\n    };\n\n    function getPerlinNoise(width, height) {\n        var size = width * height,\n            data = new Uint8Array(size),\n            perlin = new ImprovedNoise(),\n            quality = 1,\n            z = Math.random() * 100;\n        for (var j = 0; j < 4; j++) {\n            for (var i = 0; i < size; i++) {\n                var x = i % width,\n                    y = ~~(i / width);\n                data[i] += Math.abs(perlin.noise(x / quality, y / quality, z) * quality * 1.75);\n            }\n            quality *= 5;\n        }\n        return data;\n    }\n\n    function ImprovedNoise() {\n        var p = [151, 160, 137, 91, 90, 15, 131, 13, 201, 95, 96, 53, 194, 233, 7, 225, 140, 36, 103, 30, 69, 142, 8, 99, 37, 240, 21, 10,\n            23, 190, 6, 148, 247, 120, 234, 75, 0, 26, 197, 62, 94, 252, 219, 203, 117, 35, 11, 32, 57, 177, 33, 88, 237, 149, 56, 87,\n            174, 20, 125, 136, 171, 168, 68, 175, 74, 165, 71, 134, 139, 48, 27, 166, 77, 146, 158, 231, 83, 111, 229, 122, 60, 211,\n            133, 230, 220, 105, 92, 41, 55, 46, 245, 40, 244, 102, 143, 54, 65, 25, 63, 161, 1, 216, 80, 73, 209, 76, 132, 187, 208,\n            89, 18, 169, 200, 196, 135, 130, 116, 188, 159, 86, 164, 100, 109, 198, 173, 186, 3, 64, 52, 217, 226, 250, 124, 123, 5,\n            202, 38, 147, 118, 126, 255, 82, 85, 212, 207, 206, 59, 227, 47, 16, 58, 17, 182, 189, 28, 42, 223, 183, 170, 213, 119,\n            248, 152, 2, 44, 154, 163, 70, 221, 153, 101, 155, 167, 43, 172, 9, 129, 22, 39, 253, 19, 98, 108, 110, 79, 113, 224, 232,\n            178, 185, 112, 104, 218, 246, 97, 228, 251, 34, 242, 193, 238, 210, 144, 12, 191, 179, 162, 241, 81, 51, 145, 235, 249,\n            14, 239, 107, 49, 192, 214, 31, 181, 199, 106, 157, 184, 84, 204, 176, 115, 121, 50, 45, 127, 4, 150, 254, 138, 236, 205,\n            93, 222, 114, 67, 29, 24, 72, 243, 141, 128, 195, 78, 66, 215, 61, 156, 180\n        ];\n        for (var i = 0; i < 256; i++) {\n            p[256 + i] = p[i];\n        }\n\n        function fade(t) {\n            return t * t * t * (t * (t * 6 - 15) + 10);\n        }\n\n        function lerp(t, a, b) {\n            return a + t * (b - a);\n        }\n\n        function grad(hash, x, y, z) {\n            var h = hash & 15;\n            var u = h < 8 ? x : y,\n                v = h < 4 ? y : h == 12 || h == 14 ? x : z;\n            return ((h & 1) === 0 ? u : -u) + ((h & 2) === 0 ? v : -v);\n        }\n\n        return {\n            noise: function(x, y, z) {\n                var floorX = Math.floor(x),\n                    floorY = Math.floor(y),\n                    floorZ = Math.floor(z);\n                var X = floorX & 255,\n                    Y = floorY & 255,\n                    Z = floorZ & 255;\n                x -= floorX;\n                y -= floorY;\n                z -= floorZ;\n                var xMinus1 = x - 1,\n                    yMinus1 = y - 1,\n                    zMinus1 = z - 1;\n                var u = fade(x),\n                    v = fade(y),\n                    w = fade(z);\n                var A = p[X] + Y,\n                    AA = p[A] + Z,\n                    AB = p[A + 1] + Z,\n                    B = p[X + 1] + Y,\n                    BA = p[B] + Z,\n                    BB = p[B + 1] + Z;\n                return lerp(w, lerp(v, lerp(u, grad(p[AA], x, y, z),\n                            grad(p[BA], xMinus1, y, z)),\n                        lerp(u, grad(p[AB], x, yMinus1, z),\n                            grad(p[BB], xMinus1, yMinus1, z))),\n                    lerp(v, lerp(u, grad(p[AA + 1], x, y, zMinus1),\n                            grad(p[BA + 1], xMinus1, y, z - 1)),\n                        lerp(u, grad(p[AB + 1], x, yMinus1, zMinus1),\n                            grad(p[BB + 1], xMinus1, yMinus1, zMinus1))));\n\n            }\n        };\n    }\n\n    function getRandomRange(min, max, allowNegatives) {\n        var n = -1 + Math.random() * 2;\n        var a = Math.abs(n);\n        var s = allowNegatives ? Math.floor(n / a) : 1;\n        return s * (min + (max - min) * a);\n    }\n\n}());\n/* global angular */\n\n(function() {\n    \"use strict\";\n\n    var app = angular.module('app');\n\n    function mobilecheck() {\n        var check = false;\n        (function(a) { if (/(android|bb\\d+|meego).+mobile|avantgo|bada\\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(a) || /1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\\-(n|u)|c55\\/|capi|ccwa|cdm\\-|cell|chtm|cldc|cmd\\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\\-s|devi|dica|dmob|do(c|p)o|ds(12|\\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\\-|_)|g1 u|g560|gene|gf\\-5|g\\-mo|go(\\.w|od)|gr(ad|un)|haie|hcit|hd\\-(m|p|t)|hei\\-|hi(pt|ta)|hp( i|ip)|hs\\-c|ht(c(\\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\\-(20|go|ma)|i230|iac( |\\-|\\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\\/)|klon|kpt |kwc\\-|kyo(c|k)|le(no|xi)|lg( g|\\/(k|l|u)|50|54|\\-[a-w])|libw|lynx|m1\\-w|m3ga|m50\\/|ma(te|ui|xo)|mc(01|21|ca)|m\\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\\-2|po(ck|rt|se)|prox|psio|pt\\-g|qa\\-a|qc(07|12|21|32|60|\\-[2-7]|i\\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\\-|oo|p\\-)|sdk\\/|se(c(\\-|0|1)|47|mc|nd|ri)|sgh\\-|shar|sie(\\-|m)|sk\\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\\-|v\\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\\-|tdg\\-|tel(i|m)|tim\\-|t\\-mo|to(pl|sh)|ts(70|m\\-|m3|m5)|tx\\-9|up(\\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\\-|your|zeto|zte\\-/i.test(a.substr(0, 4))) check = true; })(navigator.userAgent || navigator.vendor || window.opera);\n        return check;\n    }\n\n    // For those wishing to include tablets in this test (though arguably, you shouldn't), you can use the following function:\n    function mobileAndTabletcheck() {\n        var check = false;\n        (function(a) { if (/(android|bb\\d+|meego).+mobile|avantgo|bada\\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\\.(browser|link)|vodafone|wap|windows ce|xda|xiino|android|ipad|playbook|silk/i.test(a) || /1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\\-(n|u)|c55\\/|capi|ccwa|cdm\\-|cell|chtm|cldc|cmd\\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\\-s|devi|dica|dmob|do(c|p)o|ds(12|\\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\\-|_)|g1 u|g560|gene|gf\\-5|g\\-mo|go(\\.w|od)|gr(ad|un)|haie|hcit|hd\\-(m|p|t)|hei\\-|hi(pt|ta)|hp( i|ip)|hs\\-c|ht(c(\\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\\-(20|go|ma)|i230|iac( |\\-|\\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\\/)|klon|kpt |kwc\\-|kyo(c|k)|le(no|xi)|lg( g|\\/(k|l|u)|50|54|\\-[a-w])|libw|lynx|m1\\-w|m3ga|m50\\/|ma(te|ui|xo)|mc(01|21|ca)|m\\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\\-2|po(ck|rt|se)|prox|psio|pt\\-g|qa\\-a|qc(07|12|21|32|60|\\-[2-7]|i\\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\\-|oo|p\\-)|sdk\\/|se(c(\\-|0|1)|47|mc|nd|ri)|sgh\\-|shar|sie(\\-|m)|sk\\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\\-|v\\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\\-|tdg\\-|tel(i|m)|tim\\-|t\\-mo|to(pl|sh)|ts(70|m\\-|m3|m5)|tx\\-9|up(\\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\\-|your|zeto|zte\\-/i.test(a.substr(0, 4))) check = true; })(navigator.userAgent || navigator.vendor || window.opera);\n        return check;\n    }\n\n    var isIOS = /iPad|iPhone|iPod/.test(navigator.userAgent) && !window.MSStream;\n    var isMobile = mobilecheck();\n    var isMobileAndTabled = mobileAndTabletcheck();\n\n    app.constant('SceneOptions', {\n        colors: {\n            background: 0xeae8e8,\n            lines: 0xb4bfdd,\n            overLines: 0x3353a4,\n        },\n        camera: {\n            cameraHeight: -10,\n            targetHeight: 30,\n        },\n        ribbon: {\n            steps: 12,\n            points: 24,\n            vertices: isMobileAndTabled ? 1200 : 2400,\n        },\n        circle: {\n            position: new THREE.Vector3(),\n            radius: 200,\n            lines: 24,\n            points: isMobileAndTabled ? 64 : 128,\n        },\n        audio: {\n            volume: 0.9,\n            bands: isMobileAndTabled ? 64 : 128,\n        },\n        audioStrength: 100,\n        noiseStrength: 25,\n        circularStrength: 0.90,\n        useBackground: false,\n        device: {\n            mobile: isMobileAndTabled,\n            ios: isIOS,\n        }\n    });\n\n}());"]}