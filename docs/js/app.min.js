!function(){"use strict";angular.module("app",["ngSilent","ngRoute","ngSanitize","jsonFormatter"])}(),function(){"use strict";angular.module("app").config(["$httpProvider",function(e){}])}(),function(){"use strict";angular.module("app").config(["$locationProvider","$routeProvider",function(e,t){e.html5Mode(!1),e.hashPrefix(""),t.when("/test",{templateUrl:function(){return"partials/test.html"},controller:"TestCtrl"}).when("/years",{templateUrl:function(){return"partials/years.html"},controller:"YearsCtrl"}).when("/years/:yearsKey",{templateUrl:function(){return"partials/years.html"},controller:"YearsCtrl"}).when("/years/:yearsKey/detail",{templateUrl:function(){return"partials/years.html"},controller:"YearsCtrl"}),t.otherwise("/years")}])}(),function(){"use strict";angular.module("app").run(["$rootScope",function(e){}])}(),function(){"use strict";angular.module("app").factory("DatGui",["$rootScope","SceneOptions","StepperService",function(e,t,n){function o(){function o(t){var n=s.getCurrentStep();n.colors.background=a.colors.background,n.colors.lines=a.colors.lines,n.colors.overLines=a.colors.overLines,n.camera.cameraHeight=a.camera.cameraHeight,n.camera.targetHeight=a.camera.targetHeight,n.circle&&n.circle.position.copy(a.circle.position),e.$broadcast("onOptionsChanged")}function i(e){"a"===e.key.toLowerCase()&&e.ctrlKey&&$(document).find("body").toggleClass("gui-active")}var a=t,s=n,c=new dat.GUI;a.randomize=function(){function e(e){for(var t=0;t<e.length;t++){var n=e[t];if(n.__min){var o=n.__min+(n.__max-n.__min)*Math.random();n.setValue(o),n.updateDisplay()}n.__color&&(n.__color.r=Math.floor(255*Math.random()),n.__color.g=Math.floor(255*Math.random()),n.__color.b=Math.floor(255*Math.random()),n.updateDisplay(),n.setValue(n.__color.hex))}}e(c.__controllers),angular.forEach(c.__folders,function(t){e(t.__controllers)})},a.saveJson=function(){var e=s.steps.map(function(e){e=angular.copy(e);var t={background:"#"+new THREE.Color(e.colors.background).getHexString(),lines:"#"+new THREE.Color(e.colors.lines).getHexString(),overLines:"#"+new THREE.Color(e.colors.overLines).getHexString()};return e.colors=t,e});console.log("saveJson",e),r(e,"rossini.js",!0,!0)},c.closed=!0,c.add(a.camera,"cameraHeight",-10,30).listen().onChange(o),c.add(a.camera,"targetHeight",-10,30).listen().onChange(o);var l=c.addFolder("circlePosition");l.add(a.circle.position,"x",-300,300).listen().onChange(o),l.add(a.circle.position,"y",-300,300).listen().onChange(o),l.add(a.circle.position,"z",-300,300).listen().onChange(o);var u=c.addFolder("colors");return u.addColor(a.colors,"background").listen().onChange(o),u.addColor(a.colors,"lines").listen().onChange(o),u.addColor(a.colors,"overLines").listen().onChange(o),c.add(a.audio,"volume",.01,1).onChange(o),c.add(a,"audioStrength",10,100).onChange(o),c.add(a,"noiseStrength",10,100).onChange(o),c.add(a,"circularStrength",.01,.9).onChange(o),c.add(a,"randomize"),c.add(a,"saveJson"),angular.element(window).on("keydown",i),c}var r=function(){var e=document.createElement("a");return document.body.appendChild(e),e.style="display: none",function(t,n,o,r){o&&(t=r?JSON.stringify(t,null,2):JSON.stringify(t));var i=new Blob([t],{type:"octet/stream"}),a=window.URL.createObjectURL(i);e.href=a,e.download=n,e.click(),window.URL.revokeObjectURL(a)}}();return o}])}(),function(){"use strict";angular.module("app").directive("navTo",["$parse","$timeout",function(e,t){return{restrict:"A",link:function(n,o,r){function i(o){console.log("navTo.onTap",r.navTo),t(function(){e(r.navTo)(n)})}function a(e){i(),o.off("mousedown",s)}function s(e){i(),o.off("touchstart",a)}function c(){o.off("touchstart",a).off("mousedown",s)}!function(){o.on("touchstart",a).on("mousedown",s)}(),n.$on("$destroy",function(){c()})}}}])}(),function(){"use strict";angular.module("app").directive("scrollbar",[function(){return{restrict:"A",link:function(e,t,n,o){function r(){var t=Scrollbar.init(i,a);e.$watch(t.contentEl.offsetHeight,function(e){t.update()})}var i=t[0],a={speed:1,damping:.1,overscrollDamping:1,thumbMinSize:20,continuousScrolling:!0,alwaysShowTracks:!1};setTimeout(r,100)}}}])}(),function(){"use strict";var e=angular.module("app");e.directive("slickTunnel",["$timeout","StepperService","SceneOptions",function(e,t,n){return{restrict:"A",link:function(e,o,r){function i(){o.hasClass("slick-initialized")&&o.slick("unslick")}function a(){i(),o.slick({arrows:!1,dots:!1,fade:!0,speed:1100,infinite:!1,draggable:!1,asNavFor:g.useBackground?".tunnel-bg":null,cssEase:"cubic-bezier(0.7, 0, 0.3, 1)",initialSlide:m.current})}function s(){var e=$(".slick-active .splitted-letter");TweenMax.staggerTo(e,1,{delay:.2,y:0,x:0,ease:Power3.easeInOut,className:"+=viewed",onComplete:function(){$(".slick-active .cta").addClass("active")}},.009)}function c(){var e=$(".slick-active .splitted-letter");TweenMax.staggerTo(e,1,{delay:0,y:100,x:50,ease:Power3.easeInOut,className:"-=viewed"},.009),$(".slick-active .cta").removeClass("active")}function l(){setTimeout(function(){s()},500),e.$root.$broadcast("onSlickInit")}function u(t,n,o,r){m.slicking=!0,c(),e.$root.$broadcast("onSlickBeforeChange",{current:r,previous:o})}function d(t,n,o){m.slicking=!1,s(),e.$root.$broadcast("onSlickAfterChange",{current:o})}function p(e){if(!m.slicking){if(o.hasClass("slick-initialized"))if(e.deltaX>0||e.deltaY<0)o.slick("slickNext");else if(e.deltaX<0||e.deltaY>0){if(1==m.current)return;o.slick("slickPrev")}e.preventDefault()}}function f(){o.off("init",l).off("beforeChange",u).off("afterChange",d).off("mousewheel",p)}var g=n,m=t;!function(){o.on("init",l).on("beforeChange",u).on("afterChange",d).on("mousewheel",p)}(),e.$watchCollection(r.slickTunnel,function(e){e&&e.length&&a()}),e.$on("onGoStep",function(e,t){o.hasClass("slick-initialized")&&o.slick("slickGoTo",t)}),e.$on("$destroy",function(){f(),i()})}}}]),e.directive("slickBackgrounds",[function(){return{restrict:"A",link:function(e,t,n){function o(){t.hasClass("slick-initialized")&&t.slick("unslick")}function r(){o(),t.slick({arrows:!1,dots:!1,fade:!0,speed:1100,infinite:!1,lazyLoad:"ondemand",cssEase:"cubic-bezier(0.7, 0, 0.3, 1)"})}e.$watchCollection(n.slickBackgrounds,function(e){e&&e.length&&setTimeout(r,1)}),e.$on("$destroy",function(){o()})}}}])}(),function(){"use strict";angular.module("app").directive("splitText",[function(){return{restrict:"A",link:function(e,t,n){function o(){var e=t[0].childNodes;e=Array.prototype.slice.call(e,0),t.html("").addClass("active");var n=[[]];e.filter(function(e){return 3===e.nodeType||1===e.nodeType}).map(function(e){if(3===e.nodeType)e={text:$.trim(e.textContent),element:"span"};else{if("br"===e.nodeName.toLowerCase())return void n.push([]);e={text:$.trim(e.innerHTML),element:e.nodeName}}""!==e.text&&n[n.length-1].push(e)});for(var o=0;o<n.length;o++){var r=n[o];$('<div class="splitted-row"></div>').appendTo(t);for(var i=0;i<r.length;i++)for(var a=r[i],s=a.element.toLowerCase(),c=a.text,l=c.split(" "),u=0;u<l.length;u++){$("<"+s+' class="splitted-word"></'+s+">").appendTo($(".splitted-row:last"),t);for(var d=l[u],p=d.split(""),f=0;f<p.length;f++){var g=p[f];$('<span class="splitted-letter" data-content="'+g+'">'+g+"</span>").appendTo($(".splitted-word:last"),t)}$('<span class="splitted-space">&nbsp;</span>').appendTo($(".splitted-word:last"),t)}}}setTimeout(function(){o()},1)}}}])}(),function(){"use strict";angular.module("app").directive("yearsFrom",[function(){return{restrict:"A",scope:{from:"=yearsFrom",to:"=yearsTo"},link:function(e,t,n){function o(){function n(){o.html(parseInt(a.from)),r.html(parseInt(a.to))}var o=t.find(".from"),r=t.find(".to"),i=Power3.easeOut,a={from:o.html(),to:r.html()};e.to?(t.removeClass("one-year"),TweenLite.to(a,2,{to:e.to,roundProps:"year",onUpdate:n,ease:i})):(t.addClass("one-year"),TweenLite.to(a,2,{to:e.from,roundProps:"year",onUpdate:n,ease:i})),TweenLite.to(a,2,{from:e.from,roundProps:"year",onUpdate:n,ease:i})}e.$watch("from",function(e,t){e&&o()})}}}])}(),function(){"use strict";angular.module("app").controller("TestCtrl",["$scope","$route","$routeParams","$ngSilentLocation","MotionService","$timeout",function(e,t,n,o,r,i){function a(){i(function(){c.update()})}function s(){a(),requestAnimationFrame(s)}var c=r;c.init(),s(),e.motion=c}])}(),function(){"use strict";angular.module("app").controller("YearsCtrl",["$scope","$timeout","$route","$routeParams","$ngSilentLocation","$q","State","SceneOptions","StepperService","AudioService","AssetService","DatGui",function(e,t,n,o,r,i,a,s,c,l,u,d){function p(){function n(n){t(function(){e.progress=n})}i.all([f(n),g(n)]).then(function(){m()},function(e){console.log("YearsCtrl.error",e),w.error(e)})}function f(e){var t=[];return E.steps.filter(function(e){e.audio&&-1==t.indexOf(e.audio.url)&&t.push(e.audio.url)}),l.preload(t,e)}function g(e){var t=[];return E.steps.filter(function(e){e.circle&&e.circle.texture&&-1==t.indexOf(e.circle.texture)&&t.push(e.circle.texture)}),u.preload(t,e)}function m(){t(function(){E.navStep(E.current),-1!==n.current.$$route.originalPath.indexOf("/detail")&&t(function(){h()})},1e3),new d,w.ready()}function h(){return r.silent(E.step.detailUrl),E.detail.active=!0,E.detail.operas=[{title:"La cambiale di matrimonio",url:"audio/04-rossini-192.mp3",orchestra:"Academy of St Martin in the Fields Orchestra"},{title:"L’occasione fa il ladro, ossia Il cambio della valigia",url:"audio/04-rossini-192.mp3",orchestra:"Academy of St Martin in the Fields Orchestra"},{title:"Otello"},{title:"Mosè in Egitto"},{title:"Ivanhoé"}],!1}function v(){return r.silent(E.step.url),E.detail.active=!1,!1}var w=new a,y={objects:{},options:s,stepper:c,assets:u},b=y.options,E=y.stepper;w.busy(),E.init(o.yearsKey).then(function(){e.stepper=E,e.scene=y,e.audio=l,b.preload?p():m()}),e.state=w,e.options=b,e.openDetail=h,e.closeDetail=v,e.$on("onStepChanged",function(){r.silent(E.step.url)})}])}(),function(){"use strict";angular.module("app").controller("RootCtrl",["$scope","$route","$location","$http","$timeout","$ngSilentLocation","StepperService",function(e,t,n,o,r,i,a){function s(t){function n(e,t){e&&angular.forEach(e,function(e){e.parent=t,e.years&&(e.years.key=String(e.years.to?e.years.from+"-"+e.years.to:e.years.from),e.url="/years/"+e.years.key),n(e.items,e)})}n(t),e.menu=t,r(function(){nav()},100)}function c(e){var t=a,n=t.steps,o=-1;angular.forEach(n,function(t,n){t.url===e.url&&(o=n)}),-1!==o&&(t.navStep(o),i.silent(e.url))}function l(n,o){n.url?(-1!==n.url.indexOf("/years")&&-1!==t.current.$$route.originalPath.indexOf("/years")&&(a.detail.active=!1,closeNav(),r(function(){c(n)},1e3)),e.submenu=null,console.log("RootCtrl.navTo",n.url)):2===o&&n.items&&(e.submenu?r(function(){e.submenu=n},1e3):e.submenu=n)}o.get("json/menu-rossini.js").then(function(e){s(e.data)},function(e){console.log("RootCtrl.error",e)}),e.navTo=l}])}(),function(){angular.module("app").factory("State",["$timeout",function(e){function t(){this.errors=[],this.isReady=!1,this.idle()}function n(){this.isBusy=!1,this.isError=!1,this.isErroring=!1,this.isSuccess=!1,this.isSuccessing=!1,this.button=null}function o(){return!this.isBusy&&!this.isErroring&&!this.isSuccessing}function r(){return!this.isBusy&&(this.isBusy=!0,this.isError=!1,this.isErroring=!1,this.isSuccess=!1,this.isSuccessing=!1,this.errors=[],!0)}function i(){this.isBusy=!1,this.isError=!1,this.isErroring=!1,this.isSuccess=!0,this.isSuccessing=!0,this.errors=[],e(function(){this.isSuccessing=!1}.bind(this),p)}function a(t){this.isBusy=!1,this.isError=!0,this.isErroring=!0,this.isSuccess=!1,this.isSuccessing=!1,this.errors.push(t),e(function(){this.isErroring=!1}.bind(this),p)}function s(){this.idle(),this.isReady=!0}function c(){return this.errors.length>0?this.errors[this.errors.length-1]:null}function l(){return{busy:this.isBusy,ready:this.isReady,successing:this.isSuccessing,success:this.isSuccess,errorring:this.isErroring,error:this.isError}}function u(e,t){var n={ready:"submit",busy:"sending",error:"error",erroring:"erroring",success:"success",successing:"successing"};e&&angular.extend(n,e);var o=n.ready;return this.isBusy?o=n.busy:this.isSuccessing?o=n.successing:this.isErroring&&(o=n.erroring),t&&(this.isSuccess?o=n.success:this.isError&&(o=n.error)),o}function d(e){var t=this,n=null;return n={ready:t.isReady,busy:t.isBusy,successing:t.isSuccessing,success:t.isSuccess,errorring:t.isErroring,error:t.isError,pulse:t.isBusy,flash:t.isErroring||t.isSuccessing},e&&angular.forEach(e,function(e,t){n[e]=n[t]}),n}var p=2e3;return t.prototype={idle:n,busy:r,enabled:o,error:a,ready:s,success:i,errorMessage:c,submitClass:l,labels:u,classes:d},t}])}(),function(){"use strict";angular.module("app").service("AssetService",["$q",function(e){function t(t,o){function r(e){a[e.path]=e,angular.forEach(a,function(t){e.loaded+=t.loaded,e.total+=t.total}),e.progress=e.loaded/e.total,o(e)}var i=e.defer(),a={},s={loaded:0,total:0};return e.all(t.map(function(e){return n(e,r)})).then(function(){s.loaded=s.total,s.progress=1,o(s),i.resolve()},function(e){console.log("AssetService.preload.error",e),i.reject(e)}),i.promise}function n(t,n){var r=e.defer(),i={path:t,loaded:0,total:1},a=new XMLHttpRequest;return a.responseType="arraybuffer",a.open("GET",t,!0),a.onload=function(){var e=new Blob([a.response]),n=new Image;n.src=window.URL.createObjectURL(e),o[t]=n,r.resolve(n)},a.onerror=function(e){console.log("AssetService.xhr.onerror",e),r.reject(e)},n&&(a.onprogress=function(e){i.loaded=e.loaded,i.total=e.total,i.progress=e.loaded/e.total,n(i)}),a.send(),r.promise}var o={};this.load=n,this.preload=t,this.images=o}])}(),function(){"use strict";var e=angular.module("app");e.factory("AudioSound",["$q","SceneOptions",function(e,t){function n(e){var t={volume:.85,loop:!1};e&&angular.extend(t,e);var n=this;n.options=t,n.offset=t.offset||0,this.addAnalyserNode(),this.addGainNode()}function o(t,n){var o=e.defer(),a={path:t,loaded:0,total:1},s=new XMLHttpRequest;return s.responseType="arraybuffer",s.open("GET",t,!0),s.onload=function(){r.decodeAudioData(s.response,function(e){if(!e)return console.log("AudioSound.load.decodeAudioData.error",t),void o.reject("AudioSound.load.decodeAudioData.error");i[t]=e,o.resolve(e)})},s.onerror=function(e){console.log("AudioManager.xhr.onerror",e),o.reject(e)},n&&(s.onprogress=function(e){a.loaded=e.loaded,a.total=e.total,a.progress=e.loaded/e.total,n(a)}),s.send(),o.promise}window.AudioContext=window.AudioContext||window.webkitAudioContext;var r=new AudioContext,i={};return n.prototype={nodes:{},addGainNode:function(){var e=this,t=r.createGain?r.createGain():r.createGainNode();t.gain.value=e.options.volume,e.nodes.gain=t},addAnalyserNode:function(){var e=this;if(e.options.analyser){var n=r.createAnalyser();n.fftSize=2*t.audio.bands,e.data=new Uint8Array(n.frequencyBinCount),e.nodes.analyser=n}},connectNodes:function(){var e=this,t=e.source;for(var n in e.nodes){var o=e.nodes[n];t.connect(o),"gain"===n&&o.connect(r.destination)}},disconnect:function(){var e=this,t=e.source;if(t){for(var n in e.nodes){var o=e.nodes[n];"gain"===n&&o.disconnect(r.destination),t.disconnect(e.nodes[n])}e.source=null}},updateBuffer:function(){var t=e.defer(),n=this,o=n.source;return n.getBuffer().then(function(e){o?o.buffer=e:(o=r.createBufferSource(),o.buffer=e,n.source=o,n.connectNodes()),t.resolve(o)},function(e){t.reject(e)}),t.promise},getBuffer:function(){var t=e.defer(),o=this,r=o.path,a=i[r];return a?t.resolve(a):n.load(r).then(function(e){o.path===r&&t.resolve(e)},function(e){t.reject(e)}),t.promise},getSource:function(){var t=e.defer(),n=this,o=n.source;return o?t.resolve(o):n.getBuffer().then(function(e){var o=null;n.playing&&(o=n.source)&&("function"==typeof o.stop?o.stop(0):o.noteOff(0),n.disconnect()),o=r.createBufferSource(),o.buffer=e,n.source=o,n.connectNodes(),t.resolve(o)},function(e){t.reject(e)}),t.promise},play:function(){var e=this;if(!e.playing){var t=e.options;e.getSource().then(function(n){e.startTime=r.currentTime,n.loop=t.loop,"function"==typeof n.start?n.start(0,e.offset):n.noteOn(0,e.offset),e.playing=!0})}},stop:function(){var e=this;if(e.playing){var t=e.source;t&&(e.offset+=e.startTime?r.currentTime-e.startTime:0,"function"==typeof t.stop?t.stop(0):t.noteOff(0),e.disconnect(),e.playing=!1)}},update:function(){var e=this;e.nodes.analyser&&e.nodes.analyser.getByteFrequencyData(e.data)},setPath:function(e){var t=this;e&&t.path!==e&&(t.stop(),t.path=e,t.offset=t.options.offset||0,console.log("AudioSound.setPath",e))},setVolume:function(e){var t=this;e!==t.options.volume&&(t.options.volume=e,t.nodes.gain.gain.value=e)}},n.load=o,n}]),e.service("AudioService",["$rootScope","$timeout","$q","$http","AudioSound","SceneOptions","StepperService",function(e,t,n,o,r,i,a){function s(){return k.data}function c(){var e=E.getCurrentStep();l(e.audio?e.audio.url:null)}function l(e){k.setPath(e),f()}function u(e){e.url&&(y.active=!0,l(e.url))}function d(e){k.setVolume(e)}function p(){y.active&&k.playing&&(k.setVolume(b.audio.volume),k.update())}function f(){y.active&&k.path&&!k.playing&&k.play()}function g(){k.playing&&k.stop()}function m(){y.active=!y.active,y.active?f():g()}function h(){return y.active&&k.playing}function v(){return k.playing}function w(e,t){function o(e){a[e.path]=e;angular.forEach(a,function(t){e.loaded+=t.loaded,e.total+=t.total}),e.progress=e.loaded/e.total,t(e)}var i=n.defer(),a={},s={loaded:0,total:0};return n.all(e.map(function(e){return r.load(e,o)})).then(function(){s.loaded=s.total,s.progress=1,t(s),i.resolve()},function(e){console.log("AudioSound.preload.error",e),i.reject(e)}),i.promise}var y=this,b=i,E=a,k=new r({analyser:!0,loop:!0});e.$on("onStepChanged",function(e){c()}),e.$on("onOptionsChanged",function(e){k.setVolume(b.audio.volume)}),this.active=!0,this.getData=s,this.setVolume=d,this.setAudio=u,this.update=p,this.play=f,this.pause=g,this.toggle=m,this.isPlaying=v,this.isActive=h,this.preload=w}])}(),function(){"use strict";var e=angular.module("app");Date.now;e.service("MotionService",["$rootScope",function(e){function t(t,n,o){i.x=t,i.y=n,i.z=o,e.$broadcast("onDeviceMotion",i)}function n(){window.DeviceOrientationEvent&&window.addEventListener("deviceorientation",o,!0)}function o(e){var n=e.beta,o=e.gamma,r=0;n=Math.min(n,30),n=Math.max(n,-30),o/=20,n/=20,r/=20,t(o,n,r)}function r(){n()}var i=this;i.x=0,i.y=0,i.z=0,i.init=r}])}(),function(){"use strict";angular.module("app").service("StepperService",["$rootScope","$timeout","$q","$http","$sce","SceneOptions",function(e,t,n,o,r,i){function a(e){var t=n.defer(),i=0;return E.length?(angular.forEach(E,function(t,n){t.years.key===e&&(i=n)}),x.pow=i/E.length,w.current=b=i,t.resolve(E)):o.get("json/rossini.js").then(function(n){var o=n.data;angular.forEach(o,function(t,n){t.years.key=String(t.years.to?t.years.from+"-"+t.years.to:t.years.from),t.url="/years/"+t.years.key,t.detailUrl=t.url+"/detail",t.years.key===e&&(i=n),t.titleTrusted=r.trustAsHtml(t.title),t.contrast=v(t.colors.background),t.circle&&(t.circle.position=(new THREE.Vector3).copy(t.circle.position)),E.push(t)}),x.pow=i/E.length,w.current=b=i,t.resolve(E)},function(e){t.reject(e)}),t.promise}function s(){for(;k.length;)k.pop().kill()}function c(e,t,n,o){s();var r=(new THREE.Color(t.colors.background),new THREE.Color(t.colors.lines)),i=new THREE.Color(t.colors.overLines);k.push(TweenLite.to(w.values,n,{pow:e,cameraHeight:t.camera.cameraHeight,targetHeight:t.camera.targetHeight,delay:0,ease:Power2.easeInOut,onComplete:function(){o&&o()}})),k.push(TweenLite.to(w.values.lines,n,{r:r.r,g:r.g,b:r.b,delay:0,ease:Power2.easeInOut})),k.push(TweenLite.to(w.values.overLines,n,{r:i.r,g:i.g,b:i.b,delay:0,ease:Power2.easeInOut}))}function l(e){var t=w.current,n=E[t];c(t/E.length,n,e,function(){s()})}function u(n){t(function(){var t=w.current||0;w.current=b=n;var o=E[n];w.step=o,y.colors.background=o.colors.background,y.colors.lines=o.colors.lines,y.colors.overLines=o.colors.overLines,y.camera.cameraHeight=o.camera.cameraHeight,y.camera.targetHeight=o.camera.targetHeight,o.circle&&y.circle.position.copy(o.circle.position),h(n),e.$broadcast("onStepChanged",{current:n,previous:t}),l(w.duration)})}function d(){return E[b]}function p(e){return E[e]}function f(){w.slicking||(b--,b=Math.max(0,b),m(b),e.$broadcast("onGoStep",b))}function g(){w.slicking||(b++,b=Math.min(E.length-1,b),m(b),e.$broadcast("onGoStep",b))}function m(n){u(n),e.$broadcast("onGoStep",n),t(function(){var e=$(".tunnel-nav__step.active");if(e.length){var t=e.position().top,n=e.width()+16;$(".tunnel-nav__follower").css({width:n+"px","-webkit-transform":"translateY("+t+"px)","-moz-transform":"translateY("+t+"px)","-ms-transform":"translateY("+t+"px)",transform:"translateY("+t+"px)"})}})}function h(e){if(!y.useBackground){var t=w.getStepAtIndex(e),n=new THREE.Color(t.colors.background).getHexString();$(".tunnel-gradient").css("background-color","#"+n)}}function v(e){var t=new THREE.Color(e);return.299*parseInt(255*t.r)+.587*parseInt(255*t.g)+.114*parseInt(255*t.b)>125?"light-bg":"dark-bg"}var w=this,y=i,b=0,E=[],k=[],S={},x={pow:0,background:new THREE.Color(y.colors.background),lines:new THREE.Color(y.colors.lines),overLines:new THREE.Color(y.colors.overLines),cameraHeight:y.camera.cameraHeight,targetHeight:y.camera.targetHeight};e.$on("onOptionsChanged",function(){var e=w.current,t=E[e];w.values.cameraHeight=t.camera.cameraHeight,w.values.targetHeight=t.camera.targetHeight,w.values.background.copy(new THREE.Color(t.colors.background)),w.values.lines.copy(new THREE.Color(t.colors.lines)),w.values.overLines.copy(new THREE.Color(t.colors.overLines)),h(e)}),e.$on("onSlickBeforeChange",function(e,t){m(t.current)}),this.init=a,this.values=x,this.duration=2.5,this.steps=E,this.navStep=m,this.getCurrentStep=d,this.getStepAtIndex=p,this.current=b,this.detail=S,this.previous=f,this.next=g}])}(),function(){"use strict";function e(e,n){for(var o=e*n,r=new Uint8Array(o),i=new t,a=1,s=100*Math.random(),c=0;c<4;c++){for(var l=0;l<o;l++){var u=l%e,d=~~(l/e);r[l]+=Math.abs(i.noise(u/a,d/a,s)*a*1.75)}a*=5}return r}function t(){function e(e){return e*e*e*(e*(6*e-15)+10)}function t(e,t,n){return t+e*(n-t)}function n(e,t,n,o){var r=15&e,i=r<8?t:n,a=r<4?n:12==r||14==r?t:o;return(0==(1&r)?i:-i)+(0==(2&r)?a:-a)}for(var o=[151,160,137,91,90,15,131,13,201,95,96,53,194,233,7,225,140,36,103,30,69,142,8,99,37,240,21,10,23,190,6,148,247,120,234,75,0,26,197,62,94,252,219,203,117,35,11,32,57,177,33,88,237,149,56,87,174,20,125,136,171,168,68,175,74,165,71,134,139,48,27,166,77,146,158,231,83,111,229,122,60,211,133,230,220,105,92,41,55,46,245,40,244,102,143,54,65,25,63,161,1,216,80,73,209,76,132,187,208,89,18,169,200,196,135,130,116,188,159,86,164,100,109,198,173,186,3,64,52,217,226,250,124,123,5,202,38,147,118,126,255,82,85,212,207,206,59,227,47,16,58,17,182,189,28,42,223,183,170,213,119,248,152,2,44,154,163,70,221,153,101,155,167,43,172,9,129,22,39,253,19,98,108,110,79,113,224,232,178,185,112,104,218,246,97,228,251,34,242,193,238,210,144,12,191,179,162,241,81,51,145,235,249,14,239,107,49,192,214,31,181,199,106,157,184,84,204,176,115,121,50,45,127,4,150,254,138,236,205,93,222,114,67,29,24,72,243,141,128,195,78,66,215,61,156,180],r=0;r<256;r++)o[256+r]=o[r];return{noise:function(r,i,a){var s=Math.floor(r),c=Math.floor(i),l=Math.floor(a),u=255&s,d=255&c,p=255&l;r-=s,i-=c,a-=l;var f=r-1,g=i-1,m=a-1,h=e(r),v=e(i),w=e(a),y=o[u]+d,b=o[y]+p,E=o[y+1]+p,k=o[u+1]+d,S=o[k]+p,x=o[k+1]+p;return t(w,t(v,t(h,n(o[b],r,i,a),n(o[S],f,i,a)),t(h,n(o[E],r,g,a),n(o[x],f,g,a))),t(v,t(h,n(o[b+1],r,i,m),n(o[S+1],f,i,a-1)),t(h,n(o[E+1],r,g,m),n(o[x+1],f,g,m))))}}}function n(e,t,n){var o=2*Math.random()-1,r=Math.abs(o);return(n?Math.floor(o/r):1)*(e+(t-e)*r)}angular.module("app").directive("scene",["SceneOptions","StepperService","AudioService","AssetService","MotionService",function(t,o,r,i,a){return{restrict:"A",scope:{data:"=scene"},link:function(s,c,l){function u(){H.device.mobile?(z.x=20*j.x,z.y=20*j.y):(z.x=20*L.x,z.y=20*L.y);var e=z.x/4,t=z.y/4;if(O.x+=(e-O.x)*P,O.y+=(t-O.y)*P,0===$(".detail-active").length){var n="translate("+-4*O.x+"px, "+-2*O.y+"px)";$(".tunnel-year__wrap").css({"-webit-transform":n,"-moz-transform":n,transform:n})}var o="translate("+O.x+"px, "+O.y+"px)";$(".tunnel-slick .slick-active .tunnel-slick__item").css({"-webit-transform":o,"-moz-transform":o,transform:o}),z.x+=10*Math.cos(z.i/100),z.y+=10*Math.sin(z.i/100),z.i++}function d(){function e(){y.add(p)}function t(){y.remove(p)}function o(){var e=1/R.steps.length,t=.1*e,n=R.values.pow,o=(n+t).mod(1),r=(R.getCurrentStep(),l.getPointAt(n));r.y+=R.values.cameraHeight;var i=l.getPointAt(o);i.y+=R.values.targetHeight,b.position.copy(r),b.target.copy(i),b.position.x+=(r.x+z.x-b.position.x)*P,b.position.y+=(r.y+z.y-b.position.y)*P,b.lookAt(b.target)}var r=new THREE.Vector2(window.innerWidth,window.innerHeight),i=new MeshLineMaterial({color:R.values.lines,lineWidth:5,opacity:.8,transparent:!0,depthTest:!1,sizeAttenuation:!0,resolution:r,near:b.near,far:b.far}),a=new THREE.Vector3,s=new Array(H.ribbon.points).fill(null).map(function(){var e=(new THREE.Vector3).copy(a);return a.x+=n(500,1e3,!0),a.y+=n(10,40,!0),a.z+=n(1e3,2e3,!1),e}),c=new THREE.CatmullRomCurve3(s);c.type="catmullrom",c.closed=!1;var l=new THREE.CatmullRomCurve3(c.points.map(function(e){return new THREE.Vector3(e.x,e.y+20,e.z)}));l.type="catmullrom",l.closed=!1;var u=new THREE.Geometry;u.vertices=c.getPoints(H.ribbon.vertices);var d=new MeshLine;d.setGeometry(u);var p=new THREE.Mesh(d.geometry,i);return e(),b.target=b.target||new THREE.Vector3(0,0,0),{object:p,spline:c,cameraSpline:l,geometry:u,material:i,add:e,remove:t,update:o}}function p(e,t){t=t||512;var n=t/2,o=document.createElement("canvas");o.width=t,o.height=t;var r=o.getContext("2d");r.beginPath(),r.arc(n,n,n-1,0,2*Math.PI),r.clip();var i=new THREE.MeshBasicMaterial({color:16777215,map:new THREE.Texture(o),transparent:!0}),a=R.getStepAtIndex(e),s=a.circle.texture,c=null;return H.preload?(c=A.images[s],r.drawImage(c,0,0,t,t),i.map.needsUpdate=!0):(c=new Image,c.onload=function(){r.drawImage(c,0,0,t,t),i.map.needsUpdate=!0},c.src=s),i}function f(t){function n(){y.add(u),F.adding=Date.now(),F.removing=!1,F.enabled=!0,F.tween&&F.tween.kill(),F.tween=TweenLite.to(F,.35,{pow:1,delay:0,ease:Power2.easeOut,onComplete:function(){F.adding=!1}})}function o(){F.adding=!1,F.removing=Date.now(),F.tween&&F.tween.kill(),F.tween=TweenLite.to(F,.35,{pow:0,delay:0,ease:Power2.easeOut,onComplete:function(){F.removing=!1,F.enabled=!1,y.remove(u)}})}function r(e,t){var n=new THREE.Geometry,o=a(n,t,1);$.push(o);var r=null;if(G){var i=new MeshLine;i.setGeometry(n),j.push(n),L.push(i),r=new THREE.Mesh(i.geometry,x)}else r=new THREE.LineLoop(n,E.clone());return q.add(r),r}function i(e,t){var n=new THREE.Geometry,o=a(n,t,2);A.push(o);var r=null;if(G){var i=new MeshLine;i.setGeometry(n),B.push(n),O.push(i),r=new THREE.Mesh(i.geometry,T)}else r=new THREE.LineLoop(n,S.clone());return N.add(r),r}function a(e,n,o){var r=new Array(m).fill(null).map(function(r,i){var a=i/m,s=360*a;s+=60*t,s+=30*o,s+=360/m*.1*n;var c=s*Math.PI/180,l=H.circle.radius,u=0;return u+=n*n*n*.005,r=new THREE.Vector3,r.sincos={base:l,increment:u,radius:l,x:Math.cos(c),y:Math.sin(c)},e.vertices.push(r),r});return e.vertices.push(r[0]),r}function s(e,t,n,o){var r=H.audioStrength,i=H.noiseStrength,a=H.circularStrength,s=1===o?d:f,c=M.getData(),l=0;angular.forEach(t,function(e,t){var u=H.audio.bands,d=t%u,p=(m-1-t)%u,f=c?(c[d]+c[p])/2/u:0;l+=f;var h=1===o?0:64,v=n*m+(t+h+0)%m,w=n*m+(m-1-t-h+0)%m,y=(s[v]+s[w])/2/64,b=1-(g-n)/g*a,E=e.sincos.base+e.sincos.increment*y+e.sincos.increment*f+i*y*b+r*f*b+0;e.sincos.radius=E,e.x=e.sincos.x*e.sincos.radius,e.y=e.sincos.y*e.sincos.radius,e.z=10*o+.01*n}),1===o&&(D.scale.x=1+l/t.length),e.verticesNeedUpdate=!0}function c(){w.opacity=F.pow,angular.forEach(V,function(e,t){s(e.geometry,$[t],t,1),e.material.opacity=(0+1*t/g)*F.pow,e.material.color=R.values.lines,G&&L[t].setGeometry(j[t])}),angular.forEach(Y,function(e,t){s(e.geometry,A[t],t,2),e.material.opacity=(0+1*t/g)*F.pow,e.material.color=R.values.overLines,G&&O[t].setGeometry(B[t])}),q.rotation.z+=.001,N.rotation.z-=.001,k>1023?I.position.copy(h.circle.position):I.position.copy(W),I.rotation.x+=(.00625*z.y-I.rotation.x)*P,I.rotation.y+=(.0125*z.x-I.rotation.y)*P;var e=C.ribbon.cameraSpline.getPointAt((t+.1)/R.steps.length);e.y+=R.values.targetHeight,u.position.copy(e),u.scale.x=u.scale.y=u.scale.z=.001+.14*F.pow,u.lookAt(b.position)}var l,u,d=e(H.circle.points,H.circle.lines),f=e(H.circle.points,H.circle.lines),g=H.circle.lines,m=H.circle.points,h=R.getStepAtIndex(t),v=new THREE.Vector2(window.innerWidth,window.innerHeight),w=p(t),E=new THREE.LineBasicMaterial({color:R.values.lines,transparent:!0}),S=new THREE.LineBasicMaterial({color:R.values.overLines,transparent:!0}),x=new MeshLineMaterial({color:R.values.lines,lineWidth:1,depthTest:!1,opacity:1,transparent:!0,resolution:v,near:b.near,far:b.far}),T=new MeshLineMaterial({color:R.values.overLines,lineWidth:1,depthTest:!1,opacity:1,transparent:!0,resolution:v,near:b.near,far:b.far});u=new THREE.Object3D;var $=[],A=[],L=[],O=[],j=[],B=[],G=!1,I=new THREE.Object3D;u.add(I),l=new THREE.PlaneGeometry(2*H.circle.radius-20,2*H.circle.radius-20,8,8);var D=new THREE.Mesh(l,_);D.position.y=-400,D.rotation.x=-Math.PI/2,D.scale.z=.5,I.add(D),l=new THREE.PlaneGeometry(2*H.circle.radius-20,2*H.circle.radius-20,8,8);var U=new THREE.Mesh(l,w);U.position.z=-30,I.add(U);var q=new THREE.Object3D;I.add(q);var N=new THREE.Object3D;I.add(N);var V=new Array(g).fill(null).map(r),Y=new Array(g).fill(null).map(i),F={pow:0,enabled:!1,adding:!1,removing:!1},W=new THREE.Vector3(0,100,0);return{add:n,remove:o,object:u,state:F,update:c}}function g(){u(),M.update(),C.ribbon&&C.ribbon.update(),angular.forEach(C.circles,function(e){e&&e.state.enabled&&e.update()})}function m(){g(),E.render(y,b)}function h(){w.begin(),m(),w.end(),requestAnimationFrame(h)}var v=s.data;if(v){var w,y,b,E,k,S,x,T,C=v.objects,H=t,R=o,M=r,A=i;console.log("scene.options",H),s.$on("onStepChanged",function(e,t){var n=null,o=t.current,r=t.previous;o>0&&(n=C.circles[o]||f(o),n.add()),C.circles[o]=n,setTimeout(function(){if(R.current!==r&&r>0){var e=C.circles[r];e&&e.remove()}},1e3*R.duration)}),s.$on("onOptionsChanged",function(e){});var L={x:0,y:0},z={x:0,y:0,i:0},O={x:0,y:0},P=1/12,j=a;H.device.mobile&&j.init();var _=function(e){e=e||512;var t=e/2,n=document.createElement("canvas");n.width=e,n.height=e;var o=n.getContext("2d"),r=o.createRadialGradient(t,t,30,t,t,t);r.addColorStop(0,"rgba(0,0,0,0.35)"),r.addColorStop(.1,"rgba(0,0,0,0.33)"),r.addColorStop(1,"rgba(0,0,0,0.0)"),o.fillStyle=r,o.fillRect(0,0,e,e);var i=new THREE.MeshBasicMaterial({color:16777215,map:new THREE.Texture(n),transparent:!0});return i.map.needsUpdate=!0,i}();!function(){k=window.innerWidth,S=window.innerHeight,x=k/2,T=S/2;var e=k/S;y=new THREE.Scene,b=new THREE.PerspectiveCamera(30,e,1,2e4),E=new THREE.WebGLRenderer({alpha:!0,antialias:!0,logarithmicDepthBuffer:!0}),E.setClearColor(0,0),E.setSize(k,S),E.sortObjects=!1,w=new Stats,c[0].appendChild(E.domElement),c[0].appendChild(w.dom)}(),function(){C.ribbon=d(),C.circles=new Array(R.steps).fill(null)}(),function(){function e(){k=window.innerWidth,S=window.innerHeight,x=k/2,T=S/2,E.setSize(k,S),b.aspect=k/S,b.updateProjectionMatrix()}function t(e){var t=window.innerWidth/2,n=window.innerHeight/2;L.x=(e.clientX-t)/t,L.y=(e.clientY-n)/n}window.addEventListener("resize",e,!1),document.addEventListener("mousemove",t,!1)}(),h()}}}}]),Number.prototype.mod=function(e){return(this%e+e)%e}}(),function(){"use strict";var e=angular.module("app"),t=/iPad|iPhone|iPod/.test(navigator.userAgent)&&!window.MSStream,n=(function(){var e=!1;(function(t){
(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(t)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(t.substr(0,4)))&&(e=!0)})(navigator.userAgent||navigator.vendor||window.opera)}(),function(){var e=!1;return function(t){(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino|android|ipad|playbook|silk/i.test(t)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(t.substr(0,4)))&&(e=!0)}(navigator.userAgent||navigator.vendor||window.opera),e}());e.constant("SceneOptions",{colors:{background:15395048,lines:11845597,overLines:3363748},camera:{cameraHeight:-10,targetHeight:30},ribbon:{steps:12,points:24,vertices:n?1200:2400},circle:{position:new THREE.Vector3,radius:200,lines:n?12:24,points:n?64:128},audio:{volume:.9,bands:n?64:128},audioStrength:100,noiseStrength:25,circularStrength:.9,useBackground:!1,device:{mobile:n,ios:t},preload:!0})}();
//# sourceMappingURL=app.min.js.map
