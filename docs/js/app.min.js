!function(){"use strict";angular.module("app",["ngSilent","ngRoute","ngSanitize","jsonFormatter"])}(),function(){"use strict";angular.module("app").config(["$httpProvider",function(e){}])}(),function(){"use strict";angular.module("app").config(["$locationProvider","$routeProvider",function(e,n){e.html5Mode(!1),e.hashPrefix(""),n.when("/test",{templateUrl:function(){return"partials/test.html"},controller:"TestCtrl"}).when("/years",{templateUrl:function(){return"partials/years.html"},controller:"YearsCtrl"}).when("/years/:yearsKey",{templateUrl:function(){return"partials/years.html"},controller:"YearsCtrl"}).when("/years/:yearsKey/detail",{templateUrl:function(){return"partials/years.html"},controller:"YearsCtrl"}),n.otherwise("/years")}])}(),function(){"use strict";angular.module("app").run(["$rootScope",function(e){}])}(),function(){"use strict";angular.module("app").factory("DatGui",["$rootScope","SceneOptions","StepperService",function(e,n,t){function o(){function o(n){var t=s.getCurrentStep();t.colors.background=i.colors.background,t.colors.lines=i.colors.lines,t.colors.overLines=i.colors.overLines,t.camera.cameraHeight=i.camera.cameraHeight,t.camera.targetHeight=i.camera.targetHeight,t.circle.position.copy(i.circle.position),e.$broadcast("onOptionsChanged")}function a(e){"a"===e.key.toLowerCase()&&e.ctrlKey&&$(document).find("body").toggleClass("gui-active")}var i=n,s=t,c=new dat.GUI;i.randomize=function(){function e(e){for(var n=0;n<e.length;n++){var t=e[n];if(t.__min){var o=t.__min+(t.__max-t.__min)*Math.random();t.setValue(o),t.updateDisplay()}t.__color&&(t.__color.r=Math.floor(255*Math.random()),t.__color.g=Math.floor(255*Math.random()),t.__color.b=Math.floor(255*Math.random()),t.updateDisplay(),t.setValue(t.__color.hex))}}e(c.__controllers),angular.forEach(c.__folders,function(n){e(n.__controllers)})},i.saveJson=function(){var e=s.steps.map(function(e){e=angular.copy(e);var n={background:"#"+new THREE.Color(e.colors.background).getHexString(),lines:"#"+new THREE.Color(e.colors.lines).getHexString(),overLines:"#"+new THREE.Color(e.colors.overLines).getHexString()};return e.colors=n,e});console.log("saveJson",e),r(e,"rossini.js",!0,!0)},c.closed=!0,c.add(i.camera,"cameraHeight",-10,30).listen().onChange(o),c.add(i.camera,"targetHeight",-10,30).listen().onChange(o);var l=c.addFolder("circlePosition");l.add(i.circle.position,"x",-300,300).listen().onChange(o),l.add(i.circle.position,"y",-300,300).listen().onChange(o),l.add(i.circle.position,"z",-300,300).listen().onChange(o);var u=c.addFolder("colors");return u.addColor(i.colors,"background").listen().onChange(o),u.addColor(i.colors,"lines").listen().onChange(o),u.addColor(i.colors,"overLines").listen().onChange(o),c.add(i.audio,"volume",.01,1).onChange(o),c.add(i,"audioStrength",10,100).onChange(o),c.add(i,"noiseStrength",10,100).onChange(o),c.add(i,"circularStrength",.01,.9).onChange(o),c.add(i,"randomize"),c.add(i,"saveJson"),angular.element(window).on("keydown",a),c}var r=function(){var e=document.createElement("a");return document.body.appendChild(e),e.style="display: none",function(n,t,o,r){o&&(n=r?JSON.stringify(n,null,2):JSON.stringify(n));var a=new Blob([n],{type:"octet/stream"}),i=window.URL.createObjectURL(a);e.href=i,e.download=t,e.click(),window.URL.revokeObjectURL(i)}}();return o}])}(),function(){"use strict";angular.module("app").directive("scrollbar",[function(){return{restrict:"A",link:function(e,n,t,o){function r(){var n=Scrollbar.init(a,i);e.$watch(n.contentEl.offsetHeight,function(e){n.update()})}var a=n[0],i={speed:1,damping:.1,overscrollDamping:1,thumbMinSize:20,continuousScrolling:!0,alwaysShowTracks:!1};setTimeout(r,100)}}}])}(),function(){"use strict";var e=angular.module("app");e.directive("slickTunnel",["$timeout","StepperService","SceneOptions",function(e,n,t){return{restrict:"A",link:function(e,o,r){function a(){o.hasClass("slick-initialized")&&o.slick("unslick")}function i(){a(),o.slick({arrows:!1,dots:!1,fade:!0,speed:1100,infinite:!1,draggable:!1,asNavFor:m.useBackground?".tunnel-bg":null,cssEase:"cubic-bezier(0.7, 0, 0.3, 1)",initialSlide:g.current})}function s(){var e=$(".slick-active .splitted-letter");TweenMax.staggerTo(e,1,{delay:.2,y:0,x:0,ease:Power3.easeInOut,className:"+=viewed",onComplete:function(){$(".slick-active .cta").addClass("active")}},.009)}function c(){var e=$(".slick-active .splitted-letter");TweenMax.staggerTo(e,1,{delay:0,y:100,x:50,ease:Power3.easeInOut,className:"-=viewed"},.009),$(".slick-active .cta").removeClass("active")}function l(){setTimeout(function(){s()},500),e.$root.$broadcast("onSlickInit")}function u(n,t,o,r){g.slicking=!0,c(),e.$root.$broadcast("onSlickBeforeChange",{current:r,previous:o})}function d(n,t,o){g.slicking=!1,s(),e.$root.$broadcast("onSlickAfterChange",{current:o})}function p(e){if(!g.slicking){if(o.hasClass("slick-initialized"))if(e.deltaX>0||e.deltaY<0)o.slick("slickNext");else if(e.deltaX<0||e.deltaY>0){if(1==g.current)return;o.slick("slickPrev")}e.preventDefault()}}function f(){o.off("init",l).off("beforeChange",u).off("afterChange",d).off("mousewheel",p)}var m=t,g=n;!function(){o.on("init",l).on("beforeChange",u).on("afterChange",d).on("mousewheel",p)}(),e.$watchCollection(r.slickTunnel,function(e){e&&e.length&&i()}),e.$on("onGoStep",function(e,n){o.hasClass("slick-initialized")&&o.slick("slickGoTo",n)}),e.$on("$destroy",function(){f(),a()})}}}]),e.directive("slickBackgrounds",[function(){return{restrict:"A",link:function(e,n,t){function o(){n.hasClass("slick-initialized")&&n.slick("unslick")}function r(){o(),n.slick({arrows:!1,dots:!1,fade:!0,speed:1100,infinite:!1,lazyLoad:"ondemand",cssEase:"cubic-bezier(0.7, 0, 0.3, 1)"})}e.$watchCollection(t.slickBackgrounds,function(e){e&&e.length&&setTimeout(r,1)}),e.$on("$destroy",function(){o()})}}}])}(),function(){"use strict";angular.module("app").directive("splitText",[function(){return{restrict:"A",link:function(e,n,t){function o(){var e=n[0].childNodes;e=Array.prototype.slice.call(e,0),n.html("").addClass("active");var t=[[]];e.filter(function(e){return 3===e.nodeType||1===e.nodeType}).map(function(e){if(3===e.nodeType)e={text:$.trim(e.textContent),element:"span"};else{if("br"===e.nodeName.toLowerCase())return void t.push([]);e={text:$.trim(e.innerHTML),element:e.nodeName}}""!==e.text&&t[t.length-1].push(e)});for(var o=0;o<t.length;o++){var r=t[o];$('<div class="splitted-row"></div>').appendTo(n);for(var a=0;a<r.length;a++)for(var i=r[a],s=i.element.toLowerCase(),c=i.text,l=c.split(" "),u=0;u<l.length;u++){$("<"+s+' class="splitted-word"></'+s+">").appendTo($(".splitted-row:last"),n);for(var d=l[u],p=d.split(""),f=0;f<p.length;f++){var m=p[f];$('<span class="splitted-letter" data-content="'+m+'">'+m+"</span>").appendTo($(".splitted-word:last"),n)}$('<span class="splitted-space">&nbsp;</span>').appendTo($(".splitted-word:last"),n)}}}setTimeout(function(){o()},1)}}}])}(),function(){"use strict";angular.module("app").directive("yearsFrom",[function(){return{restrict:"A",scope:{from:"=yearsFrom",to:"=yearsTo"},link:function(e,n,t){function o(){function t(){o.html(parseInt(i.from)),r.html(parseInt(i.to))}var o=n.find(".tunnel-year__from"),r=n.find(".tunnel-year__to"),a=Power3.easeOut,i={from:o.html(),to:r.html()};e.to?(n.removeClass("one-year"),TweenLite.to(i,2,{to:e.to,roundProps:"year",onUpdate:t,ease:a})):(n.addClass("one-year"),TweenLite.to(i,2,{to:e.from,roundProps:"year",onUpdate:t,ease:a})),TweenLite.to(i,2,{from:e.from,roundProps:"year",onUpdate:t,ease:a})}e.$watch("from",function(e,n){e&&o()})}}}])}(),function(){"use strict";angular.module("app").controller("TestCtrl",["$scope","$route","$routeParams","$ngSilentLocation","MotionService","$timeout",function(e,n,t,o,r,a){function i(){a(function(){c.update()})}function s(){i(),requestAnimationFrame(s)}var c=r;c.init(),s(),e.motion=c}])}(),function(){"use strict";angular.module("app").controller("YearsCtrl",["$scope","$route","$routeParams","$ngSilentLocation","SceneOptions","StepperService","AnalyserService","DatGui","$timeout",function(e,n,t,o,r,a,i,s,c){function l(){return o.silent(p.step.detailUrl),f.active=!0,!1}function u(){return o.silent(p.step.url),f.active=!1,!1}var d={objects:{},options:r,stepper:a},p=d.stepper;p.init(t.yearsKey).then(function(){e.scene=d,e.stepper=p,e.audio=i,-1!==n.current.$$route.originalPath.indexOf("/detail")&&c(function(){l()}),new s});var f={};e.detail=f,e.openDetail=l,e.closeDetail=u,e.$on("onStepChanged",function(){o.silent(p.step.url)})}])}(),function(){"use strict";var e=angular.module("app");e.service("AnalyserService",["$rootScope","$timeout","$q","$http","SceneOptions","StepperService",function(e,n,t,o,r,a){function i(){if(!H){var e=new C;e&&(b=e.createAnalyser(),H=e.createMediaElementSource(k),H.smoothingTimeConstant=.85,H.connect(b),H.connect(e.destination),b.fftSize=2*x.audio.bands,S.data=new Uint8Array(b.frequencyBinCount))}}function s(){n(function(){S.playing=!0})}function c(){n(function(){S.playing=!1})}function l(){n(function(){S.playing=!1})}function u(e){E!==e&&(E=e)&&(k.src=e,k.volume=x.audio.volume,d())}function d(){S.active&&E&&!m()&&k.play()}function p(){E&&m()&&k.pause()}function f(){return S.active&&m()}function m(){return!k.paused&&!k.ended}function g(){S.active=!S.active,S.active?d():p()}function v(){var e=T.getCurrentStep();u(e.audio?e.audio.url:null)}function h(){S.data&&b.getByteFrequencyData(S.data)}function w(){var e=t.defer();if(!x.device.ios||S.unlocked)e.resolve();else{var o=y();n(function(){!o||o.playbackState!==o.PLAYING_STATE&&o.playbackState!==o.FINISHED_STATE||(S.unlocked=!0,e.resolve())})}return console.log("AudioAnalyser.unlock"),e.promise}function y(){var e=null,n=new C;if(n){e=n.createBufferSource();var t=n.createBuffer(1,1,22050);e.buffer=t,e.connect(n.destination),e.noteOn&&e.noteOn(0),console.log("AudioAnalyser.doUnlock")}return e}var b,k,E,S=this,x=r,T=a,C=window.AudioContext||window.webkitAudioContext;k=new Audio,k.addEventListener("canplay",i),k.addEventListener("play",s),k.addEventListener("pause",c),k.addEventListener("ended",l);var H=null;S.unlocked=!1,window.addEventListener("touchstart",w,!1),e.$on("onStepChanged",function(e){v()}),e.$on("onOptionsChanged",function(e){k.volume=x.audio.volume}),this.active=!0,this.data=null,this.audio=k,this.update=h,this.play=d,this.pause=p,this.toggle=g,this.unlock=w,this.isPlaying=m,this.isActive=f}]),e.factory("AudioManager",[function(){function e(e){var n=this;n.ctx=e,n.buffers={},n.sounds={}}function n(){if(o)return o;var n=t();return n&&(o=new e(n)),o}function t(){if(r)return r;try{var e=window.AudioContext||window.webkitAudioContext;r=new e}catch(e){console.log("No Web Audio API support"),r=null}return r}e.prototype={add:function(e){var n=e.path,t=this,o=new XMLHttpRequest;o.responseType="arraybuffer",o.open("GET",n,!0),o.onload=function(){t.ctx.decodeAudioData(o.response,function(o){if(!o)return void console.log("AudioManager.decodeAudioData.error",n);console.log("AudioManager.decodeAudioData",n),t.buffers[n]=o,e.shouldPlay&&e.play()})},o.onerror=function(e){console.log("AudioManager.xhr.onerror",e)},o.send()},stop:function(e){var n=e.path,t=this;if(t.sounds.hasOwnProperty(n))for(var o in t.sounds[n])t.sounds[n].hasOwnProperty(o)&&t.sounds[n][o].noteOff(0)}};var o,r;return e.getInstance=n,e.getAudioContext=t,e}]),e.factory("AudioSound",["AudioManager","SceneOptions",function(e,n){function t(t,o){var r={volume:85,loop:!1};o&&angular.extend(r,o);var a=e.getInstance(),i=this;if(i.path=t,i.options=r,i.manager=a,i.setVolume(r.volume),a.add(i),i.options.analyser){var s=i.manager.ctx,c=s.createAnalyser();c.fftSize=2*n.audio.bands,i.data=new Uint8Array(c.frequencyBinCount),i.analyser=c}}return t.translateVolume=function(e,n){return n?100*e:e/100},t.prototype={play:function(){var e=this,n=e.path,t=e.manager,o=t.buffers[n];if(void 0!==o){var r=e.getSource(o);r.loop=e.options.loop,r.start?r.start(0):r.noteOn(0),t.sounds.hasOwnProperty(n)||(t.sounds[n]=[]),t.sounds[n].push(r),e.shouldPlay=!1}else e.shouldPlay=!0;console.log("AudioSound.play",n)},stop:function(){var e=this;e.manager.stop(e)},getVolume:function(){return t.translateVolume(this.volume,!0)},setVolume:function(e){this.volume=t.translateVolume(e)},getSource:function(e){var n=this,t=n.manager.ctx,o=t.createBufferSource(),r=t.createGain?t.createGain():t.createGainNode();return r.gain.value=n.volume,o.buffer=e,o.connect(r),n.analyser&&o.connect(n.analyser),r.connect(t.destination),o},update:function(){var e=this;e.analyser&&e.analyser.getByteFrequencyData(e.data)}},t}]),e.factory("AudioSound",["$q",function(e){function n(e,n){var t={volume:85,loop:!1};n&&angular.extend(t,n);var r=this;if(r.path=e,r.options=t,r.setVolume(t.volume),r.options.analyser){var a=o.createAnalyser();a.fftSize=512,r.data=new Uint8Array(a.frequencyBinCount),r.analyser=a}}var t=window.AudioContext||window.webkitAudioContext,o=new t,r={};return n.translateVolume=function(e,n){return n?100*e:e/100},n.load=function(n){var t=e.defer(),a=n.path,i=new XMLHttpRequest;return i.responseType="arraybuffer",i.open("GET",a,!0),i.onload=function(){o.decodeAudioData(i.response,function(e){if(!e)return console.log("AudioSound.load.decodeAudioData.error",a),void t.reject("AudioSound.load.decodeAudioData.error");console.log("AudioSound.decodeAudioData",a),r[a]=e,t.resolve(e)})},i.onerror=function(e){console.log("AudioManager.xhr.onerror",e),t.reject(e)},i.send(),t.promise},n.prototype={getBuffer:function(){var t=e.defer(),o=this.path,a=r[o];return a?t.resolve(a):n.load(this).then(function(e){t.resolve(e)},function(e){t.reject(e)}),t.promise},getSource:function(){var n=e.defer(),t=this.source;if(t)n.resolve(t);else{var r=this;this.getBuffer().then(function(e){var t=o.createBufferSource(),a=o.createGain?o.createGain():o.createGainNode();a.gain.value=r.volume,t.buffer=e,t.connect(a),r.analyser&&t.connect(r.analyser),a.connect(o.destination),n.resolve(t)},function(e){n.reject(e)})}return n.promise},play:function(){var e=this.options;this.getSource().then(function(n){n.loop=e.loop,n.start?n.start(0):n.noteOn(0)}),console.log("AudioSound.play")},stop:function(){this.getSource().then(function(e){e.stop?e.stop(0):e.noteOff(0)}),console.log("AudioSound.stop")},getVolume:function(){return n.translateVolume(this.volume,!0)},setVolume:function(e){this.volume=n.translateVolume(e)},update:function(){var e=this;e.analyser&&e.analyser.getByteFrequencyData(e.data)}},n}])}(),function(){"use strict";var e=angular.module("app");Date.now;e.service("MotionService",["$rootScope",function(e){function n(n,t,o){a.x=n,a.y=t,a.z=o,e.$broadcast("onDeviceMotion",a)}function t(){window.DeviceOrientationEvent&&window.addEventListener("deviceorientation",o,!0)}function o(e){var t=e.beta,o=e.gamma,r=0;t=Math.min(t,30)-10,o/=30,t/=30,r/=30,n(o,t,r)}function r(){t(),console.log("MotionService.init")}var a=this;a.x=0,a.y=0,a.z=0,a.init=r}])}(),function(){"use strict";angular.module("app").service("StepperService",["$rootScope","$timeout","$q","$http","$sce","SceneOptions",function(e,n,t,o,r,a){function i(e){var n=t.defer(),a=0;return E.length?(angular.forEach(E,function(n,t){n.years.key===e&&(a=t)}),x.pow=a/E.length,y.current=k=a,g(a),n.resolve(E)):o.get("json/rossini.js").then(function(t){var o=v();angular.forEach(o,function(n,t){n.years.key=String(t+1),n.url="/years/"+n.years.key,n.detailUrl=n.url+"/detail",n.years.key===e&&(a=t),n.titleTrusted=r.trustAsHtml(n.title),n.contrast=w(n.colors.background),n.circle.position=(new THREE.Vector3).copy(n.circle.position),E.push(n)}),x.pow=a/E.length,y.current=k=a,g(a),n.resolve(E)},function(e){n.reject(e)}),n.promise}function s(){for(;S.length;)S.pop().kill()}function c(e,n,t,o){s();var r=(new THREE.Color(n.colors.background),new THREE.Color(n.colors.lines)),a=new THREE.Color(n.colors.overLines);S.push(TweenLite.to(y.values,t,{pow:e,cameraHeight:n.camera.cameraHeight,targetHeight:n.camera.targetHeight,delay:0,ease:Power2.easeInOut,onComplete:function(){o&&o()}})),S.push(TweenLite.to(y.values.lines,t,{r:r.r,g:r.g,b:r.b,delay:0,ease:Power2.easeInOut})),S.push(TweenLite.to(y.values.overLines,t,{r:a.r,g:a.g,b:a.b,delay:0,ease:Power2.easeInOut}))}function l(e){var n=y.current,t=E[n];c(n/E.length,t,e,function(){s()})}function u(t){n(function(){var n=y.current||0;y.current=k=t;var o=E[t];y.step=o,b.colors.background=o.colors.background,b.colors.lines=o.colors.lines,b.colors.overLines=o.colors.overLines,b.camera.cameraHeight=o.camera.cameraHeight,b.camera.targetHeight=o.camera.targetHeight,b.circle.position.copy(o.circle.position),h(t),e.$broadcast("onStepChanged",{current:t,previous:n}),l(y.duration)})}function d(){return E[k]}function p(e){return E[e]}function f(){y.slicking||(k--,k=Math.max(0,k),g(k),e.$broadcast("onGoStep",k))}function m(){y.slicking||(k++,k=Math.min(E.length-1,k),g(k),e.$broadcast("onGoStep",k))}function g(t){u(t),e.$broadcast("onGoStep",t),n(function(){var e=$(".tunnel-nav__step.active");if(e.length){var n=e.position().top,t=e.width()+16;$(".tunnel-nav__follower").css({width:t+"px","-webkit-transform":"translateY("+n+"px)","-moz-transform":"translateY("+n+"px)","-ms-transform":"translateY("+n+"px)",transform:"translateY("+n+"px)"})}})}function v(){var e=["Il periodo francese:<br> la nascita della <em>Grand Opéra</em>","Il Barbiere di Siviglia<br> al teatro Argentina<br> di Roma","Il Silenzio"],n=["Il giovane Gioacchino","Il folgorante debutto","La frenesia della produzione","Sulle strade di Parigi"],t=["Il Barbiere di Siviglia","L'italiana in Algeri"],o=["audio/07-rossini-192.mp3","audio/08-rossini-192.mp3"],r=["img/tunnel-1.jpg","img/tunnel-2.jpg","img/tunnel-3.jpg"];return new Array(b.ribbon.steps).fill().map(function(i,s){var c={id:s+1,title:e[s%e.length],url:"view.html",chapter:"Passione, Genio e Silenzio",paragraph:n[Math.floor(s/3)%n.length],years:s%4==0?{from:1812+Math.round(50*Math.random())}:{from:1812+Math.round(50*Math.random()),to:1812+Math.round(50*Math.random())},background:r[s%r.length],colors:angular.copy(a.colors),camera:{cameraHeight:-10,targetHeight:30},circle:{position:new THREE.Vector3(0,0,0),texture:"img/rossini-01.png"},audio:s>0?{url:o[s%o.length],title:t[s%t.length],orchestra:"Academy of St Martin in the Fields Orchestra"}:null};return s>0&&s%3==0&&(c.colors.background=1118481),c})}function h(e){if(!b.useBackground){var n=y.getStepAtIndex(e),t=new THREE.Color(n.colors.background).getHexString();$(".tunnel-gradient").css("background-color","#"+t)}}function w(e){var n=new THREE.Color(e);return.299*parseInt(255*n.r)+.587*parseInt(255*n.g)+.114*parseInt(255*n.b)>186?"light-bg":"dark-bg"}var y=this,b=a,k=0,E=[],S=[],x={pow:0,background:new THREE.Color(b.colors.background),lines:new THREE.Color(b.colors.lines),overLines:new THREE.Color(b.colors.overLines),cameraHeight:b.camera.cameraHeight,targetHeight:b.camera.targetHeight};e.$on("onOptionsChanged",function(){var e=y.current,n=E[e];y.values.cameraHeight=n.camera.cameraHeight,y.values.targetHeight=n.camera.targetHeight,y.values.background.copy(new THREE.Color(n.colors.background)),y.values.lines.copy(new THREE.Color(n.colors.lines)),y.values.overLines.copy(new THREE.Color(n.colors.overLines)),h(e)}),e.$on("onSlickBeforeChange",function(e,n){g(n.current)}),this.init=i,this.values=x,this.duration=2.5,this.steps=E,this.navStep=g,this.getCurrentStep=d,this.getStepAtIndex=p,this.current=k,this.previous=f,this.next=m}])}(),function(){"use strict";function e(e,t){for(var o=e*t,r=new Uint8Array(o),a=new n,i=1,s=100*Math.random(),c=0;c<4;c++){for(var l=0;l<o;l++){var u=l%e,d=~~(l/e);r[l]+=Math.abs(a.noise(u/i,d/i,s)*i*1.75)}i*=5}return r}function n(){function e(e){return e*e*e*(e*(6*e-15)+10)}function n(e,n,t){return n+e*(t-n)}function t(e,n,t,o){var r=15&e,a=r<8?n:t,i=r<4?t:12==r||14==r?n:o;return(0==(1&r)?a:-a)+(0==(2&r)?i:-i)}for(var o=[151,160,137,91,90,15,131,13,201,95,96,53,194,233,7,225,140,36,103,30,69,142,8,99,37,240,21,10,23,190,6,148,247,120,234,75,0,26,197,62,94,252,219,203,117,35,11,32,57,177,33,88,237,149,56,87,174,20,125,136,171,168,68,175,74,165,71,134,139,48,27,166,77,146,158,231,83,111,229,122,60,211,133,230,220,105,92,41,55,46,245,40,244,102,143,54,65,25,63,161,1,216,80,73,209,76,132,187,208,89,18,169,200,196,135,130,116,188,159,86,164,100,109,198,173,186,3,64,52,217,226,250,124,123,5,202,38,147,118,126,255,82,85,212,207,206,59,227,47,16,58,17,182,189,28,42,223,183,170,213,119,248,152,2,44,154,163,70,221,153,101,155,167,43,172,9,129,22,39,253,19,98,108,110,79,113,224,232,178,185,112,104,218,246,97,228,251,34,242,193,238,210,144,12,191,179,162,241,81,51,145,235,249,14,239,107,49,192,214,31,181,199,106,157,184,84,204,176,115,121,50,45,127,4,150,254,138,236,205,93,222,114,67,29,24,72,243,141,128,195,78,66,215,61,156,180],r=0;r<256;r++)o[256+r]=o[r];return{noise:function(r,a,i){var s=Math.floor(r),c=Math.floor(a),l=Math.floor(i),u=255&s,d=255&c,p=255&l;r-=s,a-=c,i-=l;var f=r-1,m=a-1,g=i-1,v=e(r),h=e(a),w=e(i),y=o[u]+d,b=o[y]+p,k=o[y+1]+p,E=o[u+1]+d,S=o[E]+p,x=o[E+1]+p;return n(w,n(h,n(v,t(o[b],r,a,i),t(o[S],f,a,i)),n(v,t(o[k],r,m,i),t(o[x],f,m,i))),n(h,n(v,t(o[b+1],r,a,g),t(o[S+1],f,a,i-1)),n(v,t(o[k+1],r,m,g),t(o[x+1],f,m,g))))}}}function t(e,n,t){var o=2*Math.random()-1,r=Math.abs(o);return(t?Math.floor(o/r):1)*(e+(n-e)*r)}angular.module("app").directive("scene",["SceneOptions","StepperService","AudioSound","AnalyserService","MotionService",function(n,o,r,a,i){return{restrict:"A",scope:{data:"=scene"},link:function(s,c,l){function u(){h.device.mobile?(L.x=20*O.x,L.y=20*O.y):(L.x=20*M.x,L.y=20*M.y);var e=L.x/4,n=L.y/4;if(R.x+=(e-R.x)*z,R.y+=(n-R.y)*z,0==$(".detail-active").length){var t="translate("+-4*R.x+"px, "+-2*R.y+"px)";$(".tunnel-year__wrap").css({"-webit-transform":t,"-moz-transform":t,transform:t})}var o="translate("+R.x+"px, "+R.y+"px)";$(".tunnel-slick .slick-active .tunnel-slick__item").css({"-webit-transform":o,"-moz-transform":o,transform:o}),L.x+=10*Math.cos(L.i/100),L.y+=10*Math.sin(L.i/100),L.i++}function d(){function e(){E.add(p)}function n(){E.remove(p)}function o(){var e=1/w.steps.length,n=.1*e,t=w.values.pow,o=(t+n).mod(1),r=(w.getCurrentStep(),l.getPointAt(t));r.y+=w.values.cameraHeight;var a=l.getPointAt(o);a.y+=w.values.targetHeight,S.position.copy(r),S.target.copy(a),S.position.x+=(r.x+L.x-S.position.x)*z,S.position.y+=(r.y+L.y-S.position.y)*z,S.lookAt(S.target)}var r=new THREE.Vector2(window.innerWidth,window.innerHeight),a=new MeshLineMaterial({color:w.values.lines,lineWidth:5,opacity:.8,transparent:!0,depthTest:!1,sizeAttenuation:!0,resolution:r,near:S.near,far:S.far}),i=new THREE.Vector3,s=new Array(h.ribbon.points).fill(null).map(function(){var e=(new THREE.Vector3).copy(i);return i.x+=t(500,1e3,!0),i.y+=t(10,40,!0),i.z+=t(1e3,2e3,!1),e}),c=new THREE.CatmullRomCurve3(s);c.type="catmullrom",c.closed=!1;var l=new THREE.CatmullRomCurve3(c.points.map(function(e){return new THREE.Vector3(e.x,e.y+20,e.z)}));l.type="catmullrom",l.closed=!1;var u=new THREE.Geometry;u.vertices=c.getPoints(h.ribbon.vertices);var d=new MeshLine;d.setGeometry(u);var p=new THREE.Mesh(d.geometry,a);return e(),S.target=S.target||new THREE.Vector3(0,0,0),{object:p,spline:c,cameraSpline:l,geometry:u,material:a,add:e,remove:n,update:o}}function p(n){function t(){E.add(u),N.adding=Date.now(),N.removing=!1,N.enabled=!0,N.tween&&N.tween.kill(),N.tween=TweenLite.to(N,2,{pow:1,delay:0,ease:Elastic.easeOut.config(1,.3),onComplete:function(){N.adding=!1}})}function o(){N.adding=!1,N.removing=Date.now(),N.tween&&N.tween.kill(),N.tween=TweenLite.to(N,.35,{pow:0,delay:0,ease:Power2.easeOut,onComplete:function(){N.removing=!1,N.enabled=!1,E.remove(u)}})}function r(e,n){var t=new THREE.Geometry,o=i(t,n,1);M.push(o);var r=null;if(G){var a=new MeshLine;a.setGeometry(t),P.push(t),O.push(a),r=new THREE.Mesh(a.geometry,A)}else r=new THREE.LineLoop(t,C.clone());return B.add(r),r}function a(e,n){var t=new THREE.Geometry,o=i(t,n,2);R.push(o);var r=null;if(G){var a=new MeshLine;a.setGeometry(t),j.push(t),_.push(a),r=new THREE.Mesh(a.geometry,$)}else r=new THREE.LineLoop(t,H.clone());return V.add(r),r}function i(e,t,o){var r=new Array(m).fill(null).map(function(r,a){var i=a/m,s=360*i;s+=60*n,s+=30*o,s+=360/m*.1*t;var c=s*Math.PI/180,l=h.circle.radius,u=0;return u+=t*t*t*.005,r=new THREE.Vector3,r.sincos={base:l,increment:u,radius:l,x:Math.cos(c),y:Math.sin(c)},e.vertices.push(r),r});return e.vertices.push(r[0]),r}function s(e,n,t,o){var r=h.audioStrength,a=h.noiseStrength,i=h.circularStrength,s=1===o?d:p,c=y.data;angular.forEach(n,function(e,n){var l=h.audio.bands,u=n%l,d=(m-1-n)%l,p=c?(c[u]+c[d])/2/l:0,g=1===o?0:64,v=t*m+(n+g+0)%m,w=t*m+(m-1-n-g+0)%m,y=(s[v]+s[w])/2/64,b=1-(f-t)/f*i,k=e.sincos.base+e.sincos.increment*y+e.sincos.increment*p+a*y*b+r*p*b+0;e.sincos.radius=k,e.x=e.sincos.x*e.sincos.radius,e.y=e.sincos.y*e.sincos.radius,e.z=10*o+.01*t}),e.verticesNeedUpdate=!0}function c(){x.opacity=N.pow,angular.forEach(q,function(e,n){s(e.geometry,M[n],n,1),e.material.opacity=(0+1*n/f)*N.pow,e.material.color=w.values.lines,G&&O[n].setGeometry(P[n])}),angular.forEach(U,function(e,n){s(e.geometry,R[n],n,2),e.material.opacity=(0+1*n/f)*N.pow,e.material.color=w.values.overLines,G&&_[n].setGeometry(j[n])}),B.rotation.z+=.001,V.rotation.z-=.001,T>1023?D.position.copy(g.circle.position):D.position.copy(F),D.rotation.x+=(.00625*L.y-D.rotation.x)*z,D.rotation.y+=(.0125*L.x-D.rotation.y)*z;var e=v.ribbon.cameraSpline.getPointAt((n+.1)/w.steps.length);e.y+=w.values.targetHeight,u.position.copy(e),u.scale.x=u.scale.y=u.scale.z=.001+.14*N.pow,u.lookAt(S.position)}var l,u,d=e(h.circle.points,h.circle.lines),p=e(h.circle.points,h.circle.lines),f=h.circle.lines,m=h.circle.points,g=w.getStepAtIndex(n),b=(new THREE.TextureLoader).load(g.circle.texture);b.wrapS=THREE.RepeatWrapping,b.wrapT=THREE.RepeatWrapping,b.repeat.set(1,1);var k=new THREE.Vector2(window.innerWidth,window.innerHeight),x=new THREE.MeshBasicMaterial({color:16777215,map:b,transparent:!0}),C=new THREE.LineBasicMaterial({color:w.values.lines,transparent:!0}),H=new THREE.LineBasicMaterial({color:w.values.overLines,transparent:!0}),A=new MeshLineMaterial({color:w.values.lines,lineWidth:1,depthTest:!1,opacity:1,transparent:!0,resolution:k,near:S.near,far:S.far}),$=new MeshLineMaterial({color:w.values.overLines,lineWidth:1,depthTest:!1,opacity:1,transparent:!0,resolution:k,near:S.near,far:S.far});u=new THREE.Object3D;var M=[],R=[],O=[],_=[],P=[],j=[],G=!1,D=new THREE.Object3D;u.add(D),l=new THREE.PlaneGeometry(2*h.circle.radius-20,2*h.circle.radius-20,8,8);var I=new THREE.Mesh(l,x);I.position.z=-30,D.add(I);var B=new THREE.Object3D;D.add(B);var V=new THREE.Object3D;D.add(V);var q=new Array(f).fill(null).map(r),U=new Array(f).fill(null).map(a),N={pow:0,enabled:!1,adding:!1,removing:!1},F=new THREE.Vector3(0,100,0);return{add:t,remove:o,object:u,state:N,update:c}}function f(){u(),y.update(),b.update(),v.ribbon&&v.ribbon.update(),angular.forEach(v.circles,function(e){e&&e.state.enabled&&e.update()}),x.render(E,S)}function m(){k.begin(),f(),k.end(),requestAnimationFrame(m)}var g=s.data;if(g){var v=g.objects,h=n,w=o,y=a,b=new r("audio/07-rossini-192-short.mp3",{loop:!1,analyze:!0});b.play();var k,E,S,x,T,C,H,A;s.$on("onStepChanged",function(e,n){var t=null,o=n.current,r=n.previous;o>0&&(t=v.circles[o]||p(o),t.add()),v.circles[o]=t,setTimeout(function(){if(w.current!==r&&r>0){var e=v.circles[r];e&&e.remove()}},1e3*w.duration)}),s.$on("onOptionsChanged",function(e){});var M={x:0,y:0},L={x:0,y:0,i:0},R={x:0,y:0},z=1/12,O=i;h.device.mobile&&O.init(),function(){T=window.innerWidth,C=window.innerHeight,H=T/2,A=C/2;var e=T/C;E=new THREE.Scene,S=new THREE.PerspectiveCamera(30,e,1,2e4),x=new THREE.WebGLRenderer({alpha:!0,antialias:!0,logarithmicDepthBuffer:!0}),x.setClearColor(0,0),x.setSize(T,C),x.sortObjects=!1,k=new Stats,c[0].appendChild(x.domElement),c[0].appendChild(k.dom)}(),function(){v.ribbon=d(),v.circles=new Array(w.steps).fill(null)}(),function(){function e(){T=window.innerWidth,C=window.innerHeight,H=T/2,A=C/2,x.setSize(T,C),S.aspect=T/C,S.updateProjectionMatrix()}function n(e){var n=window.innerWidth/2,t=window.innerHeight/2;M.x=(e.clientX-n)/n,M.y=(e.clientY-t)/t}window.addEventListener("resize",e,!1),document.addEventListener("mousemove",n,!1)}(),m()}}}}]),Number.prototype.mod=function(e){return(this%e+e)%e}}(),function(){"use strict";var e=angular.module("app"),n=/iPad|iPhone|iPod/.test(navigator.userAgent)&&!window.MSStream,t=(function(){var e=!1;(function(n){(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(n)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(n.substr(0,4)))&&(e=!0)})(navigator.userAgent||navigator.vendor||window.opera)}(),function(){var e=!1;return function(n){
(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino|android|ipad|playbook|silk/i.test(n)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(n.substr(0,4)))&&(e=!0)}(navigator.userAgent||navigator.vendor||window.opera),e}());e.constant("SceneOptions",{colors:{background:15395048,lines:11845597,overLines:3363748},camera:{cameraHeight:-10,targetHeight:30},ribbon:{steps:12,points:24,vertices:t?1200:2400},circle:{position:new THREE.Vector3,radius:200,lines:24,points:t?64:128},audio:{volume:.9,bands:t?64:128},audioStrength:100,noiseStrength:25,circularStrength:.9,useBackground:!1,device:{mobile:t,ios:n}})}();
//# sourceMappingURL=app.min.js.map
