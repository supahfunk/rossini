(function(){"use strict";var n=angular.module("app",["ngRoute","jsonFormatter"])})(),function(){"use strict";var n=angular.module("app");n.config(["$httpProvider",function(){}])}(),function(){"use strict";var n=angular.module("app");n.config(["$locationProvider",function(n){n.html5Mode(!0);n.hashPrefix("")}])}(),function(){"use strict";var n=angular.module("app");n.run(["$rootScope",function(){}])}(),function(){"use strict";function i(n,t){for(var i,s,h,f=n*t,e=new Uint8Array(f),c=new r,u=1,l=Math.random()*100,o=0;o<4;o++){for(i=0;i<f;i++)s=i%n,h=~~(i/n),e[i]+=Math.abs(c.noise(s/u,h/u,l)*u*1.75);u*=5}return e}function r(){function u(n){return n*n*n*(n*(n*6-15)+10)}function i(n,t,i){return t+n*(i-t)}function t(n,t,i,r){var u=n&15,f=u<8?t:i,e=u<4?i:u==12||u==14?t:r;return((u&1)==0?f:-f)+((u&2)==0?e:-e)}for(var n=[151,160,137,91,90,15,131,13,201,95,96,53,194,233,7,225,140,36,103,30,69,142,8,99,37,240,21,10,23,190,6,148,247,120,234,75,0,26,197,62,94,252,219,203,117,35,11,32,57,177,33,88,237,149,56,87,174,20,125,136,171,168,68,175,74,165,71,134,139,48,27,166,77,146,158,231,83,111,229,122,60,211,133,230,220,105,92,41,55,46,245,40,244,102,143,54,65,25,63,161,1,216,80,73,209,76,132,187,208,89,18,169,200,196,135,130,116,188,159,86,164,100,109,198,173,186,3,64,52,217,226,250,124,123,5,202,38,147,118,126,255,82,85,212,207,206,59,227,47,16,58,17,182,189,28,42,223,183,170,213,119,248,152,2,44,154,163,70,221,153,101,155,167,43,172,9,129,22,39,253,19,98,108,110,79,113,224,232,178,185,112,104,218,246,97,228,251,34,242,193,238,210,144,12,191,179,162,241,81,51,145,235,249,14,239,107,49,192,214,31,181,199,106,157,184,84,204,176,115,121,50,45,127,4,150,254,138,236,205,93,222,114,67,29,24,72,243,141,128,195,78,66,215,61,156,180],r=0;r<256;r++)n[256+r]=n[r];return{noise:function(r,f,e){var a=Math.floor(r),v=Math.floor(f),y=Math.floor(e),p=a&255,w=v&255,o=y&255;r-=a;f-=v;e-=y;var s=r-1,h=f-1,l=e-1,c=u(r),b=u(f),rt=u(e),k=n[p]+w,d=n[k]+o,g=n[k+1]+o,nt=n[p+1]+w,tt=n[nt]+o,it=n[nt+1]+o;return i(rt,i(b,i(c,t(n[d],r,f,e),t(n[tt],s,f,e)),i(c,t(n[g],r,h,e),t(n[it],s,h,e))),i(b,i(c,t(n[d+1],r,f,l),t(n[tt+1],s,f,e-1)),i(c,t(n[g+1],r,h,l),t(n[it+1],s,h,l))))}}}function n(n,t,i){var r=-1+Math.random()*2,u=Math.abs(r),f=i?Math.floor(r/u):1;return f*(n+(t-n)*u)}var t=angular.module("app");Number.prototype.mod=function(n){return(this%n+n)%n};t.service("AnalyserService",["$rootScope","$q","$http","SceneOptions","StepperService",function(n,t,i,r,u){function a(){var n,t,i=window.AudioContext||window.webkitAudioContext;n=null;t=new i;e=t.createAnalyser();f=new Audio;f.addEventListener("canplay",function(){var i;return console.log("audio canplay"),n=t.createMediaElementSource(f),n.connect(e),n.connect(t.destination),e.fftSize=s.bands*2,i=e.frequencyBinCount,o.data=new Uint8Array(i),o.data});c()}function v(n){h!==n&&(h=n,f.src=n,f.volume=s.audioVolume,f.play())}function c(){var n=l.getCurrentStep();v(n.audio.url)}function y(){o.data&&e.getByteFrequencyData(o.data)}var o=this,s=r,l=u,e,f,h;n.$on("onStepChanged",function(){c()});n.$on("onOptionsChanged",function(){f&&(f.volume=s.audioVolume)});this.audio=f;this.data=null;this.init=a;this.update=y}]);t.directive("scene",["SceneOptions","StepperService","AnalyserService",function(t,r,u){return{restrict:"A",scope:{data:"=scene"},link:function(f,e){function ut(){a=window.innerWidth;v=window.innerHeight;tt=a/2;it=v/2;var n=a/v;l=new THREE.Scene;c=new THREE.PerspectiveCamera(30,n,.001,2e4);y=new THREE.WebGLRenderer({alpha:!0,antialias:!0,logarithmicDepthBuffer:!0});y.setClearColor(0,0);y.setSize(a,v);p=new Stats;e[0].appendChild(y.domElement);e[0].appendChild(p.dom)}function ft(){h.ribbon=et();h.circles=new Array(s.steps).fill(null)}function et(){function v(){console.log("objects.ribbon.add");l.add(f)}function w(){console.log("objects.ribbon.remove");l.remove(f)}function b(){var u=1/s.steps.length*.1,i=s.values.pow,f=(i+u).mod(1),e=s.getCurrentStep(),r=t.getPointAt(i),n;r.y+=s.values.cameraHeight;n=t.getPointAt(f);n.y+=s.values.targetHeight;c.position.copy(r);c.target.copy(n);c.lookAt(c.target)}function y(){var n=new THREE.Vector2(window.innerWidth,window.innerHeight);return new MeshLineMaterial({color:s.values.lines,lineWidth:5,depthTest:!0})}function k(){h.ribbon.material=y();h.ribbon.object.material=h.ribbon.material}var a=y(),r=new THREE.Vector3,p=new Array(o.ribbon.points).fill(null).map(function(){var t=(new THREE.Vector3).copy(r);return r.x+=n(500,1e3,!0),r.y+=n(5,20,!0),r.z+=n(1e3,2e3,!1),t}),i=new THREE.CatmullRomCurve3(p),t,u,e,f;return i.type="catmullrom",i.closed=!1,t=new THREE.CatmullRomCurve3(i.points.map(function(n){return new THREE.Vector3(n.x,n.y+20,n.z)})),t.type="catmullrom",t.closed=!1,u=new THREE.Geometry,u.vertices=i.getPoints(o.ribbon.vertices),e=new MeshLine,e.setGeometry(u),f=new THREE.Mesh(e.geometry,a),v(),c.target=c.target||new THREE.Vector3(0,0,0),{object:f,spline:i,cameraSpline:t,geometry:u,material:a,add:v,remove:w,update:b,updateMaterial:k}}function ot(n){function st(){console.log("objects.circles.add");l.add(i);t.adding=Date.now();t.removing=!1;t.enabled=!0;t.tween&&t.tween.kill();t.tween=TweenLite.to(t,t.duration,{pow:1,delay:0,ease:Power2.easeInOut,onComplete:function(){t.adding=!1}})}function ht(){console.log("objects.circles.remove");t.adding=!1;t.removing=Date.now();t.tween&&t.tween.kill();t.tween=TweenLite.to(t,t.duration,{pow:0,delay:0,ease:Power2.easeInOut,onComplete:function(){t.removing=!1;t.enabled=!1;l.remove(i)}})}function ct(n,t){var r=new THREE.Geometry,u=rt(r,t,1),i=null;return i=new THREE.LineLoop(r,w),d.push(u),a.add(i),i}function lt(n,t){var r=new THREE.Geometry,u=rt(r,t,2),i=null;return i=new THREE.LineLoop(r,b),g.push(u),v.add(i),i}function rt(t,i,u){return new Array(r).fill(null).map(function(f,e){var a=e/r,s=360*a;s+=60*n;s+=30*u;s+=360/r*.1*i;var h=s*Math.PI/180,c=o.radius,l=0;return l+=u===1?i*i*i*.005:i*i*i*.005,f=new THREE.Vector3,f.sincos={base:c,increment:l,radius:c,x:Math.cos(h),y:Math.sin(h)},t.vertices.push(f),f})}function ut(n,t,i,u){var s=o.audioStrength,h=o.noiseStrength,c=o.circularStrength,f=k.data;angular.forEach(t,function(n,t){var w=t%o.bands,b=(r-1-t)%o.bands,l=f?(f[w]+f[b])/2/o.bands:0,a=u===1?0:64,k=i*r+(t+a+y)%r,d=i*r+(r-1-t-a+y)%r,v=(o.noiseMap[k]+o.noiseMap[d])/128,p=1-(e-i)/e*c,g=n.sincos.base+n.sincos.increment*v+n.sincos.increment*l+h*v*p+s*l*p+0;n.sincos.radius=g;n.x=n.sincos.x*n.sincos.radius;n.y=n.sincos.y*n.sincos.radius;n.z=0});n.verticesNeedUpdate=!0}function at(){var f,r;angular.forEach(et,function(n,t){ut(n.geometry,d[t],t,1)});angular.forEach(ot,function(n,t){ut(n.geometry,g[t],t,2)});a.rotation.z+=.001;v.rotation.z-=.001;f=s.getStepAtIndex(n);u.position.copy(f.circle.position);r=h.ribbon.cameraSpline.getPointAt((n+.1)/s.steps.length);r.y+=s.values.targetHeight;i.position.copy(r);i.scale.x=i.scale.y=i.scale.z=.001+.1*t.pow;i.lookAt(c.position);ft()}function ft(){w.color=s.values.lines;b.color=s.values.overLines}var p,i,w=new THREE.LineBasicMaterial({color:s.values.lines}),b=new THREE.LineBasicMaterial({color:s.values.overLines}),vt=new THREE.Vector2(window.innerWidth,window.innerHeight),nt,f,tt,it,a,v,y;i=new THREE.Object3D;var d=[],g=[],r=o.points,e=o.lines,u=new THREE.Object3D;i.add(u);nt=s.steps[n];f=(new THREE.TextureLoader).load(nt.circle.texture);f.wrapS=THREE.RepeatWrapping;f.wrapT=THREE.RepeatWrapping;f.repeat.set(1,1);tt=new THREE.MeshBasicMaterial({color:16777215,map:f,transparent:!0});p=new THREE.PlaneGeometry(o.radius*2-20,o.radius*2-20,8,8);it=new THREE.Mesh(p,tt);u.add(it);a=new THREE.Object3D;u.add(a);v=new THREE.Object3D;u.add(v);var et=new Array(e).fill(null).map(ct),ot=new Array(e).fill(null).map(lt),t={pow:0,duration:.35,enabled:!1,adding:!1,removing:!1};return y=0,{add:st,remove:ht,object:i,state:t,update:at,updateMaterial:ft}}function st(){k.update();d&&d.update();h.ribbon&&h.ribbon.update();angular.forEach(h.circles,function(n){n&&n.state.enabled&&n.update()});y.render(l,c)}function rt(){p.begin();st();p.end();requestAnimationFrame(rt)}function ht(){function n(){a=window.innerWidth;v=window.innerHeight;tt=a/2;it=v/2;y.setSize(a,v);c.aspect=a/v;c.updateProjectionMatrix()}window.addEventListener("resize",n,!1)}var g=f.data,p,l,c,w,b,nt,y,a,v,tt,it,d;if(g){var h=g.objects,o=t,s=r,k=u;o.noiseMap=i(o.points,o.lines);d=null;f.$on("onStepChanged",function(n,t){console.log("onStepChanged",t.current);var r=null,i=t.current,u=t.previous;i>0&&(r=h.circles[i]||ot(i),r.add());h.circles[i]=r;setTimeout(function(){if(s.current!==u&&u>0){var n=h.circles[u];n&&n.remove()}},s.duration*1e3);console.log("objects",h)});f.$on("onOptionsChanged",function(){h.ribbon&&h.ribbon.updateMaterial();angular.forEach(h.circles,function(n){n&&n.updateMaterial()})});ut();ft();ht();rt();k.init()}}}}])}(),function(){"use strict";var n=angular.module("app");n.constant("SceneOptions",{colors:{background:15395048,lines:3363748,overLines:11845597},camera:{cameraHeight:0,targetHeight:5},circle:{position:new THREE.Vector3},ribbon:{points:40,vertices:3600},audioVolume:.9,bands:128,points:128,lines:32,radius:200,audioStrength:100,noiseStrength:25,circularStrength:.9});n.controller("RootCtrl",["$scope","SceneOptions","StepperService","DatGui",function(n,t,i,r){var u={objects:{},options:t,stepper:i},e=u.objects,o=u.options,f=u.stepper;f.init().then(function(){n.scene=u;n.stepper=f;var t=new r})}]);n.service("StepperService",["$rootScope","$q","$http","SceneOptions",function(n,t,i,r){function a(){var n=t.defer();return i.get("json/rossini.js").then(function(t){var i=t.data;angular.forEach(i,function(n){n.circle.position=(new THREE.Vector3).copy(n.circle.position);e.push(n)});console.log("StepperService.load",e);n.resolve(e)},function(t){n.reject(t)}),n.promise}function h(){while(s.length){var n=s.pop();n.kill()}}function v(n,t,i,r){h();var f=new THREE.Color(t.colors.background),e=new THREE.Color(t.colors.lines),o=new THREE.Color(t.colors.overLines);s.push(TweenLite.to(u.values,i,{pow:n,cameraHeight:t.camera.cameraHeight,targetHeight:t.camera.targetHeight,delay:0,ease:Power2.easeInOut,onComplete:function(){r&&r()}}));s.push(TweenLite.to(u.values.background,i,{r:f.r,g:f.g,b:f.b,delay:0,ease:Power2.easeInOut,onUpdate:function(){var n=u.values.background.getHexString();document.body.style.backgroundColor="#"+n}}));s.push(TweenLite.to(u.values.lines,i,{r:e.r,g:e.g,b:e.b,delay:0,ease:Power2.easeInOut}));s.push(TweenLite.to(u.values.overLines,i,{r:o.r,g:o.g,b:o.b,delay:0,ease:Power2.easeInOut}))}function y(n){var t=u.current,i=e[t];v(t/e.length,i,n,function(){h();console.log(i,u.values)})}function c(t){var r=u.current||0,i;u.current=t;i=e[t];f.colors.background=i.colors.background;f.colors.lines=i.colors.lines;f.colors.overLines=i.colors.overLines;f.camera.cameraHeight=i.camera.cameraHeight;f.camera.targetHeight=i.camera.targetHeight;f.circle.position.copy(i.circle.position);n.$broadcast("onStepChanged",{current:t,previous:r});y(u.duration)}function p(){o++;o=Math.min(e.length-1,o);c(o)}function w(){o--;o=Math.max(0,o);c(o)}function b(){return e[o]}function k(n){return e[n]}var u=this,f=r,o=0,e=[],s=[],l={pow:0,background:new THREE.Color(f.colors.background),lines:new THREE.Color(f.colors.lines),overLines:new THREE.Color(f.colors.overLines),cameraHeight:f.camera.cameraHeight,targetHeight:f.camera.targetHeight};n.$on("onOptionsChanged",function(){var t=u.current,n=e[t];u.values.cameraHeight=n.camera.cameraHeight;u.values.targetHeight=n.camera.targetHeight;u.values.background.copy(new THREE.Color(n.colors.background));u.values.lines.copy(new THREE.Color(n.colors.lines));u.values.overLines.copy(new THREE.Color(n.colors.overLines))});this.init=a;this.values=l;this.duration=2.5;this.steps=e;this.current=o;this.next=p;this.previous=w;this.getCurrentStep=b;this.getStepAtIndex=k}]);n.factory("DatGui",["$rootScope","SceneOptions","StepperService",function(n,t,i){function u(){function e(){var t=h.getCurrentStep();t.colors.background=u.colors.background;t.colors.lines=u.colors.lines;t.colors.overLines=u.colors.overLines;t.camera.cameraHeight=u.camera.cameraHeight;t.camera.targetHeight=u.camera.targetHeight;t.circle.position.copy(u.circle.position);n.$broadcast("onOptionsChanged")}var u=t,h=i,f=new dat.GUI,o,s;u.randomize=function(){for(var n,i,t=0;t<f.__controllers.length;t++)n=f.__controllers[t],n.__min&&(i=n.__min+(n.__max-n.__min)*Math.random(),this[n.property]=i,n.updateDisplay()),n.__color&&(n.__color.r=Math.floor(Math.random()*255),n.__color.g=Math.floor(Math.random()*255),n.__color.b=Math.floor(Math.random()*255),n.updateDisplay(),n.setValue(n.__color.hex))};u.saveJson=function(){console.log("saveJson");r(h.steps,"rossini.js",!0,!0)};f.closed=!0;f.add(u.camera,"cameraHeight",-20,20).listen().onChange(e);f.add(u.camera,"targetHeight",-20,20).listen().onChange(e);o=f.addFolder("circlePosition");o.add(u.circle.position,"x",-300,300).listen().onChange(e);o.add(u.circle.position,"y",-300,300).listen().onChange(e);o.add(u.circle.position,"z",-300,300).listen().onChange(e);s=f.addFolder("colors");s.addColor(u.colors,"background").listen().onChange(e);s.addColor(u.colors,"lines").listen().onChange(e);s.addColor(u.colors,"overLines").listen().onChange(e);f.add(u,"audioVolume",.01,1).onChange(e);f.add(u,"audioStrength",10,100).onChange(e);f.add(u,"noiseStrength",10,100).onChange(e);f.add(u,"circularStrength",.01,.9).onChange(e);return f.add(u,"randomize"),f.add(u,"saveJson"),e(),f}var r=function(){var n=document.createElement("a");return document.body.appendChild(n),n.style="display: none",function(t,i,r,u){r&&(t=u?JSON.stringify(t,null,2):JSON.stringify(t));var e=new Blob([t],{type:"octet/stream"}),f=window.URL.createObjectURL(e);n.href=f;n.download=i;n.click();window.URL.revokeObjectURL(f)}}();return u}]);n.directive("scrollbar",[function(){return{restrict:"A",link:function(n,t){function f(){i=Scrollbar.init(r,u);n.$watch(i.targets.content.offsetHeight,function(){i.update()})}var r=t[0],u={speed:1,damping:.1,overscrollDamping:1,thumbMinSize:20,continuousScrolling:!0,alwaysShowTracks:!1},i;setTimeout(f,100)}}}])}();