"use strict";(function(){var n=angular.module("app");n.constant("SceneOptions",{colors:{background:15395048,lines:3363748,overLines:11845597},camera:{cameraHeight:0,targetHeight:5},circle:{position:new THREE.Vector3},ribbon:{points:40,vertices:3600},audioVolume:.9,bands:128,points:128,lines:32,radius:200,audioStrength:100,noiseStrength:25,circularStrength:.9});n.controller("RootCtrl",["$scope","SceneOptions","StepperService","DatGui",function(n,t,i,r){var u={objects:{},options:t,stepper:i},e=u.objects,o=u.options,f=u.stepper;f.init().then(function(){n.scene=u;n.stepper=f;var t=new r})}]);n.service("StepperService",["$rootScope","$q","$http","SceneOptions",function(n,t,i,r){function v(){var n=t.defer();return i.get("json/rossini.js").then(function(t){var i=t.data;angular.forEach(i,function(n){n.circle.position=(new THREE.Vector3).copy(n.circle.position);e.push(n)});console.log("StepperService.load",e);n.resolve(e)},function(t){n.reject(t)}),n.promise}function h(){while(s.length){var n=s.pop();n.kill()}}function y(n,t,i,r){h();var f=new THREE.Color(t.background),e=new THREE.Color(t.lines),o=new THREE.Color(t.overLines);s.push(TweenLite.to(u.values,i,{pow:n,delay:0,ease:Power2.easeInOut,onComplete:function(){r&&r()}}));s.push(TweenLite.to(u.values.background,i,{r:f.r,g:f.g,b:f.b,delay:0,ease:Power2.easeInOut,onUpdate:function(){var n=u.values.background.getHexString();document.body.style.backgroundColor="#"+n}}));s.push(TweenLite.to(u.values.lines,i,{r:e.r,g:e.g,b:e.b,delay:0,ease:Power2.easeInOut}));s.push(TweenLite.to(u.values.overLines,i,{r:o.r,g:o.g,b:o.b,delay:0,ease:Power2.easeInOut}))}function c(n){var t=u.current,i=e[t];y(t/e.length,i.colors,n,function(){h();console.log(i,u.values)})}function l(t){var r=u.current||0,i;u.current=t;i=e[t];o.colors.background=i.colors.background;o.colors.lines=i.colors.lines;o.colors.overLines=i.colors.overLines;o.camera.cameraHeight=i.camera.cameraHeight;o.camera.targetHeight=i.camera.targetHeight;o.circle.position.copy(i.circle.position);n.$broadcast("onStepChanged",{current:t,previous:r});c(u.duration)}function p(){f++;f=Math.min(e.length-1,f);l(f)}function w(){f--;f=Math.max(0,f);l(f)}function b(){return e[f]}function k(n){return e[n]}var u=this,o=r,f=0,e=[],s=[],a={pow:0,background:new THREE.Color(o.colors.background),lines:new THREE.Color(o.colors.lines),overLines:new THREE.Color(o.colors.overLines)};n.$on("onOptionsChanged",function(){c(.25)});this.init=v;this.values=a;this.duration=2.5;this.steps=e;this.current=f;this.next=p;this.previous=w;this.getCurrentStep=b;this.getStepAtIndex=k}]);n.factory("DatGui",["$rootScope","SceneOptions","StepperService",function(n,t,i){function u(){function e(){var t=h.getCurrentStep();t.colors.background=u.colors.background;t.colors.lines=u.colors.lines;t.colors.overLines=u.colors.overLines;t.camera.cameraHeight=u.camera.cameraHeight;t.camera.targetHeight=u.camera.targetHeight;t.circle.position.copy(u.circle.position);n.$broadcast("onOptionsChanged")}var u=t,h=i,f=new dat.GUI,o,s;u.randomize=function(){for(var n,i,t=0;t<f.__controllers.length;t++)n=f.__controllers[t],n.__min&&(i=n.__min+(n.__max-n.__min)*Math.random(),this[n.property]=i,n.updateDisplay()),n.__color&&(n.__color.r=Math.floor(Math.random()*255),n.__color.g=Math.floor(Math.random()*255),n.__color.b=Math.floor(Math.random()*255),n.updateDisplay(),n.setValue(n.__color.hex))};u.saveJson=function(){console.log("saveJson");r(h.steps,"rossini.js",!0,!0)};f.closed=!0;f.add(u.camera,"cameraHeight",20,100).onChange(e);f.add(u.camera,"targetHeight",20,100).onChange(e);o=f.addFolder("circlePosition");o.add(u.circle.position,"x",-300,300).onChange(e);o.add(u.circle.position,"y",-300,300).onChange(e);o.add(u.circle.position,"z",-300,300).onChange(e);s=f.addFolder("colors");s.addColor(u.colors,"background").onChange(e);s.addColor(u.colors,"lines").onChange(e);s.addColor(u.colors,"overLines").onChange(e);f.add(u,"audioVolume",.01,1).onChange(e);f.add(u,"audioStrength",10,100).onChange(e);f.add(u,"noiseStrength",10,100).onChange(e);f.add(u,"circularStrength",.01,.9).onChange(e);return f.add(u,"randomize"),f.add(u,"saveJson"),e(),f}var r=function(){var n=document.createElement("a");return document.body.appendChild(n),n.style="display: none",function(t,i,r,u){r&&(t=u?JSON.stringify(t,null,2):JSON.stringify(t));var e=new Blob([t],{type:"octet/stream"}),f=window.URL.createObjectURL(e);n.href=f;n.download=i;n.click();window.URL.revokeObjectURL(f)}}();return u}])})();